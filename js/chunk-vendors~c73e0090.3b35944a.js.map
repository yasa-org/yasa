{"version":3,"sources":["webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/richEditBrackets.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/modelService.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/languageConfiguration.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/modesRegistry.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/textToHtmlTokenizer.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/linkComputer.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/inplaceReplaceSupport.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerServiceImpl.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/modeService.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/tokenization.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/languageSelector.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/languageFeatureRegistry.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/characterPair.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/electricCharacter.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/indentRules.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/supports/onEnter.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/languageConfigurationRegistry.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/tokenizationRegistry.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfigurationService.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/nullMode.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerService.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/webWorker.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/resolverService.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/modes/abstractMode.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/modeServiceImpl.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/modelServiceImpl.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsServiceImpl.js","webpack:///./node_modules/monaco-editor/esm/vs/editor/common/services/markersDecorationService.js"],"names":["createScopedLineTokens","context","offset","tokenCount","getCount","tokenIndex","findTokenIndexAtOffset","desiredLanguageId","getLanguageId","lastTokenIndex","firstTokenIndex","ScopedLineTokens","getStartOffset","getEndOffset","actual","languageId","firstCharOffset","lastCharOffset","this","_actual","_firstTokenIndex","_lastTokenIndex","_lastCharOffset","prototype","getLineContent","actualLineContent","substring","getActualLineContentBefore","getTokenCount","getStandardTokenType","ignoreBracketsInToken","standardTokenType","RichEditBracket","languageIdentifier","index","open","close","forwardRegex","reversedRegex","_openSet","_toSet","_closeSet","isOpen","text","has","isClose","arr","result","Set","_i","arr_1","length","element","add","groupFuzzyBrackets","brackets","N","map","b","toLowerCase","group","i","areOverlapping","a","aOpen","aClose","bOpen","bClose","mergeGroups","g1","g2","newG","Math","min","oldG","max","j","g","currentOpen","currentClose","_a","open_1","close_1","push","RichEditBrackets","_brackets","getRegexForBracketPair","getReversedRegexForBracketPair","getRegexForBrackets","getReversedRegexForBrackets","textIsBracket","textIsOpenBracket","maxBracketLength","bracket","_b","_c","open_2","_d","_e","close_2","collectSuperstrings","str","currentIndex","dest","len","open_3","indexOf","close_3","lengthcmp","unique","seen","arr_2","pieces","concat","sort","reverse","createBracketOrRegExp","toReversedString","brackets_1","open_4","close_4","brackets_2","open_5","close_5","prepareBracketForRegExp","insertWordBoundaries","test","regexStr","join","reversedStr","charAt","lastInput","lastOutput","BracketsUtils","_findPrevBracketInText","reversedBracketRegex","lineNumber","reversedText","m","match","matchOffset","matchLength","absoluteMatchOffset","findPrevBracketInRange","lineText","startOffset","endOffset","reversedLineText","reversedSubstr","findNextBracketInText","bracketRegex","findNextBracketInRange","substr","IModelService","shouldSynchronizeModel","model","isTooLargeForSyncing","isForSimpleWidget","IndentAction","StandardAutoClosingPairConditional","source","_standardTokenMask","Array","isArray","notIn","isOK","standardToken","Extensions","ModesRegistry","EditorModesRegistry","_onDidChangeLanguages","onDidChangeLanguages","event","_languages","_dynamicLanguages","registerLanguage","def","fire","undefined","getLanguages","PLAINTEXT_MODE_ID","PLAINTEXT_LANGUAGE_IDENTIFIER","id","extensions","aliases","mimetypes","register","surroundingPairs","folding","offSide","fallback","getInitialState","tokenize2","buffer","state","deltaOffset","tokenizeToString","tokenizationSupport","_tokenizeToString","tokenizeLineToHTML","viewLineTokens","colorMap","tabSize","useNbsp","charIndex","tabsCharDelta","tokenEndIndex","partContent","charCode","charCodeAt","insertSpacesCount","String","fromCharCode","getInlineStyle","lines","split","currentState","line","tokenizationResult","convertToEndOffset","tokens","lineTokens","inflate","lenJ","type","getClassName","endIndex","endState","Uint8Matrix","rows","cols","defaultValue","data","Uint8Array","_data","get","row","col","set","value","StateMachine","edges","maxCharCode","maxState","from","chCode","to","states","_states","_maxCharCode","nextState","_stateMachine","getStateMachine","_classifier","getClassifier","FORCE_TERMINATION_CHARACTERS","CANNOT_END_WITH_CHARACTERS","LinkComputer","_createLink","classifier","linkBeginIndex","linkEndIndex","lastIncludedCharIndex","chClass","charCodeBeforeLink","lastCharCodeInLink","range","startLineNumber","startColumn","endLineNumber","endColumn","url","computeLinks","stateMachine","lineCount","getLineCount","linkBeginChCode","hasOpenParens","hasOpenSquareBracket","hasOpenCurlyBracket","resetStateMachine","BasicInplaceReplace","_defaultValueSet","navigateValueSet","range1","text1","range2","text2","up","doNavigateValueSet","numberResult","numberReplace","textReplace","precision","pow","lastIndexOf","n1","Number","n2","parseFloat","isNaN","floor","valueSetsReplace","valueSets","valueSetReplace","valueSet","idx","INSTANCE","__extends","extendStatics","d","Object","setPrototypeOf","__proto__","p","hasOwnProperty","__","constructor","create","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","apply","__generator","body","f","y","t","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","_super","MirrorModel","arguments","defineProperty","_uri","enumerable","configurable","_versionId","_eol","getValue","getText","getLinesContent","_lines","slice","getWordAtPosition","position","wordDefinition","wordAtText","column","createWordIterator","obj","_this","wordRangesIdx","wordRanges","start","end","_wordenize","getLineWords","content","ranges","words","ranges_1","word","lastIndex","exec","getValueInRange","_validateRange","lineEnding","startLineIndex","endLineIndex","resultLines","offsetAt","_validatePosition","_ensureLineStarts","_lineStarts","getAccumulatedValue","positionAt","out","getIndexOf","lineLength","remainder","isIPosition","Error","hasChanged","maxCharacter","EditorSimpleWorker","host","foreignModuleFactory","_host","_models","_foreignModuleFactory","_foreignModule","dispose","_getModel","uri","_getModels","all","keys","forEach","key","acceptNewModel","parse","EOL","versionId","acceptModelChanged","strURL","onEvents","acceptRemovedModel","computeDiff","originalUrl","modifiedUrl","ignoreTrimWhitespace","maxComputationTime","original","modified","originalLines","modifiedLines","diffComputer","diffResult","identical","shouldComputeCharChanges","shouldPostProcessCharChanges","shouldIgnoreTrimWhitespace","shouldMakePrettyDiff","changes","_modelsAreIdentical","quitEarly","originalLineCount","modifiedLineCount","originalLine","modifiedLine","computeMoreMinimalEdits","modelUrl","edits","lastEol","edits_1","eol","editOffset","changes_1","change","newEdit","compareRangesUsingStarts","aRng","bRng","isEmpty","replace","_diffLimit","lift","getStartPosition","originalStart","originalLength","modifiedStart","modifiedLength","textualSuggest","wordDef","wordDefFlags","wordDefRegExp","wordAt","iter","RegExp","size","_suggestionsLimit","computeWordRanges","words_1","array","selectionText","wordRange","loadForeignModule","moduleId","createData","foreignHostMethods","proxyMethodRequest","method","args","fhr","foreignHost","types","ctx","getMirrorModels","fmr","importScripts","monaco","__decorate","decorators","target","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","__param","paramIndex","decorator","STOP_SYNC_MODEL_DELTA_TIME_MS","STOP_WORKER_DELTA_TIME_MS","canSyncModel","modelService","resource","getModel","EditorWorkerServiceImpl","configurationService","logService","_modelService","_workerManager","_register","_logService","modes","provideLinks","token","withWorker","client","links","canComputeDiff","sw_1","finally","trace","toString","elapsed","canNavigateValueSet","canComputeWordRanges","WordBasedCompletionItemProvider","workerManager","_debugDisplayName","_configurationService","provideCompletionItems","wordBasedSuggestions","insert","fromPositions","setEndPosition","suggestions","kind","insertText","WorkerManager","_editorWorkerClient","_lastWorkerUsedTime","Date","getTime","stopWorkerInterval","cancelAndSet","_checkStopIdleWorker","round","onModelRemoved","_checkStopEmptyWorker","models","getModels","timeSinceLastWorkerUsedTime","EditorModelManager","proxy","keepIdleModels","_syncedModels","_syncedModelsLastUsedTime","_proxy","timer","_checkStopModelSync","ensureSyncedResources","resources","resources_1","resourceStr","_beginModelSync","currentTime","toRemove","elapsedTime","toRemove_1","_stopModelSync","getEOL","getVersionId","toDispose","onDidChangeContent","onWillDispose","SynchronousWorkerClient","instance","_instance","_proxyObj","getProxyObject","EditorWorkerHost","workerClient","_workerClient","EditorWorkerClient","_keepIdleModels","_workerFactory","_worker","_modelManager","_getOrCreateWorker","err","_getProxy","_getOrCreateModelManager","_withSyncedResources","getWordDefinition","getLanguageIdentifier","IModeService","ParsedTokenThemeRule","fontStyle","foreground","background","parseTokenTheme","resultLen","entry","segments","segment","resolveParsedTokenThemeRules","parsedThemeRules","customTokenColors","strcmp","defaultFontStyle","defaultForeground","defaultBackground","incomingDefaults","shift","ColorMap","customTokenColors_1","color","getId","foregroundColorId","backgroundColorId","defaults","ThemeTrieElementRule","root","ThemeTrieElement","rule","TokenTheme","colorRegExp","_lastColorId","_id2color","_color2id","Map","toUpperCase","fromHex","getColorMap","_colorMap","_root","_cache","createFromRawTokenTheme","createFromParsedTokenTheme","_match","toStandardTokenType","metadata","STANDARD_TOKEN_TYPE_REGEXP","tokenType","_fontStyle","_foreground","_background","clone","acceptOverwrite","mainRule","_mainRule","_children","head","tail","dotIndex","child","generateTokensCSSForColorMap","rules","score","selector","candidateUri","candidateLanguage","candidateIsSynchronized","ret","selector_1","filter","language","pattern","scheme","hasAccessToAllModels","fsPath","isExclusive","every","exclusive","LanguageFeatureRegistry","_clock","_entries","_onDidChange","provider","_score","_time","_lastCandidate","splice","_updateScores","ordered","_orderedForEach","orderedGroups","lastBucket","lastBucketScore","callback","candidate","entry_1","_compareByScoreAndTime","CharacterPairSupport","config","autoClosingPairs","_autoClosingPairs","el","__electricCharacterSupport","docComment","_autoCloseBefore","autoCloseBefore","DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED","_surroundingPairs","getAutoClosingPairs","getAutoCloseBeforeSet","shouldAutoClosePair","autoClosingPair","getSurroundingPairs","BracketElectricCharacterSupport","richEditBrackets","_richEditBrackets","getElectricCharacters","lastChar","item","pos","onElectricCharacter","character","bracketText","textBeforeBracket","matchOpenBracket","IndentRulesSupport","indentationRules","_indentationRules","shouldIncrease","increaseIndentPattern","shouldDecrease","decreaseIndentPattern","shouldIndentNextLine","indentNextLinePattern","shouldIgnore","unIndentedLinePattern","getIndentMetadata","OnEnterSupport","opts","openRegExp","_createOpenBracketRegExp","closeRegExp","_createCloseBracketRegExp","_regExpRules","onEnterRules","onEnter","autoIndent","oneLineAboveText","beforeEnterText","afterEnterText","regResult","reg","beforeText","afterText","action","indentAction","IndentOutdent","Indent","strings","_safeRegExp","RichEditSupport","previous","rawConf","_languageIdentifier","_electricCharacter","prev","_conf","_mergeConf","_onEnterSupport","comments","_handleComments","characterPair","wordPattern","indentRulesSupport","foldingRules","current","conf","commentRule","lineComment","lineCommentToken","blockComment","blockStart","blockEnd","blockCommentStartToken","blockCommentEndToken","LanguageConfigurationChangeEvent","LanguageConfigurationRegistryImpl","onDidChange","configuration","_getRichEditSupport","_getElectricCharacterSupport","electricCharacter","electricCharacterSupport","scopedLineTokens","getComments","_getCharacterPairSupport","characterPairSupport","getFoldingRules","getIndentRulesSupport","getPrecedingValidLine","languageID","getLanguageIdAtPosition","lastLineNumber","resultLineNumber","getInheritIndentForLine","honorIntentialIndent","indentation","precedingUnIgnoredLine","precedingUnIgnoredLineContent","previousLine","previousLineIndentMetadata","stopLine","lineContent","getGoodIndentForLine","virtualModel","indentConverter","richEditSupport","indent","inheritLine","enterResult","removeText","shiftIndent","Outdent","unshiftIndent","appendText","getIndentForEnter","forceTokenization","getLineTokens","scopedLineText","embeddedLanguage","endScopedLineTokens","getScopedLineTokens","beforeEnterResult","beforeEnterIndent","currentLineIndent","afterEnterAction","beforeEnter","afterEnter","afterEnterIndent","getIndentActionForType","ch","afterTypeText","beforeTypeText","getEnterAction","oneLineAboveScopedLineTokens","getIndentationAtPosition","columnNumber","getLineMaxColumn","getBracketsSupport","LanguageConfigurationRegistry","TokenizationRegistryImpl","_map","_promises","languages","changedLanguages","changedColorMap","support","delete","registerPromise","supportPromise","registration","isDisposed","getPromise","promise","setColorMap","getDefaultBackground","ITextResourceConfigurationService","ITextResourcePropertiesService","getIconClasses","modeService","fileKind","classes","ROOT_FOLDER","FOLDER","name_1","parseMetaData","META_DATA_LABEL","cssEscape","dotSegments","detectedModeId","detectModeId","modeId","mime","META_DATA_MIME","getModeId","getModeIdByFilepathOrFirstLine","val","NullStateImpl","equals","other","NULL_STATE","NULL_MODE_ID","NULL_LANGUAGE_IDENTIFIER","nullTokenize","nullTokenize2","Uint32Array","ID_EDITOR_WORKER_SERVICE","IEditorWorkerService","createWebWorker","MonacoWebWorkerImpl","_foreignModuleId","_foreignModuleCreateData","_foreignModuleHost","_foreignProxy","_getForeignProxy","foreignMethods","createProxyMethod","foreignProxy","foreignMethods_1","foreignMethod","getProxy","withSyncedResources","ITextModelService","FrankensteinMode","LanguagesRegistry","useModesRegistry","warnOnOverwrite","_warnOnOverwrite","_nextLanguageId2","_languageIdToLanguage","_languageToLanguageId","_mimeTypesMap","_nameMap","_lowercaseNameMap","_initializeFromRegistry","_registerLanguages","desc_1","_registerLanguage","langId","name","identifier","alias","mimetype","as","Configuration","registerOverrideIdentifiers","_getLanguageId","lang","resolvedLanguage","filenames","configurationFiles","_mergeLanguage","primaryMime","extension","filename","filenamePatterns","_f","filenamePattern","filepattern","firstLine","firstLineRegexStr","firstLineRegex","firstline","langAliases","_g","langAliases_1","langAlias","containsAliases","bestName","isRegisteredMode","mimetypeOrModeId","getModeIdForLanguageNameLowercase","languageNameLower","extractModeIds","commaSeparatedMimetypesOrCommaSeparatedIds","mimeTypeOrId","trim","_modeId","getModeIdsFromFilepathOrFirstLine","mimeTypes","LanguageSelection","onLanguagesMaybeChanged","_selector","_evaluate","ModeServiceImpl","_onDidCreateMode","onDidCreateMode","_onLanguagesMaybeChanged","_instantiatedModes","_registry","getModeIdForLanguageName","modeIds","_createModeAndGetLanguageIdentifier","createByFilepathOrFirstLine","_getOrCreateMode","triggerMode","MODEL_ID","ModelData","onDidChangeLanguage","_modelEventListeners","_languageSelection","_languageSelectionListener","_disposeLanguageSelection","setLanguage","languageSelection","setMode","DEFAULT_EOL","ModelServiceImpl","resourcePropertiesService","themeService","_onModelAdded","onModelAdded","_onModelRemoved","_onModelModeChanged","onModelModeChanged","_resourcePropertiesService","_modelCreationOptionsByLanguageAndResource","_configurationServiceSubscription","onDidChangeConfiguration","_updateModelOptions","SemanticColoringFeature","_readModelOptions","editor","parsedTabSize","parseInt","indentSize","parsedIndentSize","insertSpaces","Boolean","newDefaultEOL","trimAutoWhitespace","detectIndentation","largeFileOptimizations","defaultEOL","getCreationOptions","creationOptions","overrideIdentifier","oldOptionsByLanguageAndResource","modelId","modelData","oldOptions","newOptions","_setModelOptionsForModel","currentOptions","setEOL","updateOptions","_createModelData","options","_onWillDispose","_onDidChangeLanguage","createModel","oldModeId","oldLanguage","newModeId","_watchers","_semanticStyling","SemanticStyling","isSemanticColoringEnabled","SETTING_ID","enabled","ModelSemanticColoring","deregister","modelSemanticColoring","curr","affectsConfiguration","_themeService","_caches","WeakMap","onThemeChange","SemanticColoringProviderStyling","getLegend","HashTableEntry","tokenTypeIndex","tokenModifierSet","HashTable","_elementsCount","_currentLengthIndex","_currentLength","_SIZES","_growCount","_elements","_nullOutEntries","entries","_hashFunc","hash","oldElements","oldElements_1","first","oldNext","_add","_legend","_hashTable","getMetadata","tokenTypes","tokenModifiers","modifierSet","modifierIndex","tokenStyle","getTheme","getTokenStyleMetadata","italic","italicBit","bold","boldBit","underline","underlineBit","foregroundBits","getLevel","Trace","modifiers","getForeground","getFontStyle","SemanticTokensResponse","_provider","resultId","releaseDocumentSemanticTokens","stylingProvider","_isDisposed","_model","_fetchSemanticTokens","_fetchSemanticTokensNow","_currentResponse","_currentRequestCancellationTokenSource","isScheduled","schedule","_setSemanticTokens","cancel","_getSemanticColoringProvider","pendingChanges","contentChangeListener","styling","lastResultId","request","provideDocumentSemanticTokens","res","message","_isSemanticTokens","_isSemanticTokensEdits","_copy","src","srcOffset","destOffset","currentResponse","setSemanticTokens","deltaLength","edit","deleteCount","srcData","destData","srcLastStart","destLastStart","copyCount","tokensPerArea","ceil","lastStartCharacter","tokenStartIndex","smallTokenEndIndex","bigTokenEndIndex","areaLine","deltaLine","deltaCharacter","startCharacter","length_1","subarray","tokens_1","pendingChanges_1","result_1","area","singleChange","applyEdit","MarkerDecorations","_markersData","deltaDecorations","clear","update","markers","newDecorations","oldIds","ids","getMarker","decoration","MarkerDecorationsService","_markerService","_onDidChangeMarker","_markerDecorations","onMarkerChanged","_handleMarkerChange","markerDecorations","changedResources","_updateDecorations","inMemory","internal","vscode","read","marker","owner","remove","take","newModelDecorations","_createDecorationRange","_createDecorationOption","rawMarker","severity","Hint","_hasMarkerTag","validateRange","maxColumn","getLineLastNonWhitespaceColumn","MAX_VALUE","minColumn","getLineFirstNonWhitespaceColumn","className","zIndex","minimap","inlineClassName","Warning","Inline","Info","tags","stickiness","showIfCollapsed","overviewRuler","Right","tag","IMarkerDecorationsService"],"mappings":"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","file":"js/chunk-vendors~c73e0090.3b35944a.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nexport function createScopedLineTokens(context, offset) {\r\n    var tokenCount = context.getCount();\r\n    var tokenIndex = context.findTokenIndexAtOffset(offset);\r\n    var desiredLanguageId = context.getLanguageId(tokenIndex);\r\n    var lastTokenIndex = tokenIndex;\r\n    while (lastTokenIndex + 1 < tokenCount && context.getLanguageId(lastTokenIndex + 1) === desiredLanguageId) {\r\n        lastTokenIndex++;\r\n    }\r\n    var firstTokenIndex = tokenIndex;\r\n    while (firstTokenIndex > 0 && context.getLanguageId(firstTokenIndex - 1) === desiredLanguageId) {\r\n        firstTokenIndex--;\r\n    }\r\n    return new ScopedLineTokens(context, desiredLanguageId, firstTokenIndex, lastTokenIndex + 1, context.getStartOffset(firstTokenIndex), context.getEndOffset(lastTokenIndex));\r\n}\r\nvar ScopedLineTokens = /** @class */ (function () {\r\n    function ScopedLineTokens(actual, languageId, firstTokenIndex, lastTokenIndex, firstCharOffset, lastCharOffset) {\r\n        this._actual = actual;\r\n        this.languageId = languageId;\r\n        this._firstTokenIndex = firstTokenIndex;\r\n        this._lastTokenIndex = lastTokenIndex;\r\n        this.firstCharOffset = firstCharOffset;\r\n        this._lastCharOffset = lastCharOffset;\r\n    }\r\n    ScopedLineTokens.prototype.getLineContent = function () {\r\n        var actualLineContent = this._actual.getLineContent();\r\n        return actualLineContent.substring(this.firstCharOffset, this._lastCharOffset);\r\n    };\r\n    ScopedLineTokens.prototype.getActualLineContentBefore = function (offset) {\r\n        var actualLineContent = this._actual.getLineContent();\r\n        return actualLineContent.substring(0, this.firstCharOffset + offset);\r\n    };\r\n    ScopedLineTokens.prototype.getTokenCount = function () {\r\n        return this._lastTokenIndex - this._firstTokenIndex;\r\n    };\r\n    ScopedLineTokens.prototype.findTokenIndexAtOffset = function (offset) {\r\n        return this._actual.findTokenIndexAtOffset(offset + this.firstCharOffset) - this._firstTokenIndex;\r\n    };\r\n    ScopedLineTokens.prototype.getStandardTokenType = function (tokenIndex) {\r\n        return this._actual.getStandardTokenType(tokenIndex + this._firstTokenIndex);\r\n    };\r\n    return ScopedLineTokens;\r\n}());\r\nexport { ScopedLineTokens };\r\nexport function ignoreBracketsInToken(standardTokenType) {\r\n    return (standardTokenType & 7 /* value */) !== 0;\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as strings from '../../../../base/common/strings.js';\r\nimport { Range } from '../../core/range.js';\r\nvar RichEditBracket = /** @class */ (function () {\r\n    function RichEditBracket(languageIdentifier, index, open, close, forwardRegex, reversedRegex) {\r\n        this.languageIdentifier = languageIdentifier;\r\n        this.index = index;\r\n        this.open = open;\r\n        this.close = close;\r\n        this.forwardRegex = forwardRegex;\r\n        this.reversedRegex = reversedRegex;\r\n        this._openSet = RichEditBracket._toSet(this.open);\r\n        this._closeSet = RichEditBracket._toSet(this.close);\r\n    }\r\n    RichEditBracket.prototype.isOpen = function (text) {\r\n        return this._openSet.has(text);\r\n    };\r\n    RichEditBracket.prototype.isClose = function (text) {\r\n        return this._closeSet.has(text);\r\n    };\r\n    RichEditBracket._toSet = function (arr) {\r\n        var result = new Set();\r\n        for (var _i = 0, arr_1 = arr; _i < arr_1.length; _i++) {\r\n            var element = arr_1[_i];\r\n            result.add(element);\r\n        }\r\n        return result;\r\n    };\r\n    return RichEditBracket;\r\n}());\r\nexport { RichEditBracket };\r\nfunction groupFuzzyBrackets(brackets) {\r\n    var N = brackets.length;\r\n    brackets = brackets.map(function (b) { return [b[0].toLowerCase(), b[1].toLowerCase()]; });\r\n    var group = [];\r\n    for (var i = 0; i < N; i++) {\r\n        group[i] = i;\r\n    }\r\n    var areOverlapping = function (a, b) {\r\n        var aOpen = a[0], aClose = a[1];\r\n        var bOpen = b[0], bClose = b[1];\r\n        return (aOpen === bOpen || aOpen === bClose || aClose === bOpen || aClose === bClose);\r\n    };\r\n    var mergeGroups = function (g1, g2) {\r\n        var newG = Math.min(g1, g2);\r\n        var oldG = Math.max(g1, g2);\r\n        for (var i = 0; i < N; i++) {\r\n            if (group[i] === oldG) {\r\n                group[i] = newG;\r\n            }\r\n        }\r\n    };\r\n    // group together brackets that have the same open or the same close sequence\r\n    for (var i = 0; i < N; i++) {\r\n        var a = brackets[i];\r\n        for (var j = i + 1; j < N; j++) {\r\n            var b = brackets[j];\r\n            if (areOverlapping(a, b)) {\r\n                mergeGroups(group[i], group[j]);\r\n            }\r\n        }\r\n    }\r\n    var result = [];\r\n    for (var g = 0; g < N; g++) {\r\n        var currentOpen = [];\r\n        var currentClose = [];\r\n        for (var i = 0; i < N; i++) {\r\n            if (group[i] === g) {\r\n                var _a = brackets[i], open_1 = _a[0], close_1 = _a[1];\r\n                currentOpen.push(open_1);\r\n                currentClose.push(close_1);\r\n            }\r\n        }\r\n        if (currentOpen.length > 0) {\r\n            result.push({\r\n                open: currentOpen,\r\n                close: currentClose\r\n            });\r\n        }\r\n    }\r\n    return result;\r\n}\r\nvar RichEditBrackets = /** @class */ (function () {\r\n    function RichEditBrackets(languageIdentifier, _brackets) {\r\n        var brackets = groupFuzzyBrackets(_brackets);\r\n        this.brackets = brackets.map(function (b, index) {\r\n            return new RichEditBracket(languageIdentifier, index, b.open, b.close, getRegexForBracketPair(b.open, b.close, brackets, index), getReversedRegexForBracketPair(b.open, b.close, brackets, index));\r\n        });\r\n        this.forwardRegex = getRegexForBrackets(this.brackets);\r\n        this.reversedRegex = getReversedRegexForBrackets(this.brackets);\r\n        this.textIsBracket = {};\r\n        this.textIsOpenBracket = {};\r\n        this.maxBracketLength = 0;\r\n        for (var _i = 0, _a = this.brackets; _i < _a.length; _i++) {\r\n            var bracket = _a[_i];\r\n            for (var _b = 0, _c = bracket.open; _b < _c.length; _b++) {\r\n                var open_2 = _c[_b];\r\n                this.textIsBracket[open_2] = bracket;\r\n                this.textIsOpenBracket[open_2] = true;\r\n                this.maxBracketLength = Math.max(this.maxBracketLength, open_2.length);\r\n            }\r\n            for (var _d = 0, _e = bracket.close; _d < _e.length; _d++) {\r\n                var close_2 = _e[_d];\r\n                this.textIsBracket[close_2] = bracket;\r\n                this.textIsOpenBracket[close_2] = false;\r\n                this.maxBracketLength = Math.max(this.maxBracketLength, close_2.length);\r\n            }\r\n        }\r\n    }\r\n    return RichEditBrackets;\r\n}());\r\nexport { RichEditBrackets };\r\nfunction collectSuperstrings(str, brackets, currentIndex, dest) {\r\n    for (var i = 0, len = brackets.length; i < len; i++) {\r\n        if (i === currentIndex) {\r\n            continue;\r\n        }\r\n        var bracket = brackets[i];\r\n        for (var _i = 0, _a = bracket.open; _i < _a.length; _i++) {\r\n            var open_3 = _a[_i];\r\n            if (open_3.indexOf(str) >= 0) {\r\n                dest.push(open_3);\r\n            }\r\n        }\r\n        for (var _b = 0, _c = bracket.close; _b < _c.length; _b++) {\r\n            var close_3 = _c[_b];\r\n            if (close_3.indexOf(str) >= 0) {\r\n                dest.push(close_3);\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction lengthcmp(a, b) {\r\n    return a.length - b.length;\r\n}\r\nfunction unique(arr) {\r\n    if (arr.length <= 1) {\r\n        return arr;\r\n    }\r\n    var result = [];\r\n    var seen = new Set();\r\n    for (var _i = 0, arr_2 = arr; _i < arr_2.length; _i++) {\r\n        var element = arr_2[_i];\r\n        if (seen.has(element)) {\r\n            continue;\r\n        }\r\n        result.push(element);\r\n        seen.add(element);\r\n    }\r\n    return result;\r\n}\r\nfunction getRegexForBracketPair(open, close, brackets, currentIndex) {\r\n    // search in all brackets for other brackets that are a superstring of these brackets\r\n    var pieces = [];\r\n    pieces = pieces.concat(open);\r\n    pieces = pieces.concat(close);\r\n    for (var i = 0, len = pieces.length; i < len; i++) {\r\n        collectSuperstrings(pieces[i], brackets, currentIndex, pieces);\r\n    }\r\n    pieces = unique(pieces);\r\n    pieces.sort(lengthcmp);\r\n    pieces.reverse();\r\n    return createBracketOrRegExp(pieces);\r\n}\r\nfunction getReversedRegexForBracketPair(open, close, brackets, currentIndex) {\r\n    // search in all brackets for other brackets that are a superstring of these brackets\r\n    var pieces = [];\r\n    pieces = pieces.concat(open);\r\n    pieces = pieces.concat(close);\r\n    for (var i = 0, len = pieces.length; i < len; i++) {\r\n        collectSuperstrings(pieces[i], brackets, currentIndex, pieces);\r\n    }\r\n    pieces = unique(pieces);\r\n    pieces.sort(lengthcmp);\r\n    pieces.reverse();\r\n    return createBracketOrRegExp(pieces.map(toReversedString));\r\n}\r\nfunction getRegexForBrackets(brackets) {\r\n    var pieces = [];\r\n    for (var _i = 0, brackets_1 = brackets; _i < brackets_1.length; _i++) {\r\n        var bracket = brackets_1[_i];\r\n        for (var _a = 0, _b = bracket.open; _a < _b.length; _a++) {\r\n            var open_4 = _b[_a];\r\n            pieces.push(open_4);\r\n        }\r\n        for (var _c = 0, _d = bracket.close; _c < _d.length; _c++) {\r\n            var close_4 = _d[_c];\r\n            pieces.push(close_4);\r\n        }\r\n    }\r\n    pieces = unique(pieces);\r\n    return createBracketOrRegExp(pieces);\r\n}\r\nfunction getReversedRegexForBrackets(brackets) {\r\n    var pieces = [];\r\n    for (var _i = 0, brackets_2 = brackets; _i < brackets_2.length; _i++) {\r\n        var bracket = brackets_2[_i];\r\n        for (var _a = 0, _b = bracket.open; _a < _b.length; _a++) {\r\n            var open_5 = _b[_a];\r\n            pieces.push(open_5);\r\n        }\r\n        for (var _c = 0, _d = bracket.close; _c < _d.length; _c++) {\r\n            var close_5 = _d[_c];\r\n            pieces.push(close_5);\r\n        }\r\n    }\r\n    pieces = unique(pieces);\r\n    return createBracketOrRegExp(pieces.map(toReversedString));\r\n}\r\nfunction prepareBracketForRegExp(str) {\r\n    // This bracket pair uses letters like e.g. \"begin\" - \"end\"\r\n    var insertWordBoundaries = (/^[\\w ]+$/.test(str));\r\n    str = strings.escapeRegExpCharacters(str);\r\n    return (insertWordBoundaries ? \"\\\\b\" + str + \"\\\\b\" : str);\r\n}\r\nfunction createBracketOrRegExp(pieces) {\r\n    var regexStr = \"(\" + pieces.map(prepareBracketForRegExp).join(')|(') + \")\";\r\n    return strings.createRegExp(regexStr, true);\r\n}\r\nvar toReversedString = (function () {\r\n    function reverse(str) {\r\n        var reversedStr = '';\r\n        for (var i = str.length - 1; i >= 0; i--) {\r\n            reversedStr += str.charAt(i);\r\n        }\r\n        return reversedStr;\r\n    }\r\n    var lastInput = null;\r\n    var lastOutput = null;\r\n    return function toReversedString(str) {\r\n        if (lastInput !== str) {\r\n            lastInput = str;\r\n            lastOutput = reverse(lastInput);\r\n        }\r\n        return lastOutput;\r\n    };\r\n})();\r\nvar BracketsUtils = /** @class */ (function () {\r\n    function BracketsUtils() {\r\n    }\r\n    BracketsUtils._findPrevBracketInText = function (reversedBracketRegex, lineNumber, reversedText, offset) {\r\n        var m = reversedText.match(reversedBracketRegex);\r\n        if (!m) {\r\n            return null;\r\n        }\r\n        var matchOffset = reversedText.length - (m.index || 0);\r\n        var matchLength = m[0].length;\r\n        var absoluteMatchOffset = offset + matchOffset;\r\n        return new Range(lineNumber, absoluteMatchOffset - matchLength + 1, lineNumber, absoluteMatchOffset + 1);\r\n    };\r\n    BracketsUtils.findPrevBracketInRange = function (reversedBracketRegex, lineNumber, lineText, startOffset, endOffset) {\r\n        // Because JS does not support backwards regex search, we search forwards in a reversed string with a reversed regex ;)\r\n        var reversedLineText = toReversedString(lineText);\r\n        var reversedSubstr = reversedLineText.substring(lineText.length - endOffset, lineText.length - startOffset);\r\n        return this._findPrevBracketInText(reversedBracketRegex, lineNumber, reversedSubstr, startOffset);\r\n    };\r\n    BracketsUtils.findNextBracketInText = function (bracketRegex, lineNumber, text, offset) {\r\n        var m = text.match(bracketRegex);\r\n        if (!m) {\r\n            return null;\r\n        }\r\n        var matchOffset = m.index || 0;\r\n        var matchLength = m[0].length;\r\n        if (matchLength === 0) {\r\n            return null;\r\n        }\r\n        var absoluteMatchOffset = offset + matchOffset;\r\n        return new Range(lineNumber, absoluteMatchOffset + 1, lineNumber, absoluteMatchOffset + 1 + matchLength);\r\n    };\r\n    BracketsUtils.findNextBracketInRange = function (bracketRegex, lineNumber, lineText, startOffset, endOffset) {\r\n        var substr = lineText.substring(startOffset, endOffset);\r\n        return this.findNextBracketInText(bracketRegex, lineNumber, substr, startOffset);\r\n    };\r\n    return BracketsUtils;\r\n}());\r\nexport { BracketsUtils };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var IModelService = createDecorator('modelService');\r\nexport function shouldSynchronizeModel(model) {\r\n    return (!model.isTooLargeForSyncing() && !model.isForSimpleWidget);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n/**\r\n * Describes what to do with the indentation when pressing Enter.\r\n */\r\nexport var IndentAction;\r\n(function (IndentAction) {\r\n    /**\r\n     * Insert new line and copy the previous line's indentation.\r\n     */\r\n    IndentAction[IndentAction[\"None\"] = 0] = \"None\";\r\n    /**\r\n     * Insert new line and indent once (relative to the previous line's indentation).\r\n     */\r\n    IndentAction[IndentAction[\"Indent\"] = 1] = \"Indent\";\r\n    /**\r\n     * Insert two new lines:\r\n     *  - the first one indented which will hold the cursor\r\n     *  - the second one at the same indentation level\r\n     */\r\n    IndentAction[IndentAction[\"IndentOutdent\"] = 2] = \"IndentOutdent\";\r\n    /**\r\n     * Insert new line and outdent once (relative to the previous line's indentation).\r\n     */\r\n    IndentAction[IndentAction[\"Outdent\"] = 3] = \"Outdent\";\r\n})(IndentAction || (IndentAction = {}));\r\n/**\r\n * @internal\r\n */\r\nvar StandardAutoClosingPairConditional = /** @class */ (function () {\r\n    function StandardAutoClosingPairConditional(source) {\r\n        this.open = source.open;\r\n        this.close = source.close;\r\n        // initially allowed in all tokens\r\n        this._standardTokenMask = 0;\r\n        if (Array.isArray(source.notIn)) {\r\n            for (var i = 0, len = source.notIn.length; i < len; i++) {\r\n                var notIn = source.notIn[i];\r\n                switch (notIn) {\r\n                    case 'string':\r\n                        this._standardTokenMask |= 2 /* String */;\r\n                        break;\r\n                    case 'comment':\r\n                        this._standardTokenMask |= 1 /* Comment */;\r\n                        break;\r\n                    case 'regex':\r\n                        this._standardTokenMask |= 4 /* RegEx */;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    StandardAutoClosingPairConditional.prototype.isOK = function (standardToken) {\r\n        return (this._standardTokenMask & standardToken) === 0;\r\n    };\r\n    return StandardAutoClosingPairConditional;\r\n}());\r\nexport { StandardAutoClosingPairConditional };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as nls from '../../../nls.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { LanguageIdentifier } from '../modes.js';\r\nimport { LanguageConfigurationRegistry } from './languageConfigurationRegistry.js';\r\nimport { Registry } from '../../../platform/registry/common/platform.js';\r\n// Define extension point ids\r\nexport var Extensions = {\r\n    ModesRegistry: 'editor.modesRegistry'\r\n};\r\nvar EditorModesRegistry = /** @class */ (function () {\r\n    function EditorModesRegistry() {\r\n        this._onDidChangeLanguages = new Emitter();\r\n        this.onDidChangeLanguages = this._onDidChangeLanguages.event;\r\n        this._languages = [];\r\n        this._dynamicLanguages = [];\r\n    }\r\n    // --- languages\r\n    EditorModesRegistry.prototype.registerLanguage = function (def) {\r\n        this._languages.push(def);\r\n        this._onDidChangeLanguages.fire(undefined);\r\n    };\r\n    EditorModesRegistry.prototype.getLanguages = function () {\r\n        return [].concat(this._languages).concat(this._dynamicLanguages);\r\n    };\r\n    return EditorModesRegistry;\r\n}());\r\nexport { EditorModesRegistry };\r\nexport var ModesRegistry = new EditorModesRegistry();\r\nRegistry.add(Extensions.ModesRegistry, ModesRegistry);\r\nexport var PLAINTEXT_MODE_ID = 'plaintext';\r\nexport var PLAINTEXT_LANGUAGE_IDENTIFIER = new LanguageIdentifier(PLAINTEXT_MODE_ID, 1 /* PlainText */);\r\nModesRegistry.registerLanguage({\r\n    id: PLAINTEXT_MODE_ID,\r\n    extensions: ['.txt', '.gitignore'],\r\n    aliases: [nls.localize('plainText.alias', \"Plain Text\"), 'text'],\r\n    mimetypes: ['text/plain']\r\n});\r\nLanguageConfigurationRegistry.register(PLAINTEXT_LANGUAGE_IDENTIFIER, {\r\n    brackets: [\r\n        ['(', ')'],\r\n        ['[', ']'],\r\n        ['{', '}'],\r\n    ],\r\n    surroundingPairs: [\r\n        { open: '{', close: '}' },\r\n        { open: '[', close: ']' },\r\n        { open: '(', close: ')' },\r\n        { open: '<', close: '>' },\r\n        { open: '\\\"', close: '\\\"' },\r\n        { open: '\\'', close: '\\'' },\r\n        { open: '`', close: '`' },\r\n    ],\r\n    folding: {\r\n        offSide: true\r\n    }\r\n});\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { LineTokens } from '../core/lineTokens.js';\r\nimport { NULL_STATE, nullTokenize2 } from './nullMode.js';\r\nvar fallback = {\r\n    getInitialState: function () { return NULL_STATE; },\r\n    tokenize2: function (buffer, state, deltaOffset) { return nullTokenize2(0 /* Null */, buffer, state, deltaOffset); }\r\n};\r\nexport function tokenizeToString(text, tokenizationSupport) {\r\n    if (tokenizationSupport === void 0) { tokenizationSupport = fallback; }\r\n    return _tokenizeToString(text, tokenizationSupport || fallback);\r\n}\r\nexport function tokenizeLineToHTML(text, viewLineTokens, colorMap, startOffset, endOffset, tabSize, useNbsp) {\r\n    var result = \"<div>\";\r\n    var charIndex = startOffset;\r\n    var tabsCharDelta = 0;\r\n    for (var tokenIndex = 0, tokenCount = viewLineTokens.getCount(); tokenIndex < tokenCount; tokenIndex++) {\r\n        var tokenEndIndex = viewLineTokens.getEndOffset(tokenIndex);\r\n        if (tokenEndIndex <= startOffset) {\r\n            continue;\r\n        }\r\n        var partContent = '';\r\n        for (; charIndex < tokenEndIndex && charIndex < endOffset; charIndex++) {\r\n            var charCode = text.charCodeAt(charIndex);\r\n            switch (charCode) {\r\n                case 9 /* Tab */:\r\n                    var insertSpacesCount = tabSize - (charIndex + tabsCharDelta) % tabSize;\r\n                    tabsCharDelta += insertSpacesCount - 1;\r\n                    while (insertSpacesCount > 0) {\r\n                        partContent += useNbsp ? '&#160;' : ' ';\r\n                        insertSpacesCount--;\r\n                    }\r\n                    break;\r\n                case 60 /* LessThan */:\r\n                    partContent += '&lt;';\r\n                    break;\r\n                case 62 /* GreaterThan */:\r\n                    partContent += '&gt;';\r\n                    break;\r\n                case 38 /* Ampersand */:\r\n                    partContent += '&amp;';\r\n                    break;\r\n                case 0 /* Null */:\r\n                    partContent += '&#00;';\r\n                    break;\r\n                case 65279 /* UTF8_BOM */:\r\n                case 8232 /* LINE_SEPARATOR_2028 */:\r\n                    partContent += '\\ufffd';\r\n                    break;\r\n                case 13 /* CarriageReturn */:\r\n                    // zero width space, because carriage return would introduce a line break\r\n                    partContent += '&#8203';\r\n                    break;\r\n                case 32 /* Space */:\r\n                    partContent += useNbsp ? '&#160;' : ' ';\r\n                    break;\r\n                default:\r\n                    partContent += String.fromCharCode(charCode);\r\n            }\r\n        }\r\n        result += \"<span style=\\\"\" + viewLineTokens.getInlineStyle(tokenIndex, colorMap) + \"\\\">\" + partContent + \"</span>\";\r\n        if (tokenEndIndex > endOffset || charIndex >= endOffset) {\r\n            break;\r\n        }\r\n    }\r\n    result += \"</div>\";\r\n    return result;\r\n}\r\nfunction _tokenizeToString(text, tokenizationSupport) {\r\n    var result = \"<div class=\\\"monaco-tokenized-source\\\">\";\r\n    var lines = text.split(/\\r\\n|\\r|\\n/);\r\n    var currentState = tokenizationSupport.getInitialState();\r\n    for (var i = 0, len = lines.length; i < len; i++) {\r\n        var line = lines[i];\r\n        if (i > 0) {\r\n            result += \"<br/>\";\r\n        }\r\n        var tokenizationResult = tokenizationSupport.tokenize2(line, currentState, 0);\r\n        LineTokens.convertToEndOffset(tokenizationResult.tokens, line.length);\r\n        var lineTokens = new LineTokens(tokenizationResult.tokens, line);\r\n        var viewLineTokens = lineTokens.inflate();\r\n        var startOffset = 0;\r\n        for (var j = 0, lenJ = viewLineTokens.getCount(); j < lenJ; j++) {\r\n            var type = viewLineTokens.getClassName(j);\r\n            var endIndex = viewLineTokens.getEndOffset(j);\r\n            result += \"<span class=\\\"\" + type + \"\\\">\" + strings.escape(line.substring(startOffset, endIndex)) + \"</span>\";\r\n            startOffset = endIndex;\r\n        }\r\n        currentState = tokenizationResult.endState;\r\n    }\r\n    result += \"</div>\";\r\n    return result;\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { CharacterClassifier } from '../core/characterClassifier.js';\r\nvar Uint8Matrix = /** @class */ (function () {\r\n    function Uint8Matrix(rows, cols, defaultValue) {\r\n        var data = new Uint8Array(rows * cols);\r\n        for (var i = 0, len = rows * cols; i < len; i++) {\r\n            data[i] = defaultValue;\r\n        }\r\n        this._data = data;\r\n        this.rows = rows;\r\n        this.cols = cols;\r\n    }\r\n    Uint8Matrix.prototype.get = function (row, col) {\r\n        return this._data[row * this.cols + col];\r\n    };\r\n    Uint8Matrix.prototype.set = function (row, col, value) {\r\n        this._data[row * this.cols + col] = value;\r\n    };\r\n    return Uint8Matrix;\r\n}());\r\nexport { Uint8Matrix };\r\nvar StateMachine = /** @class */ (function () {\r\n    function StateMachine(edges) {\r\n        var maxCharCode = 0;\r\n        var maxState = 0 /* Invalid */;\r\n        for (var i = 0, len = edges.length; i < len; i++) {\r\n            var _a = edges[i], from = _a[0], chCode = _a[1], to = _a[2];\r\n            if (chCode > maxCharCode) {\r\n                maxCharCode = chCode;\r\n            }\r\n            if (from > maxState) {\r\n                maxState = from;\r\n            }\r\n            if (to > maxState) {\r\n                maxState = to;\r\n            }\r\n        }\r\n        maxCharCode++;\r\n        maxState++;\r\n        var states = new Uint8Matrix(maxState, maxCharCode, 0 /* Invalid */);\r\n        for (var i = 0, len = edges.length; i < len; i++) {\r\n            var _b = edges[i], from = _b[0], chCode = _b[1], to = _b[2];\r\n            states.set(from, chCode, to);\r\n        }\r\n        this._states = states;\r\n        this._maxCharCode = maxCharCode;\r\n    }\r\n    StateMachine.prototype.nextState = function (currentState, chCode) {\r\n        if (chCode < 0 || chCode >= this._maxCharCode) {\r\n            return 0 /* Invalid */;\r\n        }\r\n        return this._states.get(currentState, chCode);\r\n    };\r\n    return StateMachine;\r\n}());\r\nexport { StateMachine };\r\n// State machine for http:// or https:// or file://\r\nvar _stateMachine = null;\r\nfunction getStateMachine() {\r\n    if (_stateMachine === null) {\r\n        _stateMachine = new StateMachine([\r\n            [1 /* Start */, 104 /* h */, 2 /* H */],\r\n            [1 /* Start */, 72 /* H */, 2 /* H */],\r\n            [1 /* Start */, 102 /* f */, 6 /* F */],\r\n            [1 /* Start */, 70 /* F */, 6 /* F */],\r\n            [2 /* H */, 116 /* t */, 3 /* HT */],\r\n            [2 /* H */, 84 /* T */, 3 /* HT */],\r\n            [3 /* HT */, 116 /* t */, 4 /* HTT */],\r\n            [3 /* HT */, 84 /* T */, 4 /* HTT */],\r\n            [4 /* HTT */, 112 /* p */, 5 /* HTTP */],\r\n            [4 /* HTT */, 80 /* P */, 5 /* HTTP */],\r\n            [5 /* HTTP */, 115 /* s */, 9 /* BeforeColon */],\r\n            [5 /* HTTP */, 83 /* S */, 9 /* BeforeColon */],\r\n            [5 /* HTTP */, 58 /* Colon */, 10 /* AfterColon */],\r\n            [6 /* F */, 105 /* i */, 7 /* FI */],\r\n            [6 /* F */, 73 /* I */, 7 /* FI */],\r\n            [7 /* FI */, 108 /* l */, 8 /* FIL */],\r\n            [7 /* FI */, 76 /* L */, 8 /* FIL */],\r\n            [8 /* FIL */, 101 /* e */, 9 /* BeforeColon */],\r\n            [8 /* FIL */, 69 /* E */, 9 /* BeforeColon */],\r\n            [9 /* BeforeColon */, 58 /* Colon */, 10 /* AfterColon */],\r\n            [10 /* AfterColon */, 47 /* Slash */, 11 /* AlmostThere */],\r\n            [11 /* AlmostThere */, 47 /* Slash */, 12 /* End */],\r\n        ]);\r\n    }\r\n    return _stateMachine;\r\n}\r\nvar _classifier = null;\r\nfunction getClassifier() {\r\n    if (_classifier === null) {\r\n        _classifier = new CharacterClassifier(0 /* None */);\r\n        var FORCE_TERMINATION_CHARACTERS = ' \\t<>\\'\\\"';\r\n        for (var i = 0; i < FORCE_TERMINATION_CHARACTERS.length; i++) {\r\n            _classifier.set(FORCE_TERMINATION_CHARACTERS.charCodeAt(i), 1 /* ForceTermination */);\r\n        }\r\n        var CANNOT_END_WITH_CHARACTERS = '.,;';\r\n        for (var i = 0; i < CANNOT_END_WITH_CHARACTERS.length; i++) {\r\n            _classifier.set(CANNOT_END_WITH_CHARACTERS.charCodeAt(i), 2 /* CannotEndIn */);\r\n        }\r\n    }\r\n    return _classifier;\r\n}\r\nvar LinkComputer = /** @class */ (function () {\r\n    function LinkComputer() {\r\n    }\r\n    LinkComputer._createLink = function (classifier, line, lineNumber, linkBeginIndex, linkEndIndex) {\r\n        // Do not allow to end link in certain characters...\r\n        var lastIncludedCharIndex = linkEndIndex - 1;\r\n        do {\r\n            var chCode = line.charCodeAt(lastIncludedCharIndex);\r\n            var chClass = classifier.get(chCode);\r\n            if (chClass !== 2 /* CannotEndIn */) {\r\n                break;\r\n            }\r\n            lastIncludedCharIndex--;\r\n        } while (lastIncludedCharIndex > linkBeginIndex);\r\n        // Handle links enclosed in parens, square brackets and curlys.\r\n        if (linkBeginIndex > 0) {\r\n            var charCodeBeforeLink = line.charCodeAt(linkBeginIndex - 1);\r\n            var lastCharCodeInLink = line.charCodeAt(lastIncludedCharIndex);\r\n            if ((charCodeBeforeLink === 40 /* OpenParen */ && lastCharCodeInLink === 41 /* CloseParen */)\r\n                || (charCodeBeforeLink === 91 /* OpenSquareBracket */ && lastCharCodeInLink === 93 /* CloseSquareBracket */)\r\n                || (charCodeBeforeLink === 123 /* OpenCurlyBrace */ && lastCharCodeInLink === 125 /* CloseCurlyBrace */)) {\r\n                // Do not end in ) if ( is before the link start\r\n                // Do not end in ] if [ is before the link start\r\n                // Do not end in } if { is before the link start\r\n                lastIncludedCharIndex--;\r\n            }\r\n        }\r\n        return {\r\n            range: {\r\n                startLineNumber: lineNumber,\r\n                startColumn: linkBeginIndex + 1,\r\n                endLineNumber: lineNumber,\r\n                endColumn: lastIncludedCharIndex + 2\r\n            },\r\n            url: line.substring(linkBeginIndex, lastIncludedCharIndex + 1)\r\n        };\r\n    };\r\n    LinkComputer.computeLinks = function (model, stateMachine) {\r\n        if (stateMachine === void 0) { stateMachine = getStateMachine(); }\r\n        var classifier = getClassifier();\r\n        var result = [];\r\n        for (var i = 1, lineCount = model.getLineCount(); i <= lineCount; i++) {\r\n            var line = model.getLineContent(i);\r\n            var len = line.length;\r\n            var j = 0;\r\n            var linkBeginIndex = 0;\r\n            var linkBeginChCode = 0;\r\n            var state = 1 /* Start */;\r\n            var hasOpenParens = false;\r\n            var hasOpenSquareBracket = false;\r\n            var hasOpenCurlyBracket = false;\r\n            while (j < len) {\r\n                var resetStateMachine = false;\r\n                var chCode = line.charCodeAt(j);\r\n                if (state === 13 /* Accept */) {\r\n                    var chClass = void 0;\r\n                    switch (chCode) {\r\n                        case 40 /* OpenParen */:\r\n                            hasOpenParens = true;\r\n                            chClass = 0 /* None */;\r\n                            break;\r\n                        case 41 /* CloseParen */:\r\n                            chClass = (hasOpenParens ? 0 /* None */ : 1 /* ForceTermination */);\r\n                            break;\r\n                        case 91 /* OpenSquareBracket */:\r\n                            hasOpenSquareBracket = true;\r\n                            chClass = 0 /* None */;\r\n                            break;\r\n                        case 93 /* CloseSquareBracket */:\r\n                            chClass = (hasOpenSquareBracket ? 0 /* None */ : 1 /* ForceTermination */);\r\n                            break;\r\n                        case 123 /* OpenCurlyBrace */:\r\n                            hasOpenCurlyBracket = true;\r\n                            chClass = 0 /* None */;\r\n                            break;\r\n                        case 125 /* CloseCurlyBrace */:\r\n                            chClass = (hasOpenCurlyBracket ? 0 /* None */ : 1 /* ForceTermination */);\r\n                            break;\r\n                        /* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\r\n                        case 39 /* SingleQuote */:\r\n                            chClass = (linkBeginChCode === 34 /* DoubleQuote */ || linkBeginChCode === 96 /* BackTick */) ? 0 /* None */ : 1 /* ForceTermination */;\r\n                            break;\r\n                        case 34 /* DoubleQuote */:\r\n                            chClass = (linkBeginChCode === 39 /* SingleQuote */ || linkBeginChCode === 96 /* BackTick */) ? 0 /* None */ : 1 /* ForceTermination */;\r\n                            break;\r\n                        case 96 /* BackTick */:\r\n                            chClass = (linkBeginChCode === 39 /* SingleQuote */ || linkBeginChCode === 34 /* DoubleQuote */) ? 0 /* None */ : 1 /* ForceTermination */;\r\n                            break;\r\n                        case 42 /* Asterisk */:\r\n                            // `*` terminates a link if the link began with `*`\r\n                            chClass = (linkBeginChCode === 42 /* Asterisk */) ? 1 /* ForceTermination */ : 0 /* None */;\r\n                            break;\r\n                        case 124 /* Pipe */:\r\n                            // `|` terminates a link if the link began with `|`\r\n                            chClass = (linkBeginChCode === 124 /* Pipe */) ? 1 /* ForceTermination */ : 0 /* None */;\r\n                            break;\r\n                        default:\r\n                            chClass = classifier.get(chCode);\r\n                    }\r\n                    // Check if character terminates link\r\n                    if (chClass === 1 /* ForceTermination */) {\r\n                        result.push(LinkComputer._createLink(classifier, line, i, linkBeginIndex, j));\r\n                        resetStateMachine = true;\r\n                    }\r\n                }\r\n                else if (state === 12 /* End */) {\r\n                    var chClass = void 0;\r\n                    if (chCode === 91 /* OpenSquareBracket */) {\r\n                        // Allow for the authority part to contain ipv6 addresses which contain [ and ]\r\n                        hasOpenSquareBracket = true;\r\n                        chClass = 0 /* None */;\r\n                    }\r\n                    else {\r\n                        chClass = classifier.get(chCode);\r\n                    }\r\n                    // Check if character terminates link\r\n                    if (chClass === 1 /* ForceTermination */) {\r\n                        resetStateMachine = true;\r\n                    }\r\n                    else {\r\n                        state = 13 /* Accept */;\r\n                    }\r\n                }\r\n                else {\r\n                    state = stateMachine.nextState(state, chCode);\r\n                    if (state === 0 /* Invalid */) {\r\n                        resetStateMachine = true;\r\n                    }\r\n                }\r\n                if (resetStateMachine) {\r\n                    state = 1 /* Start */;\r\n                    hasOpenParens = false;\r\n                    hasOpenSquareBracket = false;\r\n                    hasOpenCurlyBracket = false;\r\n                    // Record where the link started\r\n                    linkBeginIndex = j + 1;\r\n                    linkBeginChCode = chCode;\r\n                }\r\n                j++;\r\n            }\r\n            if (state === 13 /* Accept */) {\r\n                result.push(LinkComputer._createLink(classifier, line, i, linkBeginIndex, len));\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    return LinkComputer;\r\n}());\r\nexport { LinkComputer };\r\n/**\r\n * Returns an array of all links contains in the provided\r\n * document. *Note* that this operation is computational\r\n * expensive and should not run in the UI thread.\r\n */\r\nexport function computeLinks(model) {\r\n    if (!model || typeof model.getLineCount !== 'function' || typeof model.getLineContent !== 'function') {\r\n        // Unknown caller!\r\n        return [];\r\n    }\r\n    return LinkComputer.computeLinks(model);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar BasicInplaceReplace = /** @class */ (function () {\r\n    function BasicInplaceReplace() {\r\n        this._defaultValueSet = [\r\n            ['true', 'false'],\r\n            ['True', 'False'],\r\n            ['Private', 'Public', 'Friend', 'ReadOnly', 'Partial', 'Protected', 'WriteOnly'],\r\n            ['public', 'protected', 'private'],\r\n        ];\r\n    }\r\n    BasicInplaceReplace.prototype.navigateValueSet = function (range1, text1, range2, text2, up) {\r\n        if (range1 && text1) {\r\n            var result = this.doNavigateValueSet(text1, up);\r\n            if (result) {\r\n                return {\r\n                    range: range1,\r\n                    value: result\r\n                };\r\n            }\r\n        }\r\n        if (range2 && text2) {\r\n            var result = this.doNavigateValueSet(text2, up);\r\n            if (result) {\r\n                return {\r\n                    range: range2,\r\n                    value: result\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    BasicInplaceReplace.prototype.doNavigateValueSet = function (text, up) {\r\n        var numberResult = this.numberReplace(text, up);\r\n        if (numberResult !== null) {\r\n            return numberResult;\r\n        }\r\n        return this.textReplace(text, up);\r\n    };\r\n    BasicInplaceReplace.prototype.numberReplace = function (value, up) {\r\n        var precision = Math.pow(10, value.length - (value.lastIndexOf('.') + 1));\r\n        var n1 = Number(value);\r\n        var n2 = parseFloat(value);\r\n        if (!isNaN(n1) && !isNaN(n2) && n1 === n2) {\r\n            if (n1 === 0 && !up) {\r\n                return null; // don't do negative\r\n                //\t\t\t} else if(n1 === 9 && up) {\r\n                //\t\t\t\treturn null; // don't insert 10 into a number\r\n            }\r\n            else {\r\n                n1 = Math.floor(n1 * precision);\r\n                n1 += up ? precision : -precision;\r\n                return String(n1 / precision);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    BasicInplaceReplace.prototype.textReplace = function (value, up) {\r\n        return this.valueSetsReplace(this._defaultValueSet, value, up);\r\n    };\r\n    BasicInplaceReplace.prototype.valueSetsReplace = function (valueSets, value, up) {\r\n        var result = null;\r\n        for (var i = 0, len = valueSets.length; result === null && i < len; i++) {\r\n            result = this.valueSetReplace(valueSets[i], value, up);\r\n        }\r\n        return result;\r\n    };\r\n    BasicInplaceReplace.prototype.valueSetReplace = function (valueSet, value, up) {\r\n        var idx = valueSet.indexOf(value);\r\n        if (idx >= 0) {\r\n            idx += up ? +1 : -1;\r\n            if (idx < 0) {\r\n                idx = valueSet.length - 1;\r\n            }\r\n            else {\r\n                idx %= valueSet.length;\r\n            }\r\n            return valueSet[idx];\r\n        }\r\n        return null;\r\n    };\r\n    BasicInplaceReplace.INSTANCE = new BasicInplaceReplace();\r\n    return BasicInplaceReplace;\r\n}());\r\nexport { BasicInplaceReplace };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { mergeSort } from '../../../base/common/arrays.js';\r\nimport { stringDiff } from '../../../base/common/diff/diff.js';\r\nimport { FIN } from '../../../base/common/iterator.js';\r\nimport { globals } from '../../../base/common/platform.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { Position } from '../core/position.js';\r\nimport { Range } from '../core/range.js';\r\nimport { DiffComputer } from '../diff/diffComputer.js';\r\nimport { MirrorTextModel as BaseMirrorModel } from '../model/mirrorTextModel.js';\r\nimport { ensureValidWordDefinition, getWordAtText } from '../model/wordHelper.js';\r\nimport { computeLinks } from '../modes/linkComputer.js';\r\nimport { BasicInplaceReplace } from '../modes/supports/inplaceReplaceSupport.js';\r\nimport { createMonacoBaseAPI } from '../standalone/standaloneBase.js';\r\nimport * as types from '../../../base/common/types.js';\r\n/**\r\n * @internal\r\n */\r\nvar MirrorModel = /** @class */ (function (_super) {\r\n    __extends(MirrorModel, _super);\r\n    function MirrorModel() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Object.defineProperty(MirrorModel.prototype, \"uri\", {\r\n        get: function () {\r\n            return this._uri;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MirrorModel.prototype, \"version\", {\r\n        get: function () {\r\n            return this._versionId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MirrorModel.prototype, \"eol\", {\r\n        get: function () {\r\n            return this._eol;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    MirrorModel.prototype.getValue = function () {\r\n        return this.getText();\r\n    };\r\n    MirrorModel.prototype.getLinesContent = function () {\r\n        return this._lines.slice(0);\r\n    };\r\n    MirrorModel.prototype.getLineCount = function () {\r\n        return this._lines.length;\r\n    };\r\n    MirrorModel.prototype.getLineContent = function (lineNumber) {\r\n        return this._lines[lineNumber - 1];\r\n    };\r\n    MirrorModel.prototype.getWordAtPosition = function (position, wordDefinition) {\r\n        var wordAtText = getWordAtText(position.column, ensureValidWordDefinition(wordDefinition), this._lines[position.lineNumber - 1], 0);\r\n        if (wordAtText) {\r\n            return new Range(position.lineNumber, wordAtText.startColumn, position.lineNumber, wordAtText.endColumn);\r\n        }\r\n        return null;\r\n    };\r\n    MirrorModel.prototype.createWordIterator = function (wordDefinition) {\r\n        var _this = this;\r\n        var obj;\r\n        var lineNumber = 0;\r\n        var lineText;\r\n        var wordRangesIdx = 0;\r\n        var wordRanges = [];\r\n        var next = function () {\r\n            if (wordRangesIdx < wordRanges.length) {\r\n                var value = lineText.substring(wordRanges[wordRangesIdx].start, wordRanges[wordRangesIdx].end);\r\n                wordRangesIdx += 1;\r\n                if (!obj) {\r\n                    obj = { done: false, value: value };\r\n                }\r\n                else {\r\n                    obj.value = value;\r\n                }\r\n                return obj;\r\n            }\r\n            else if (lineNumber >= _this._lines.length) {\r\n                return FIN;\r\n            }\r\n            else {\r\n                lineText = _this._lines[lineNumber];\r\n                wordRanges = _this._wordenize(lineText, wordDefinition);\r\n                wordRangesIdx = 0;\r\n                lineNumber += 1;\r\n                return next();\r\n            }\r\n        };\r\n        return { next: next };\r\n    };\r\n    MirrorModel.prototype.getLineWords = function (lineNumber, wordDefinition) {\r\n        var content = this._lines[lineNumber - 1];\r\n        var ranges = this._wordenize(content, wordDefinition);\r\n        var words = [];\r\n        for (var _i = 0, ranges_1 = ranges; _i < ranges_1.length; _i++) {\r\n            var range = ranges_1[_i];\r\n            words.push({\r\n                word: content.substring(range.start, range.end),\r\n                startColumn: range.start + 1,\r\n                endColumn: range.end + 1\r\n            });\r\n        }\r\n        return words;\r\n    };\r\n    MirrorModel.prototype._wordenize = function (content, wordDefinition) {\r\n        var result = [];\r\n        var match;\r\n        wordDefinition.lastIndex = 0; // reset lastIndex just to be sure\r\n        while (match = wordDefinition.exec(content)) {\r\n            if (match[0].length === 0) {\r\n                // it did match the empty string\r\n                break;\r\n            }\r\n            result.push({ start: match.index, end: match.index + match[0].length });\r\n        }\r\n        return result;\r\n    };\r\n    MirrorModel.prototype.getValueInRange = function (range) {\r\n        range = this._validateRange(range);\r\n        if (range.startLineNumber === range.endLineNumber) {\r\n            return this._lines[range.startLineNumber - 1].substring(range.startColumn - 1, range.endColumn - 1);\r\n        }\r\n        var lineEnding = this._eol;\r\n        var startLineIndex = range.startLineNumber - 1;\r\n        var endLineIndex = range.endLineNumber - 1;\r\n        var resultLines = [];\r\n        resultLines.push(this._lines[startLineIndex].substring(range.startColumn - 1));\r\n        for (var i = startLineIndex + 1; i < endLineIndex; i++) {\r\n            resultLines.push(this._lines[i]);\r\n        }\r\n        resultLines.push(this._lines[endLineIndex].substring(0, range.endColumn - 1));\r\n        return resultLines.join(lineEnding);\r\n    };\r\n    MirrorModel.prototype.offsetAt = function (position) {\r\n        position = this._validatePosition(position);\r\n        this._ensureLineStarts();\r\n        return this._lineStarts.getAccumulatedValue(position.lineNumber - 2) + (position.column - 1);\r\n    };\r\n    MirrorModel.prototype.positionAt = function (offset) {\r\n        offset = Math.floor(offset);\r\n        offset = Math.max(0, offset);\r\n        this._ensureLineStarts();\r\n        var out = this._lineStarts.getIndexOf(offset);\r\n        var lineLength = this._lines[out.index].length;\r\n        // Ensure we return a valid position\r\n        return {\r\n            lineNumber: 1 + out.index,\r\n            column: 1 + Math.min(out.remainder, lineLength)\r\n        };\r\n    };\r\n    MirrorModel.prototype._validateRange = function (range) {\r\n        var start = this._validatePosition({ lineNumber: range.startLineNumber, column: range.startColumn });\r\n        var end = this._validatePosition({ lineNumber: range.endLineNumber, column: range.endColumn });\r\n        if (start.lineNumber !== range.startLineNumber\r\n            || start.column !== range.startColumn\r\n            || end.lineNumber !== range.endLineNumber\r\n            || end.column !== range.endColumn) {\r\n            return {\r\n                startLineNumber: start.lineNumber,\r\n                startColumn: start.column,\r\n                endLineNumber: end.lineNumber,\r\n                endColumn: end.column\r\n            };\r\n        }\r\n        return range;\r\n    };\r\n    MirrorModel.prototype._validatePosition = function (position) {\r\n        if (!Position.isIPosition(position)) {\r\n            throw new Error('bad position');\r\n        }\r\n        var lineNumber = position.lineNumber, column = position.column;\r\n        var hasChanged = false;\r\n        if (lineNumber < 1) {\r\n            lineNumber = 1;\r\n            column = 1;\r\n            hasChanged = true;\r\n        }\r\n        else if (lineNumber > this._lines.length) {\r\n            lineNumber = this._lines.length;\r\n            column = this._lines[lineNumber - 1].length + 1;\r\n            hasChanged = true;\r\n        }\r\n        else {\r\n            var maxCharacter = this._lines[lineNumber - 1].length + 1;\r\n            if (column < 1) {\r\n                column = 1;\r\n                hasChanged = true;\r\n            }\r\n            else if (column > maxCharacter) {\r\n                column = maxCharacter;\r\n                hasChanged = true;\r\n            }\r\n        }\r\n        if (!hasChanged) {\r\n            return position;\r\n        }\r\n        else {\r\n            return { lineNumber: lineNumber, column: column };\r\n        }\r\n    };\r\n    return MirrorModel;\r\n}(BaseMirrorModel));\r\n/**\r\n * @internal\r\n */\r\nvar EditorSimpleWorker = /** @class */ (function () {\r\n    function EditorSimpleWorker(host, foreignModuleFactory) {\r\n        this._host = host;\r\n        this._models = Object.create(null);\r\n        this._foreignModuleFactory = foreignModuleFactory;\r\n        this._foreignModule = null;\r\n    }\r\n    EditorSimpleWorker.prototype.dispose = function () {\r\n        this._models = Object.create(null);\r\n    };\r\n    EditorSimpleWorker.prototype._getModel = function (uri) {\r\n        return this._models[uri];\r\n    };\r\n    EditorSimpleWorker.prototype._getModels = function () {\r\n        var _this = this;\r\n        var all = [];\r\n        Object.keys(this._models).forEach(function (key) { return all.push(_this._models[key]); });\r\n        return all;\r\n    };\r\n    EditorSimpleWorker.prototype.acceptNewModel = function (data) {\r\n        this._models[data.url] = new MirrorModel(URI.parse(data.url), data.lines, data.EOL, data.versionId);\r\n    };\r\n    EditorSimpleWorker.prototype.acceptModelChanged = function (strURL, e) {\r\n        if (!this._models[strURL]) {\r\n            return;\r\n        }\r\n        var model = this._models[strURL];\r\n        model.onEvents(e);\r\n    };\r\n    EditorSimpleWorker.prototype.acceptRemovedModel = function (strURL) {\r\n        if (!this._models[strURL]) {\r\n            return;\r\n        }\r\n        delete this._models[strURL];\r\n    };\r\n    // ---- BEGIN diff --------------------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.computeDiff = function (originalUrl, modifiedUrl, ignoreTrimWhitespace, maxComputationTime) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var original, modified, originalLines, modifiedLines, diffComputer, diffResult, identical;\r\n            return __generator(this, function (_a) {\r\n                original = this._getModel(originalUrl);\r\n                modified = this._getModel(modifiedUrl);\r\n                if (!original || !modified) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                originalLines = original.getLinesContent();\r\n                modifiedLines = modified.getLinesContent();\r\n                diffComputer = new DiffComputer(originalLines, modifiedLines, {\r\n                    shouldComputeCharChanges: true,\r\n                    shouldPostProcessCharChanges: true,\r\n                    shouldIgnoreTrimWhitespace: ignoreTrimWhitespace,\r\n                    shouldMakePrettyDiff: true,\r\n                    maxComputationTime: maxComputationTime\r\n                });\r\n                diffResult = diffComputer.computeDiff();\r\n                identical = (diffResult.changes.length > 0 ? false : this._modelsAreIdentical(original, modified));\r\n                return [2 /*return*/, {\r\n                        quitEarly: diffResult.quitEarly,\r\n                        identical: identical,\r\n                        changes: diffResult.changes\r\n                    }];\r\n            });\r\n        });\r\n    };\r\n    EditorSimpleWorker.prototype._modelsAreIdentical = function (original, modified) {\r\n        var originalLineCount = original.getLineCount();\r\n        var modifiedLineCount = modified.getLineCount();\r\n        if (originalLineCount !== modifiedLineCount) {\r\n            return false;\r\n        }\r\n        for (var line = 1; line <= originalLineCount; line++) {\r\n            var originalLine = original.getLineContent(line);\r\n            var modifiedLine = modified.getLineContent(line);\r\n            if (originalLine !== modifiedLine) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    EditorSimpleWorker.prototype.computeMoreMinimalEdits = function (modelUrl, edits) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, result, lastEol, _i, edits_1, _a, range, text, eol, original, changes, editOffset, _b, changes_1, change, start, end, newEdit;\r\n            return __generator(this, function (_c) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, edits];\r\n                }\r\n                result = [];\r\n                lastEol = undefined;\r\n                edits = mergeSort(edits, function (a, b) {\r\n                    if (a.range && b.range) {\r\n                        return Range.compareRangesUsingStarts(a.range, b.range);\r\n                    }\r\n                    // eol only changes should go to the end\r\n                    var aRng = a.range ? 0 : 1;\r\n                    var bRng = b.range ? 0 : 1;\r\n                    return aRng - bRng;\r\n                });\r\n                for (_i = 0, edits_1 = edits; _i < edits_1.length; _i++) {\r\n                    _a = edits_1[_i], range = _a.range, text = _a.text, eol = _a.eol;\r\n                    if (typeof eol === 'number') {\r\n                        lastEol = eol;\r\n                    }\r\n                    if (Range.isEmpty(range) && !text) {\r\n                        // empty change\r\n                        continue;\r\n                    }\r\n                    original = model.getValueInRange(range);\r\n                    text = text.replace(/\\r\\n|\\n|\\r/g, model.eol);\r\n                    if (original === text) {\r\n                        // noop\r\n                        continue;\r\n                    }\r\n                    // make sure diff won't take too long\r\n                    if (Math.max(text.length, original.length) > EditorSimpleWorker._diffLimit) {\r\n                        result.push({ range: range, text: text });\r\n                        continue;\r\n                    }\r\n                    changes = stringDiff(original, text, false);\r\n                    editOffset = model.offsetAt(Range.lift(range).getStartPosition());\r\n                    for (_b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\r\n                        change = changes_1[_b];\r\n                        start = model.positionAt(editOffset + change.originalStart);\r\n                        end = model.positionAt(editOffset + change.originalStart + change.originalLength);\r\n                        newEdit = {\r\n                            text: text.substr(change.modifiedStart, change.modifiedLength),\r\n                            range: { startLineNumber: start.lineNumber, startColumn: start.column, endLineNumber: end.lineNumber, endColumn: end.column }\r\n                        };\r\n                        if (model.getValueInRange(newEdit.range) !== newEdit.text) {\r\n                            result.push(newEdit);\r\n                        }\r\n                    }\r\n                }\r\n                if (typeof lastEol === 'number') {\r\n                    result.push({ eol: lastEol, text: '', range: { startLineNumber: 0, startColumn: 0, endLineNumber: 0, endColumn: 0 } });\r\n                }\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    // ---- END minimal edits ---------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.computeLinks = function (modelUrl) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                return [2 /*return*/, computeLinks(model)];\r\n            });\r\n        });\r\n    };\r\n    EditorSimpleWorker.prototype.textualSuggest = function (modelUrl, position, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, words, seen, wordDefRegExp, wordAt, iter, e, word;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                words = [];\r\n                seen = new Set();\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                wordAt = model.getWordAtPosition(position, wordDefRegExp);\r\n                if (wordAt) {\r\n                    seen.add(model.getValueInRange(wordAt));\r\n                }\r\n                for (iter = model.createWordIterator(wordDefRegExp), e = iter.next(); !e.done && seen.size <= EditorSimpleWorker._suggestionsLimit; e = iter.next()) {\r\n                    word = e.value;\r\n                    if (seen.has(word)) {\r\n                        continue;\r\n                    }\r\n                    seen.add(word);\r\n                    if (!isNaN(Number(word))) {\r\n                        continue;\r\n                    }\r\n                    words.push(word);\r\n                }\r\n                return [2 /*return*/, words];\r\n            });\r\n        });\r\n    };\r\n    // ---- END suggest --------------------------------------------------------------------------\r\n    //#region -- word ranges --\r\n    EditorSimpleWorker.prototype.computeWordRanges = function (modelUrl, range, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, wordDefRegExp, result, line, words, _i, words_1, word, array;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, Object.create(null)];\r\n                }\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                result = Object.create(null);\r\n                for (line = range.startLineNumber; line < range.endLineNumber; line++) {\r\n                    words = model.getLineWords(line, wordDefRegExp);\r\n                    for (_i = 0, words_1 = words; _i < words_1.length; _i++) {\r\n                        word = words_1[_i];\r\n                        if (!isNaN(Number(word.word))) {\r\n                            continue;\r\n                        }\r\n                        array = result[word.word];\r\n                        if (!array) {\r\n                            array = [];\r\n                            result[word.word] = array;\r\n                        }\r\n                        array.push({\r\n                            startLineNumber: line,\r\n                            startColumn: word.startColumn,\r\n                            endLineNumber: line,\r\n                            endColumn: word.endColumn\r\n                        });\r\n                    }\r\n                }\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    //#endregion\r\n    EditorSimpleWorker.prototype.navigateValueSet = function (modelUrl, range, up, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, wordDefRegExp, selectionText, wordRange, word, result;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                if (range.startColumn === range.endColumn) {\r\n                    range = {\r\n                        startLineNumber: range.startLineNumber,\r\n                        startColumn: range.startColumn,\r\n                        endLineNumber: range.endLineNumber,\r\n                        endColumn: range.endColumn + 1\r\n                    };\r\n                }\r\n                selectionText = model.getValueInRange(range);\r\n                wordRange = model.getWordAtPosition({ lineNumber: range.startLineNumber, column: range.startColumn }, wordDefRegExp);\r\n                if (!wordRange) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                word = model.getValueInRange(wordRange);\r\n                result = BasicInplaceReplace.INSTANCE.navigateValueSet(range, selectionText, wordRange, word, up);\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    // ---- BEGIN foreign module support --------------------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.loadForeignModule = function (moduleId, createData, foreignHostMethods) {\r\n        var _this = this;\r\n        var proxyMethodRequest = function (method, args) {\r\n            return _this._host.fhr(method, args);\r\n        };\r\n        var foreignHost = types.createProxyObject(foreignHostMethods, proxyMethodRequest);\r\n        var ctx = {\r\n            host: foreignHost,\r\n            getMirrorModels: function () {\r\n                return _this._getModels();\r\n            }\r\n        };\r\n        if (this._foreignModuleFactory) {\r\n            this._foreignModule = this._foreignModuleFactory(ctx, createData);\r\n            // static foreing module\r\n            return Promise.resolve(types.getAllMethodNames(this._foreignModule));\r\n        }\r\n        // ESM-comment-begin\r\n        // \t\treturn new Promise<any>((resolve, reject) => {\r\n        // \t\t\trequire([moduleId], (foreignModule: { create: IForeignModuleFactory }) => {\r\n        // \t\t\t\tthis._foreignModule = foreignModule.create(ctx, createData);\r\n        // \r\n        // \t\t\t\tresolve(types.getAllMethodNames(this._foreignModule));\r\n        // \r\n        // \t\t\t}, reject);\r\n        // \t\t});\r\n        // ESM-comment-end\r\n        // ESM-uncomment-begin\r\n        return Promise.reject(new Error(\"Unexpected usage\"));\r\n        // ESM-uncomment-end\r\n    };\r\n    // foreign method request\r\n    EditorSimpleWorker.prototype.fmr = function (method, args) {\r\n        if (!this._foreignModule || typeof this._foreignModule[method] !== 'function') {\r\n            return Promise.reject(new Error('Missing requestHandler or method: ' + method));\r\n        }\r\n        try {\r\n            return Promise.resolve(this._foreignModule[method].apply(this._foreignModule, args));\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    };\r\n    // ---- END diff --------------------------------------------------------------------------\r\n    // ---- BEGIN minimal edits ---------------------------------------------------------------\r\n    EditorSimpleWorker._diffLimit = 100000;\r\n    // ---- BEGIN suggest --------------------------------------------------------------------------\r\n    EditorSimpleWorker._suggestionsLimit = 10000;\r\n    return EditorSimpleWorker;\r\n}());\r\nexport { EditorSimpleWorker };\r\n/**\r\n * Called on the worker side\r\n * @internal\r\n */\r\nexport function create(host) {\r\n    return new EditorSimpleWorker(host, null);\r\n}\r\nif (typeof importScripts === 'function') {\r\n    // Running in a web worker\r\n    globals.monaco = createMonacoBaseAPI();\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { IntervalTimer } from '../../../base/common/async.js';\r\nimport { Disposable, dispose, toDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { SimpleWorkerClient, logOnceWebWorkerWarning } from '../../../base/common/worker/simpleWorker.js';\r\nimport { DefaultWorkerFactory } from '../../../base/worker/defaultWorkerFactory.js';\r\nimport { Range } from '../core/range.js';\r\nimport * as modes from '../modes.js';\r\nimport { LanguageConfigurationRegistry } from '../modes/languageConfigurationRegistry.js';\r\nimport { EditorSimpleWorker } from './editorSimpleWorker.js';\r\nimport { IModelService } from './modelService.js';\r\nimport { ITextResourceConfigurationService } from './textResourceConfigurationService.js';\r\nimport { regExpFlags } from '../../../base/common/strings.js';\r\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\r\nimport { ILogService } from '../../../platform/log/common/log.js';\r\nimport { StopWatch } from '../../../base/common/stopwatch.js';\r\n/**\r\n * Stop syncing a model to the worker if it was not needed for 1 min.\r\n */\r\nvar STOP_SYNC_MODEL_DELTA_TIME_MS = 60 * 1000;\r\n/**\r\n * Stop the worker if it was not needed for 5 min.\r\n */\r\nvar STOP_WORKER_DELTA_TIME_MS = 5 * 60 * 1000;\r\nfunction canSyncModel(modelService, resource) {\r\n    var model = modelService.getModel(resource);\r\n    if (!model) {\r\n        return false;\r\n    }\r\n    if (model.isTooLargeForSyncing()) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\nvar EditorWorkerServiceImpl = /** @class */ (function (_super) {\r\n    __extends(EditorWorkerServiceImpl, _super);\r\n    function EditorWorkerServiceImpl(modelService, configurationService, logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._modelService = modelService;\r\n        _this._workerManager = _this._register(new WorkerManager(_this._modelService));\r\n        _this._logService = logService;\r\n        // todo@joh make sure this happens only once\r\n        _this._register(modes.LinkProviderRegistry.register('*', {\r\n            provideLinks: function (model, token) {\r\n                if (!canSyncModel(_this._modelService, model.uri)) {\r\n                    return Promise.resolve({ links: [] }); // File too large\r\n                }\r\n                return _this._workerManager.withWorker().then(function (client) { return client.computeLinks(model.uri); }).then(function (links) {\r\n                    return links && { links: links };\r\n                });\r\n            }\r\n        }));\r\n        _this._register(modes.CompletionProviderRegistry.register('*', new WordBasedCompletionItemProvider(_this._workerManager, configurationService, _this._modelService)));\r\n        return _this;\r\n    }\r\n    EditorWorkerServiceImpl.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    EditorWorkerServiceImpl.prototype.canComputeDiff = function (original, modified) {\r\n        return (canSyncModel(this._modelService, original) && canSyncModel(this._modelService, modified));\r\n    };\r\n    EditorWorkerServiceImpl.prototype.computeDiff = function (original, modified, ignoreTrimWhitespace, maxComputationTime) {\r\n        return this._workerManager.withWorker().then(function (client) { return client.computeDiff(original, modified, ignoreTrimWhitespace, maxComputationTime); });\r\n    };\r\n    EditorWorkerServiceImpl.prototype.computeMoreMinimalEdits = function (resource, edits) {\r\n        var _this = this;\r\n        if (isNonEmptyArray(edits)) {\r\n            if (!canSyncModel(this._modelService, resource)) {\r\n                return Promise.resolve(edits); // File too large\r\n            }\r\n            var sw_1 = StopWatch.create(true);\r\n            var result = this._workerManager.withWorker().then(function (client) { return client.computeMoreMinimalEdits(resource, edits); });\r\n            result.finally(function () { return _this._logService.trace('FORMAT#computeMoreMinimalEdits', resource.toString(true), sw_1.elapsed()); });\r\n            return result;\r\n        }\r\n        else {\r\n            return Promise.resolve(undefined);\r\n        }\r\n    };\r\n    EditorWorkerServiceImpl.prototype.canNavigateValueSet = function (resource) {\r\n        return (canSyncModel(this._modelService, resource));\r\n    };\r\n    EditorWorkerServiceImpl.prototype.navigateValueSet = function (resource, range, up) {\r\n        return this._workerManager.withWorker().then(function (client) { return client.navigateValueSet(resource, range, up); });\r\n    };\r\n    EditorWorkerServiceImpl.prototype.canComputeWordRanges = function (resource) {\r\n        return canSyncModel(this._modelService, resource);\r\n    };\r\n    EditorWorkerServiceImpl.prototype.computeWordRanges = function (resource, range) {\r\n        return this._workerManager.withWorker().then(function (client) { return client.computeWordRanges(resource, range); });\r\n    };\r\n    EditorWorkerServiceImpl = __decorate([\r\n        __param(0, IModelService),\r\n        __param(1, ITextResourceConfigurationService),\r\n        __param(2, ILogService)\r\n    ], EditorWorkerServiceImpl);\r\n    return EditorWorkerServiceImpl;\r\n}(Disposable));\r\nexport { EditorWorkerServiceImpl };\r\nvar WordBasedCompletionItemProvider = /** @class */ (function () {\r\n    function WordBasedCompletionItemProvider(workerManager, configurationService, modelService) {\r\n        this._debugDisplayName = 'wordbasedCompletions';\r\n        this._workerManager = workerManager;\r\n        this._configurationService = configurationService;\r\n        this._modelService = modelService;\r\n    }\r\n    WordBasedCompletionItemProvider.prototype.provideCompletionItems = function (model, position) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var wordBasedSuggestions, word, replace, insert, client, words;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        wordBasedSuggestions = this._configurationService.getValue(model.uri, position, 'editor').wordBasedSuggestions;\r\n                        if (!wordBasedSuggestions) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        if (!canSyncModel(this._modelService, model.uri)) {\r\n                            return [2 /*return*/, undefined]; // File too large\r\n                        }\r\n                        word = model.getWordAtPosition(position);\r\n                        replace = !word ? Range.fromPositions(position) : new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\r\n                        insert = replace.setEndPosition(position.lineNumber, position.column);\r\n                        return [4 /*yield*/, this._workerManager.withWorker()];\r\n                    case 1:\r\n                        client = _a.sent();\r\n                        return [4 /*yield*/, client.textualSuggest(model.uri, position)];\r\n                    case 2:\r\n                        words = _a.sent();\r\n                        if (!words) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        return [2 /*return*/, {\r\n                                suggestions: words.map(function (word) {\r\n                                    return {\r\n                                        kind: 18 /* Text */,\r\n                                        label: word,\r\n                                        insertText: word,\r\n                                        range: { insert: insert, replace: replace }\r\n                                    };\r\n                                })\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return WordBasedCompletionItemProvider;\r\n}());\r\nvar WorkerManager = /** @class */ (function (_super) {\r\n    __extends(WorkerManager, _super);\r\n    function WorkerManager(modelService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._modelService = modelService;\r\n        _this._editorWorkerClient = null;\r\n        _this._lastWorkerUsedTime = (new Date()).getTime();\r\n        var stopWorkerInterval = _this._register(new IntervalTimer());\r\n        stopWorkerInterval.cancelAndSet(function () { return _this._checkStopIdleWorker(); }, Math.round(STOP_WORKER_DELTA_TIME_MS / 2));\r\n        _this._register(_this._modelService.onModelRemoved(function (_) { return _this._checkStopEmptyWorker(); }));\r\n        return _this;\r\n    }\r\n    WorkerManager.prototype.dispose = function () {\r\n        if (this._editorWorkerClient) {\r\n            this._editorWorkerClient.dispose();\r\n            this._editorWorkerClient = null;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    /**\r\n     * Check if the model service has no more models and stop the worker if that is the case.\r\n     */\r\n    WorkerManager.prototype._checkStopEmptyWorker = function () {\r\n        if (!this._editorWorkerClient) {\r\n            return;\r\n        }\r\n        var models = this._modelService.getModels();\r\n        if (models.length === 0) {\r\n            // There are no more models => nothing possible for me to do\r\n            this._editorWorkerClient.dispose();\r\n            this._editorWorkerClient = null;\r\n        }\r\n    };\r\n    /**\r\n     * Check if the worker has been idle for a while and then stop it.\r\n     */\r\n    WorkerManager.prototype._checkStopIdleWorker = function () {\r\n        if (!this._editorWorkerClient) {\r\n            return;\r\n        }\r\n        var timeSinceLastWorkerUsedTime = (new Date()).getTime() - this._lastWorkerUsedTime;\r\n        if (timeSinceLastWorkerUsedTime > STOP_WORKER_DELTA_TIME_MS) {\r\n            this._editorWorkerClient.dispose();\r\n            this._editorWorkerClient = null;\r\n        }\r\n    };\r\n    WorkerManager.prototype.withWorker = function () {\r\n        this._lastWorkerUsedTime = (new Date()).getTime();\r\n        if (!this._editorWorkerClient) {\r\n            this._editorWorkerClient = new EditorWorkerClient(this._modelService, false, 'editorWorkerService');\r\n        }\r\n        return Promise.resolve(this._editorWorkerClient);\r\n    };\r\n    return WorkerManager;\r\n}(Disposable));\r\nvar EditorModelManager = /** @class */ (function (_super) {\r\n    __extends(EditorModelManager, _super);\r\n    function EditorModelManager(proxy, modelService, keepIdleModels) {\r\n        var _this = _super.call(this) || this;\r\n        _this._syncedModels = Object.create(null);\r\n        _this._syncedModelsLastUsedTime = Object.create(null);\r\n        _this._proxy = proxy;\r\n        _this._modelService = modelService;\r\n        if (!keepIdleModels) {\r\n            var timer = new IntervalTimer();\r\n            timer.cancelAndSet(function () { return _this._checkStopModelSync(); }, Math.round(STOP_SYNC_MODEL_DELTA_TIME_MS / 2));\r\n            _this._register(timer);\r\n        }\r\n        return _this;\r\n    }\r\n    EditorModelManager.prototype.dispose = function () {\r\n        for (var modelUrl in this._syncedModels) {\r\n            dispose(this._syncedModels[modelUrl]);\r\n        }\r\n        this._syncedModels = Object.create(null);\r\n        this._syncedModelsLastUsedTime = Object.create(null);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    EditorModelManager.prototype.ensureSyncedResources = function (resources) {\r\n        for (var _i = 0, resources_1 = resources; _i < resources_1.length; _i++) {\r\n            var resource = resources_1[_i];\r\n            var resourceStr = resource.toString();\r\n            if (!this._syncedModels[resourceStr]) {\r\n                this._beginModelSync(resource);\r\n            }\r\n            if (this._syncedModels[resourceStr]) {\r\n                this._syncedModelsLastUsedTime[resourceStr] = (new Date()).getTime();\r\n            }\r\n        }\r\n    };\r\n    EditorModelManager.prototype._checkStopModelSync = function () {\r\n        var currentTime = (new Date()).getTime();\r\n        var toRemove = [];\r\n        for (var modelUrl in this._syncedModelsLastUsedTime) {\r\n            var elapsedTime = currentTime - this._syncedModelsLastUsedTime[modelUrl];\r\n            if (elapsedTime > STOP_SYNC_MODEL_DELTA_TIME_MS) {\r\n                toRemove.push(modelUrl);\r\n            }\r\n        }\r\n        for (var _i = 0, toRemove_1 = toRemove; _i < toRemove_1.length; _i++) {\r\n            var e = toRemove_1[_i];\r\n            this._stopModelSync(e);\r\n        }\r\n    };\r\n    EditorModelManager.prototype._beginModelSync = function (resource) {\r\n        var _this = this;\r\n        var model = this._modelService.getModel(resource);\r\n        if (!model) {\r\n            return;\r\n        }\r\n        if (model.isTooLargeForSyncing()) {\r\n            return;\r\n        }\r\n        var modelUrl = resource.toString();\r\n        this._proxy.acceptNewModel({\r\n            url: model.uri.toString(),\r\n            lines: model.getLinesContent(),\r\n            EOL: model.getEOL(),\r\n            versionId: model.getVersionId()\r\n        });\r\n        var toDispose = new DisposableStore();\r\n        toDispose.add(model.onDidChangeContent(function (e) {\r\n            _this._proxy.acceptModelChanged(modelUrl.toString(), e);\r\n        }));\r\n        toDispose.add(model.onWillDispose(function () {\r\n            _this._stopModelSync(modelUrl);\r\n        }));\r\n        toDispose.add(toDisposable(function () {\r\n            _this._proxy.acceptRemovedModel(modelUrl);\r\n        }));\r\n        this._syncedModels[modelUrl] = toDispose;\r\n    };\r\n    EditorModelManager.prototype._stopModelSync = function (modelUrl) {\r\n        var toDispose = this._syncedModels[modelUrl];\r\n        delete this._syncedModels[modelUrl];\r\n        delete this._syncedModelsLastUsedTime[modelUrl];\r\n        dispose(toDispose);\r\n    };\r\n    return EditorModelManager;\r\n}(Disposable));\r\nvar SynchronousWorkerClient = /** @class */ (function () {\r\n    function SynchronousWorkerClient(instance) {\r\n        this._instance = instance;\r\n        this._proxyObj = Promise.resolve(this._instance);\r\n    }\r\n    SynchronousWorkerClient.prototype.dispose = function () {\r\n        this._instance.dispose();\r\n    };\r\n    SynchronousWorkerClient.prototype.getProxyObject = function () {\r\n        return this._proxyObj;\r\n    };\r\n    return SynchronousWorkerClient;\r\n}());\r\nvar EditorWorkerHost = /** @class */ (function () {\r\n    function EditorWorkerHost(workerClient) {\r\n        this._workerClient = workerClient;\r\n    }\r\n    // foreign host request\r\n    EditorWorkerHost.prototype.fhr = function (method, args) {\r\n        return this._workerClient.fhr(method, args);\r\n    };\r\n    return EditorWorkerHost;\r\n}());\r\nexport { EditorWorkerHost };\r\nvar EditorWorkerClient = /** @class */ (function (_super) {\r\n    __extends(EditorWorkerClient, _super);\r\n    function EditorWorkerClient(modelService, keepIdleModels, label) {\r\n        var _this = _super.call(this) || this;\r\n        _this._modelService = modelService;\r\n        _this._keepIdleModels = keepIdleModels;\r\n        _this._workerFactory = new DefaultWorkerFactory(label);\r\n        _this._worker = null;\r\n        _this._modelManager = null;\r\n        return _this;\r\n    }\r\n    // foreign host request\r\n    EditorWorkerClient.prototype.fhr = function (method, args) {\r\n        throw new Error(\"Not implemented!\");\r\n    };\r\n    EditorWorkerClient.prototype._getOrCreateWorker = function () {\r\n        if (!this._worker) {\r\n            try {\r\n                this._worker = this._register(new SimpleWorkerClient(this._workerFactory, 'vs/editor/common/services/editorSimpleWorker', new EditorWorkerHost(this)));\r\n            }\r\n            catch (err) {\r\n                logOnceWebWorkerWarning(err);\r\n                this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\r\n            }\r\n        }\r\n        return this._worker;\r\n    };\r\n    EditorWorkerClient.prototype._getProxy = function () {\r\n        var _this = this;\r\n        return this._getOrCreateWorker().getProxyObject().then(undefined, function (err) {\r\n            logOnceWebWorkerWarning(err);\r\n            _this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(_this), null));\r\n            return _this._getOrCreateWorker().getProxyObject();\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype._getOrCreateModelManager = function (proxy) {\r\n        if (!this._modelManager) {\r\n            this._modelManager = this._register(new EditorModelManager(proxy, this._modelService, this._keepIdleModels));\r\n        }\r\n        return this._modelManager;\r\n    };\r\n    EditorWorkerClient.prototype._withSyncedResources = function (resources) {\r\n        var _this = this;\r\n        return this._getProxy().then(function (proxy) {\r\n            _this._getOrCreateModelManager(proxy).ensureSyncedResources(resources);\r\n            return proxy;\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.computeDiff = function (original, modified, ignoreTrimWhitespace, maxComputationTime) {\r\n        return this._withSyncedResources([original, modified]).then(function (proxy) {\r\n            return proxy.computeDiff(original.toString(), modified.toString(), ignoreTrimWhitespace, maxComputationTime);\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.computeMoreMinimalEdits = function (resource, edits) {\r\n        return this._withSyncedResources([resource]).then(function (proxy) {\r\n            return proxy.computeMoreMinimalEdits(resource.toString(), edits);\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.computeLinks = function (resource) {\r\n        return this._withSyncedResources([resource]).then(function (proxy) {\r\n            return proxy.computeLinks(resource.toString());\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.textualSuggest = function (resource, position) {\r\n        var _this = this;\r\n        return this._withSyncedResources([resource]).then(function (proxy) {\r\n            var model = _this._modelService.getModel(resource);\r\n            if (!model) {\r\n                return null;\r\n            }\r\n            var wordDefRegExp = LanguageConfigurationRegistry.getWordDefinition(model.getLanguageIdentifier().id);\r\n            var wordDef = wordDefRegExp.source;\r\n            var wordDefFlags = regExpFlags(wordDefRegExp);\r\n            return proxy.textualSuggest(resource.toString(), position, wordDef, wordDefFlags);\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.computeWordRanges = function (resource, range) {\r\n        var _this = this;\r\n        return this._withSyncedResources([resource]).then(function (proxy) {\r\n            var model = _this._modelService.getModel(resource);\r\n            if (!model) {\r\n                return Promise.resolve(null);\r\n            }\r\n            var wordDefRegExp = LanguageConfigurationRegistry.getWordDefinition(model.getLanguageIdentifier().id);\r\n            var wordDef = wordDefRegExp.source;\r\n            var wordDefFlags = regExpFlags(wordDefRegExp);\r\n            return proxy.computeWordRanges(resource.toString(), range, wordDef, wordDefFlags);\r\n        });\r\n    };\r\n    EditorWorkerClient.prototype.navigateValueSet = function (resource, range, up) {\r\n        var _this = this;\r\n        return this._withSyncedResources([resource]).then(function (proxy) {\r\n            var model = _this._modelService.getModel(resource);\r\n            if (!model) {\r\n                return null;\r\n            }\r\n            var wordDefRegExp = LanguageConfigurationRegistry.getWordDefinition(model.getLanguageIdentifier().id);\r\n            var wordDef = wordDefRegExp.source;\r\n            var wordDefFlags = regExpFlags(wordDefRegExp);\r\n            return proxy.navigateValueSet(resource.toString(), range, up, wordDef, wordDefFlags);\r\n        });\r\n    };\r\n    return EditorWorkerClient;\r\n}(Disposable));\r\nexport { EditorWorkerClient };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var IModeService = createDecorator('modeService');\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Color } from '../../../../base/common/color.js';\r\nvar ParsedTokenThemeRule = /** @class */ (function () {\r\n    function ParsedTokenThemeRule(token, index, fontStyle, foreground, background) {\r\n        this.token = token;\r\n        this.index = index;\r\n        this.fontStyle = fontStyle;\r\n        this.foreground = foreground;\r\n        this.background = background;\r\n    }\r\n    return ParsedTokenThemeRule;\r\n}());\r\nexport { ParsedTokenThemeRule };\r\n/**\r\n * Parse a raw theme into rules.\r\n */\r\nexport function parseTokenTheme(source) {\r\n    if (!source || !Array.isArray(source)) {\r\n        return [];\r\n    }\r\n    var result = [], resultLen = 0;\r\n    for (var i = 0, len = source.length; i < len; i++) {\r\n        var entry = source[i];\r\n        var fontStyle = -1 /* NotSet */;\r\n        if (typeof entry.fontStyle === 'string') {\r\n            fontStyle = 0 /* None */;\r\n            var segments = entry.fontStyle.split(' ');\r\n            for (var j = 0, lenJ = segments.length; j < lenJ; j++) {\r\n                var segment = segments[j];\r\n                switch (segment) {\r\n                    case 'italic':\r\n                        fontStyle = fontStyle | 1 /* Italic */;\r\n                        break;\r\n                    case 'bold':\r\n                        fontStyle = fontStyle | 2 /* Bold */;\r\n                        break;\r\n                    case 'underline':\r\n                        fontStyle = fontStyle | 4 /* Underline */;\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        var foreground = null;\r\n        if (typeof entry.foreground === 'string') {\r\n            foreground = entry.foreground;\r\n        }\r\n        var background = null;\r\n        if (typeof entry.background === 'string') {\r\n            background = entry.background;\r\n        }\r\n        result[resultLen++] = new ParsedTokenThemeRule(entry.token || '', i, fontStyle, foreground, background);\r\n    }\r\n    return result;\r\n}\r\n/**\r\n * Resolve rules (i.e. inheritance).\r\n */\r\nfunction resolveParsedTokenThemeRules(parsedThemeRules, customTokenColors) {\r\n    // Sort rules lexicographically, and then by index if necessary\r\n    parsedThemeRules.sort(function (a, b) {\r\n        var r = strcmp(a.token, b.token);\r\n        if (r !== 0) {\r\n            return r;\r\n        }\r\n        return a.index - b.index;\r\n    });\r\n    // Determine defaults\r\n    var defaultFontStyle = 0 /* None */;\r\n    var defaultForeground = '000000';\r\n    var defaultBackground = 'ffffff';\r\n    while (parsedThemeRules.length >= 1 && parsedThemeRules[0].token === '') {\r\n        var incomingDefaults = parsedThemeRules.shift();\r\n        if (incomingDefaults.fontStyle !== -1 /* NotSet */) {\r\n            defaultFontStyle = incomingDefaults.fontStyle;\r\n        }\r\n        if (incomingDefaults.foreground !== null) {\r\n            defaultForeground = incomingDefaults.foreground;\r\n        }\r\n        if (incomingDefaults.background !== null) {\r\n            defaultBackground = incomingDefaults.background;\r\n        }\r\n    }\r\n    var colorMap = new ColorMap();\r\n    // start with token colors from custom token themes\r\n    for (var _i = 0, customTokenColors_1 = customTokenColors; _i < customTokenColors_1.length; _i++) {\r\n        var color = customTokenColors_1[_i];\r\n        colorMap.getId(color);\r\n    }\r\n    var foregroundColorId = colorMap.getId(defaultForeground);\r\n    var backgroundColorId = colorMap.getId(defaultBackground);\r\n    var defaults = new ThemeTrieElementRule(defaultFontStyle, foregroundColorId, backgroundColorId);\r\n    var root = new ThemeTrieElement(defaults);\r\n    for (var i = 0, len = parsedThemeRules.length; i < len; i++) {\r\n        var rule = parsedThemeRules[i];\r\n        root.insert(rule.token, rule.fontStyle, colorMap.getId(rule.foreground), colorMap.getId(rule.background));\r\n    }\r\n    return new TokenTheme(colorMap, root);\r\n}\r\nvar colorRegExp = /^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/;\r\nvar ColorMap = /** @class */ (function () {\r\n    function ColorMap() {\r\n        this._lastColorId = 0;\r\n        this._id2color = [];\r\n        this._color2id = new Map();\r\n    }\r\n    ColorMap.prototype.getId = function (color) {\r\n        if (color === null) {\r\n            return 0;\r\n        }\r\n        var match = color.match(colorRegExp);\r\n        if (!match) {\r\n            throw new Error('Illegal value for token color: ' + color);\r\n        }\r\n        color = match[1].toUpperCase();\r\n        var value = this._color2id.get(color);\r\n        if (value) {\r\n            return value;\r\n        }\r\n        value = ++this._lastColorId;\r\n        this._color2id.set(color, value);\r\n        this._id2color[value] = Color.fromHex('#' + color);\r\n        return value;\r\n    };\r\n    ColorMap.prototype.getColorMap = function () {\r\n        return this._id2color.slice(0);\r\n    };\r\n    return ColorMap;\r\n}());\r\nexport { ColorMap };\r\nvar TokenTheme = /** @class */ (function () {\r\n    function TokenTheme(colorMap, root) {\r\n        this._colorMap = colorMap;\r\n        this._root = root;\r\n        this._cache = new Map();\r\n    }\r\n    TokenTheme.createFromRawTokenTheme = function (source, customTokenColors) {\r\n        return this.createFromParsedTokenTheme(parseTokenTheme(source), customTokenColors);\r\n    };\r\n    TokenTheme.createFromParsedTokenTheme = function (source, customTokenColors) {\r\n        return resolveParsedTokenThemeRules(source, customTokenColors);\r\n    };\r\n    TokenTheme.prototype.getColorMap = function () {\r\n        return this._colorMap.getColorMap();\r\n    };\r\n    TokenTheme.prototype._match = function (token) {\r\n        return this._root.match(token);\r\n    };\r\n    TokenTheme.prototype.match = function (languageId, token) {\r\n        // The cache contains the metadata without the language bits set.\r\n        var result = this._cache.get(token);\r\n        if (typeof result === 'undefined') {\r\n            var rule = this._match(token);\r\n            var standardToken = toStandardTokenType(token);\r\n            result = (rule.metadata\r\n                | (standardToken << 8 /* TOKEN_TYPE_OFFSET */)) >>> 0;\r\n            this._cache.set(token, result);\r\n        }\r\n        return (result\r\n            | (languageId << 0 /* LANGUAGEID_OFFSET */)) >>> 0;\r\n    };\r\n    return TokenTheme;\r\n}());\r\nexport { TokenTheme };\r\nvar STANDARD_TOKEN_TYPE_REGEXP = /\\b(comment|string|regex|regexp)\\b/;\r\nexport function toStandardTokenType(tokenType) {\r\n    var m = tokenType.match(STANDARD_TOKEN_TYPE_REGEXP);\r\n    if (!m) {\r\n        return 0 /* Other */;\r\n    }\r\n    switch (m[1]) {\r\n        case 'comment':\r\n            return 1 /* Comment */;\r\n        case 'string':\r\n            return 2 /* String */;\r\n        case 'regex':\r\n            return 4 /* RegEx */;\r\n        case 'regexp':\r\n            return 4 /* RegEx */;\r\n    }\r\n    throw new Error('Unexpected match for standard token type!');\r\n}\r\nexport function strcmp(a, b) {\r\n    if (a < b) {\r\n        return -1;\r\n    }\r\n    if (a > b) {\r\n        return 1;\r\n    }\r\n    return 0;\r\n}\r\nvar ThemeTrieElementRule = /** @class */ (function () {\r\n    function ThemeTrieElementRule(fontStyle, foreground, background) {\r\n        this._fontStyle = fontStyle;\r\n        this._foreground = foreground;\r\n        this._background = background;\r\n        this.metadata = ((this._fontStyle << 11 /* FONT_STYLE_OFFSET */)\r\n            | (this._foreground << 14 /* FOREGROUND_OFFSET */)\r\n            | (this._background << 23 /* BACKGROUND_OFFSET */)) >>> 0;\r\n    }\r\n    ThemeTrieElementRule.prototype.clone = function () {\r\n        return new ThemeTrieElementRule(this._fontStyle, this._foreground, this._background);\r\n    };\r\n    ThemeTrieElementRule.prototype.acceptOverwrite = function (fontStyle, foreground, background) {\r\n        if (fontStyle !== -1 /* NotSet */) {\r\n            this._fontStyle = fontStyle;\r\n        }\r\n        if (foreground !== 0 /* None */) {\r\n            this._foreground = foreground;\r\n        }\r\n        if (background !== 0 /* None */) {\r\n            this._background = background;\r\n        }\r\n        this.metadata = ((this._fontStyle << 11 /* FONT_STYLE_OFFSET */)\r\n            | (this._foreground << 14 /* FOREGROUND_OFFSET */)\r\n            | (this._background << 23 /* BACKGROUND_OFFSET */)) >>> 0;\r\n    };\r\n    return ThemeTrieElementRule;\r\n}());\r\nexport { ThemeTrieElementRule };\r\nvar ThemeTrieElement = /** @class */ (function () {\r\n    function ThemeTrieElement(mainRule) {\r\n        this._mainRule = mainRule;\r\n        this._children = new Map();\r\n    }\r\n    ThemeTrieElement.prototype.match = function (token) {\r\n        if (token === '') {\r\n            return this._mainRule;\r\n        }\r\n        var dotIndex = token.indexOf('.');\r\n        var head;\r\n        var tail;\r\n        if (dotIndex === -1) {\r\n            head = token;\r\n            tail = '';\r\n        }\r\n        else {\r\n            head = token.substring(0, dotIndex);\r\n            tail = token.substring(dotIndex + 1);\r\n        }\r\n        var child = this._children.get(head);\r\n        if (typeof child !== 'undefined') {\r\n            return child.match(tail);\r\n        }\r\n        return this._mainRule;\r\n    };\r\n    ThemeTrieElement.prototype.insert = function (token, fontStyle, foreground, background) {\r\n        if (token === '') {\r\n            // Merge into the main rule\r\n            this._mainRule.acceptOverwrite(fontStyle, foreground, background);\r\n            return;\r\n        }\r\n        var dotIndex = token.indexOf('.');\r\n        var head;\r\n        var tail;\r\n        if (dotIndex === -1) {\r\n            head = token;\r\n            tail = '';\r\n        }\r\n        else {\r\n            head = token.substring(0, dotIndex);\r\n            tail = token.substring(dotIndex + 1);\r\n        }\r\n        var child = this._children.get(head);\r\n        if (typeof child === 'undefined') {\r\n            child = new ThemeTrieElement(this._mainRule.clone());\r\n            this._children.set(head, child);\r\n        }\r\n        child.insert(tail, fontStyle, foreground, background);\r\n    };\r\n    return ThemeTrieElement;\r\n}());\r\nexport { ThemeTrieElement };\r\nexport function generateTokensCSSForColorMap(colorMap) {\r\n    var rules = [];\r\n    for (var i = 1, len = colorMap.length; i < len; i++) {\r\n        var color = colorMap[i];\r\n        rules[i] = \".mtk\" + i + \" { color: \" + color + \"; }\";\r\n    }\r\n    rules.push('.mtki { font-style: italic; }');\r\n    rules.push('.mtkb { font-weight: bold; }');\r\n    rules.push('.mtku { text-decoration: underline; text-underline-position: under; }');\r\n    return rules.join('\\n');\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { match as matchGlobPattern } from '../../../base/common/glob.js';\r\nexport function score(selector, candidateUri, candidateLanguage, candidateIsSynchronized) {\r\n    if (Array.isArray(selector)) {\r\n        // array -> take max individual value\r\n        var ret = 0;\r\n        for (var _i = 0, selector_1 = selector; _i < selector_1.length; _i++) {\r\n            var filter = selector_1[_i];\r\n            var value = score(filter, candidateUri, candidateLanguage, candidateIsSynchronized);\r\n            if (value === 10) {\r\n                return value; // already at the highest\r\n            }\r\n            if (value > ret) {\r\n                ret = value;\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    else if (typeof selector === 'string') {\r\n        if (!candidateIsSynchronized) {\r\n            return 0;\r\n        }\r\n        // short-hand notion, desugars to\r\n        // 'fooLang' -> { language: 'fooLang'}\r\n        // '*' -> { language: '*' }\r\n        if (selector === '*') {\r\n            return 5;\r\n        }\r\n        else if (selector === candidateLanguage) {\r\n            return 10;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    }\r\n    else if (selector) {\r\n        // filter -> select accordingly, use defaults for scheme\r\n        var language = selector.language, pattern = selector.pattern, scheme = selector.scheme, hasAccessToAllModels = selector.hasAccessToAllModels;\r\n        if (!candidateIsSynchronized && !hasAccessToAllModels) {\r\n            return 0;\r\n        }\r\n        var ret = 0;\r\n        if (scheme) {\r\n            if (scheme === candidateUri.scheme) {\r\n                ret = 10;\r\n            }\r\n            else if (scheme === '*') {\r\n                ret = 5;\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        }\r\n        if (language) {\r\n            if (language === candidateLanguage) {\r\n                ret = 10;\r\n            }\r\n            else if (language === '*') {\r\n                ret = Math.max(ret, 5);\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        }\r\n        if (pattern) {\r\n            if (pattern === candidateUri.fsPath || matchGlobPattern(pattern, candidateUri.fsPath)) {\r\n                ret = 10;\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    else {\r\n        return 0;\r\n    }\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport { score } from './languageSelector.js';\r\nimport { shouldSynchronizeModel } from '../services/modelService.js';\r\nfunction isExclusive(selector) {\r\n    if (typeof selector === 'string') {\r\n        return false;\r\n    }\r\n    else if (Array.isArray(selector)) {\r\n        return selector.every(isExclusive);\r\n    }\r\n    else {\r\n        return !!selector.exclusive;\r\n    }\r\n}\r\nvar LanguageFeatureRegistry = /** @class */ (function () {\r\n    function LanguageFeatureRegistry() {\r\n        this._clock = 0;\r\n        this._entries = [];\r\n        this._onDidChange = new Emitter();\r\n    }\r\n    Object.defineProperty(LanguageFeatureRegistry.prototype, \"onDidChange\", {\r\n        get: function () {\r\n            return this._onDidChange.event;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LanguageFeatureRegistry.prototype.register = function (selector, provider) {\r\n        var _this = this;\r\n        var entry = {\r\n            selector: selector,\r\n            provider: provider,\r\n            _score: -1,\r\n            _time: this._clock++\r\n        };\r\n        this._entries.push(entry);\r\n        this._lastCandidate = undefined;\r\n        this._onDidChange.fire(this._entries.length);\r\n        return toDisposable(function () {\r\n            if (entry) {\r\n                var idx = _this._entries.indexOf(entry);\r\n                if (idx >= 0) {\r\n                    _this._entries.splice(idx, 1);\r\n                    _this._lastCandidate = undefined;\r\n                    _this._onDidChange.fire(_this._entries.length);\r\n                    entry = undefined;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    LanguageFeatureRegistry.prototype.has = function (model) {\r\n        return this.all(model).length > 0;\r\n    };\r\n    LanguageFeatureRegistry.prototype.all = function (model) {\r\n        if (!model) {\r\n            return [];\r\n        }\r\n        this._updateScores(model);\r\n        var result = [];\r\n        // from registry\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            if (entry._score > 0) {\r\n                result.push(entry.provider);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype.ordered = function (model) {\r\n        var result = [];\r\n        this._orderedForEach(model, function (entry) { return result.push(entry.provider); });\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype.orderedGroups = function (model) {\r\n        var result = [];\r\n        var lastBucket;\r\n        var lastBucketScore;\r\n        this._orderedForEach(model, function (entry) {\r\n            if (lastBucket && lastBucketScore === entry._score) {\r\n                lastBucket.push(entry.provider);\r\n            }\r\n            else {\r\n                lastBucketScore = entry._score;\r\n                lastBucket = [entry.provider];\r\n                result.push(lastBucket);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype._orderedForEach = function (model, callback) {\r\n        if (!model) {\r\n            return;\r\n        }\r\n        this._updateScores(model);\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            if (entry._score > 0) {\r\n                callback(entry);\r\n            }\r\n        }\r\n    };\r\n    LanguageFeatureRegistry.prototype._updateScores = function (model) {\r\n        var candidate = {\r\n            uri: model.uri.toString(),\r\n            language: model.getLanguageIdentifier().language\r\n        };\r\n        if (this._lastCandidate\r\n            && this._lastCandidate.language === candidate.language\r\n            && this._lastCandidate.uri === candidate.uri) {\r\n            // nothing has changed\r\n            return;\r\n        }\r\n        this._lastCandidate = candidate;\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            entry._score = score(entry.selector, model.uri, model.getLanguageIdentifier().language, shouldSynchronizeModel(model));\r\n            if (isExclusive(entry.selector) && entry._score > 0) {\r\n                // support for one exclusive selector that overwrites\r\n                // any other selector\r\n                for (var _b = 0, _c = this._entries; _b < _c.length; _b++) {\r\n                    var entry_1 = _c[_b];\r\n                    entry_1._score = 0;\r\n                }\r\n                entry._score = 1000;\r\n                break;\r\n            }\r\n        }\r\n        // needs sorting\r\n        this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\r\n    };\r\n    LanguageFeatureRegistry._compareByScoreAndTime = function (a, b) {\r\n        if (a._score < b._score) {\r\n            return 1;\r\n        }\r\n        else if (a._score > b._score) {\r\n            return -1;\r\n        }\r\n        else if (a._time < b._time) {\r\n            return 1;\r\n        }\r\n        else if (a._time > b._time) {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    return LanguageFeatureRegistry;\r\n}());\r\nexport { LanguageFeatureRegistry };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { StandardAutoClosingPairConditional } from '../languageConfiguration.js';\r\nvar CharacterPairSupport = /** @class */ (function () {\r\n    function CharacterPairSupport(config) {\r\n        if (config.autoClosingPairs) {\r\n            this._autoClosingPairs = config.autoClosingPairs.map(function (el) { return new StandardAutoClosingPairConditional(el); });\r\n        }\r\n        else if (config.brackets) {\r\n            this._autoClosingPairs = config.brackets.map(function (b) { return new StandardAutoClosingPairConditional({ open: b[0], close: b[1] }); });\r\n        }\r\n        else {\r\n            this._autoClosingPairs = [];\r\n        }\r\n        if (config.__electricCharacterSupport && config.__electricCharacterSupport.docComment) {\r\n            var docComment = config.__electricCharacterSupport.docComment;\r\n            // IDocComment is legacy, only partially supported\r\n            this._autoClosingPairs.push(new StandardAutoClosingPairConditional({ open: docComment.open, close: docComment.close || '' }));\r\n        }\r\n        this._autoCloseBefore = typeof config.autoCloseBefore === 'string' ? config.autoCloseBefore : CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED;\r\n        this._surroundingPairs = config.surroundingPairs || this._autoClosingPairs;\r\n    }\r\n    CharacterPairSupport.prototype.getAutoClosingPairs = function () {\r\n        return this._autoClosingPairs;\r\n    };\r\n    CharacterPairSupport.prototype.getAutoCloseBeforeSet = function () {\r\n        return this._autoCloseBefore;\r\n    };\r\n    CharacterPairSupport.shouldAutoClosePair = function (autoClosingPair, context, column) {\r\n        // Always complete on empty line\r\n        if (context.getTokenCount() === 0) {\r\n            return true;\r\n        }\r\n        var tokenIndex = context.findTokenIndexAtOffset(column - 2);\r\n        var standardTokenType = context.getStandardTokenType(tokenIndex);\r\n        return autoClosingPair.isOK(standardTokenType);\r\n    };\r\n    CharacterPairSupport.prototype.getSurroundingPairs = function () {\r\n        return this._surroundingPairs;\r\n    };\r\n    CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED = ';:.,=}])> \\n\\t';\r\n    return CharacterPairSupport;\r\n}());\r\nexport { CharacterPairSupport };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { ignoreBracketsInToken } from '../supports.js';\r\nimport { BracketsUtils } from './richEditBrackets.js';\r\nvar BracketElectricCharacterSupport = /** @class */ (function () {\r\n    function BracketElectricCharacterSupport(richEditBrackets) {\r\n        this._richEditBrackets = richEditBrackets;\r\n    }\r\n    BracketElectricCharacterSupport.prototype.getElectricCharacters = function () {\r\n        var result = [];\r\n        if (this._richEditBrackets) {\r\n            for (var _i = 0, _a = this._richEditBrackets.brackets; _i < _a.length; _i++) {\r\n                var bracket = _a[_i];\r\n                for (var _b = 0, _c = bracket.close; _b < _c.length; _b++) {\r\n                    var close_1 = _c[_b];\r\n                    var lastChar = close_1.charAt(close_1.length - 1);\r\n                    result.push(lastChar);\r\n                }\r\n            }\r\n        }\r\n        // Filter duplicate entries\r\n        result = result.filter(function (item, pos, array) {\r\n            return array.indexOf(item) === pos;\r\n        });\r\n        return result;\r\n    };\r\n    BracketElectricCharacterSupport.prototype.onElectricCharacter = function (character, context, column) {\r\n        if (!this._richEditBrackets || this._richEditBrackets.brackets.length === 0) {\r\n            return null;\r\n        }\r\n        var tokenIndex = context.findTokenIndexAtOffset(column - 1);\r\n        if (ignoreBracketsInToken(context.getStandardTokenType(tokenIndex))) {\r\n            return null;\r\n        }\r\n        var reversedBracketRegex = this._richEditBrackets.reversedRegex;\r\n        var text = context.getLineContent().substring(0, column - 1) + character;\r\n        var r = BracketsUtils.findPrevBracketInRange(reversedBracketRegex, 1, text, 0, text.length);\r\n        if (!r) {\r\n            return null;\r\n        }\r\n        var bracketText = text.substring(r.startColumn - 1, r.endColumn - 1).toLowerCase();\r\n        var isOpen = this._richEditBrackets.textIsOpenBracket[bracketText];\r\n        if (isOpen) {\r\n            return null;\r\n        }\r\n        var textBeforeBracket = context.getActualLineContentBefore(r.startColumn - 1);\r\n        if (!/^\\s*$/.test(textBeforeBracket)) {\r\n            // There is other text on the line before the bracket\r\n            return null;\r\n        }\r\n        return {\r\n            matchOpenBracket: bracketText\r\n        };\r\n    };\r\n    return BracketElectricCharacterSupport;\r\n}());\r\nexport { BracketElectricCharacterSupport };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar IndentRulesSupport = /** @class */ (function () {\r\n    function IndentRulesSupport(indentationRules) {\r\n        this._indentationRules = indentationRules;\r\n    }\r\n    IndentRulesSupport.prototype.shouldIncrease = function (text) {\r\n        if (this._indentationRules) {\r\n            if (this._indentationRules.increaseIndentPattern && this._indentationRules.increaseIndentPattern.test(text)) {\r\n                return true;\r\n            }\r\n            // if (this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(text)) {\r\n            // \treturn true;\r\n            // }\r\n        }\r\n        return false;\r\n    };\r\n    IndentRulesSupport.prototype.shouldDecrease = function (text) {\r\n        if (this._indentationRules && this._indentationRules.decreaseIndentPattern && this._indentationRules.decreaseIndentPattern.test(text)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    IndentRulesSupport.prototype.shouldIndentNextLine = function (text) {\r\n        if (this._indentationRules && this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(text)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    IndentRulesSupport.prototype.shouldIgnore = function (text) {\r\n        // the text matches `unIndentedLinePattern`\r\n        if (this._indentationRules && this._indentationRules.unIndentedLinePattern && this._indentationRules.unIndentedLinePattern.test(text)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    IndentRulesSupport.prototype.getIndentMetadata = function (text) {\r\n        var ret = 0;\r\n        if (this.shouldIncrease(text)) {\r\n            ret += 1 /* INCREASE_MASK */;\r\n        }\r\n        if (this.shouldDecrease(text)) {\r\n            ret += 2 /* DECREASE_MASK */;\r\n        }\r\n        if (this.shouldIndentNextLine(text)) {\r\n            ret += 4 /* INDENT_NEXTLINE_MASK */;\r\n        }\r\n        if (this.shouldIgnore(text)) {\r\n            ret += 8 /* UNINDENT_MASK */;\r\n        }\r\n        return ret;\r\n    };\r\n    return IndentRulesSupport;\r\n}());\r\nexport { IndentRulesSupport };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\r\nimport * as strings from '../../../../base/common/strings.js';\r\nimport { IndentAction } from '../languageConfiguration.js';\r\nvar OnEnterSupport = /** @class */ (function () {\r\n    function OnEnterSupport(opts) {\r\n        var _this = this;\r\n        opts = opts || {};\r\n        opts.brackets = opts.brackets || [\r\n            ['(', ')'],\r\n            ['{', '}'],\r\n            ['[', ']']\r\n        ];\r\n        this._brackets = [];\r\n        opts.brackets.forEach(function (bracket) {\r\n            var openRegExp = OnEnterSupport._createOpenBracketRegExp(bracket[0]);\r\n            var closeRegExp = OnEnterSupport._createCloseBracketRegExp(bracket[1]);\r\n            if (openRegExp && closeRegExp) {\r\n                _this._brackets.push({\r\n                    open: bracket[0],\r\n                    openRegExp: openRegExp,\r\n                    close: bracket[1],\r\n                    closeRegExp: closeRegExp,\r\n                });\r\n            }\r\n        });\r\n        this._regExpRules = opts.onEnterRules || [];\r\n    }\r\n    OnEnterSupport.prototype.onEnter = function (autoIndent, oneLineAboveText, beforeEnterText, afterEnterText) {\r\n        // (1): `regExpRules`\r\n        if (autoIndent >= 3 /* Advanced */) {\r\n            for (var i = 0, len = this._regExpRules.length; i < len; i++) {\r\n                var rule = this._regExpRules[i];\r\n                var regResult = [{\r\n                        reg: rule.beforeText,\r\n                        text: beforeEnterText\r\n                    }, {\r\n                        reg: rule.afterText,\r\n                        text: afterEnterText\r\n                    }, {\r\n                        reg: rule.oneLineAboveText,\r\n                        text: oneLineAboveText\r\n                    }].every(function (obj) {\r\n                    return obj.reg ? obj.reg.test(obj.text) : true;\r\n                });\r\n                if (regResult) {\r\n                    return rule.action;\r\n                }\r\n            }\r\n        }\r\n        // (2): Special indent-outdent\r\n        if (autoIndent >= 2 /* Brackets */) {\r\n            if (beforeEnterText.length > 0 && afterEnterText.length > 0) {\r\n                for (var i = 0, len = this._brackets.length; i < len; i++) {\r\n                    var bracket = this._brackets[i];\r\n                    if (bracket.openRegExp.test(beforeEnterText) && bracket.closeRegExp.test(afterEnterText)) {\r\n                        return { indentAction: IndentAction.IndentOutdent };\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // (4): Open bracket based logic\r\n        if (autoIndent >= 2 /* Brackets */) {\r\n            if (beforeEnterText.length > 0) {\r\n                for (var i = 0, len = this._brackets.length; i < len; i++) {\r\n                    var bracket = this._brackets[i];\r\n                    if (bracket.openRegExp.test(beforeEnterText)) {\r\n                        return { indentAction: IndentAction.Indent };\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    OnEnterSupport._createOpenBracketRegExp = function (bracket) {\r\n        var str = strings.escapeRegExpCharacters(bracket);\r\n        if (!/\\B/.test(str.charAt(0))) {\r\n            str = '\\\\b' + str;\r\n        }\r\n        str += '\\\\s*$';\r\n        return OnEnterSupport._safeRegExp(str);\r\n    };\r\n    OnEnterSupport._createCloseBracketRegExp = function (bracket) {\r\n        var str = strings.escapeRegExpCharacters(bracket);\r\n        if (!/\\B/.test(str.charAt(str.length - 1))) {\r\n            str = str + '\\\\b';\r\n        }\r\n        str = '^\\\\s*' + str;\r\n        return OnEnterSupport._safeRegExp(str);\r\n    };\r\n    OnEnterSupport._safeRegExp = function (def) {\r\n        try {\r\n            return new RegExp(def);\r\n        }\r\n        catch (err) {\r\n            onUnexpectedError(err);\r\n            return null;\r\n        }\r\n    };\r\n    return OnEnterSupport;\r\n}());\r\nexport { OnEnterSupport };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { DEFAULT_WORD_REGEXP, ensureValidWordDefinition } from '../model/wordHelper.js';\r\nimport { IndentAction } from './languageConfiguration.js';\r\nimport { createScopedLineTokens } from './supports.js';\r\nimport { CharacterPairSupport } from './supports/characterPair.js';\r\nimport { BracketElectricCharacterSupport } from './supports/electricCharacter.js';\r\nimport { IndentRulesSupport } from './supports/indentRules.js';\r\nimport { OnEnterSupport } from './supports/onEnter.js';\r\nimport { RichEditBrackets } from './supports/richEditBrackets.js';\r\nvar RichEditSupport = /** @class */ (function () {\r\n    function RichEditSupport(languageIdentifier, previous, rawConf) {\r\n        this._languageIdentifier = languageIdentifier;\r\n        this._brackets = null;\r\n        this._electricCharacter = null;\r\n        var prev = null;\r\n        if (previous) {\r\n            prev = previous._conf;\r\n        }\r\n        this._conf = RichEditSupport._mergeConf(prev, rawConf);\r\n        this._onEnterSupport = (this._conf.brackets || this._conf.indentationRules || this._conf.onEnterRules ? new OnEnterSupport(this._conf) : null);\r\n        this.comments = RichEditSupport._handleComments(this._conf);\r\n        this.characterPair = new CharacterPairSupport(this._conf);\r\n        this.wordDefinition = this._conf.wordPattern || DEFAULT_WORD_REGEXP;\r\n        this.indentationRules = this._conf.indentationRules;\r\n        if (this._conf.indentationRules) {\r\n            this.indentRulesSupport = new IndentRulesSupport(this._conf.indentationRules);\r\n        }\r\n        else {\r\n            this.indentRulesSupport = null;\r\n        }\r\n        this.foldingRules = this._conf.folding || {};\r\n    }\r\n    Object.defineProperty(RichEditSupport.prototype, \"brackets\", {\r\n        get: function () {\r\n            if (!this._brackets && this._conf.brackets) {\r\n                this._brackets = new RichEditBrackets(this._languageIdentifier, this._conf.brackets);\r\n            }\r\n            return this._brackets;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RichEditSupport.prototype, \"electricCharacter\", {\r\n        get: function () {\r\n            if (!this._electricCharacter) {\r\n                this._electricCharacter = new BracketElectricCharacterSupport(this.brackets);\r\n            }\r\n            return this._electricCharacter;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RichEditSupport.prototype.onEnter = function (autoIndent, oneLineAboveText, beforeEnterText, afterEnterText) {\r\n        if (!this._onEnterSupport) {\r\n            return null;\r\n        }\r\n        return this._onEnterSupport.onEnter(autoIndent, oneLineAboveText, beforeEnterText, afterEnterText);\r\n    };\r\n    RichEditSupport._mergeConf = function (prev, current) {\r\n        return {\r\n            comments: (prev ? current.comments || prev.comments : current.comments),\r\n            brackets: (prev ? current.brackets || prev.brackets : current.brackets),\r\n            wordPattern: (prev ? current.wordPattern || prev.wordPattern : current.wordPattern),\r\n            indentationRules: (prev ? current.indentationRules || prev.indentationRules : current.indentationRules),\r\n            onEnterRules: (prev ? current.onEnterRules || prev.onEnterRules : current.onEnterRules),\r\n            autoClosingPairs: (prev ? current.autoClosingPairs || prev.autoClosingPairs : current.autoClosingPairs),\r\n            surroundingPairs: (prev ? current.surroundingPairs || prev.surroundingPairs : current.surroundingPairs),\r\n            autoCloseBefore: (prev ? current.autoCloseBefore || prev.autoCloseBefore : current.autoCloseBefore),\r\n            folding: (prev ? current.folding || prev.folding : current.folding),\r\n            __electricCharacterSupport: (prev ? current.__electricCharacterSupport || prev.__electricCharacterSupport : current.__electricCharacterSupport),\r\n        };\r\n    };\r\n    RichEditSupport._handleComments = function (conf) {\r\n        var commentRule = conf.comments;\r\n        if (!commentRule) {\r\n            return null;\r\n        }\r\n        // comment configuration\r\n        var comments = {};\r\n        if (commentRule.lineComment) {\r\n            comments.lineCommentToken = commentRule.lineComment;\r\n        }\r\n        if (commentRule.blockComment) {\r\n            var _a = commentRule.blockComment, blockStart = _a[0], blockEnd = _a[1];\r\n            comments.blockCommentStartToken = blockStart;\r\n            comments.blockCommentEndToken = blockEnd;\r\n        }\r\n        return comments;\r\n    };\r\n    return RichEditSupport;\r\n}());\r\nexport { RichEditSupport };\r\nvar LanguageConfigurationChangeEvent = /** @class */ (function () {\r\n    function LanguageConfigurationChangeEvent(languageIdentifier) {\r\n        this.languageIdentifier = languageIdentifier;\r\n    }\r\n    return LanguageConfigurationChangeEvent;\r\n}());\r\nexport { LanguageConfigurationChangeEvent };\r\nvar LanguageConfigurationRegistryImpl = /** @class */ (function () {\r\n    function LanguageConfigurationRegistryImpl() {\r\n        this._entries = new Map();\r\n        this._onDidChange = new Emitter();\r\n        this.onDidChange = this._onDidChange.event;\r\n    }\r\n    LanguageConfigurationRegistryImpl.prototype.register = function (languageIdentifier, configuration) {\r\n        var _this = this;\r\n        var previous = this._getRichEditSupport(languageIdentifier.id);\r\n        var current = new RichEditSupport(languageIdentifier, previous, configuration);\r\n        this._entries.set(languageIdentifier.id, current);\r\n        this._onDidChange.fire(new LanguageConfigurationChangeEvent(languageIdentifier));\r\n        return toDisposable(function () {\r\n            if (_this._entries.get(languageIdentifier.id) === current) {\r\n                _this._entries.set(languageIdentifier.id, previous);\r\n                _this._onDidChange.fire(new LanguageConfigurationChangeEvent(languageIdentifier));\r\n            }\r\n        });\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype._getRichEditSupport = function (languageId) {\r\n        return this._entries.get(languageId);\r\n    };\r\n    // begin electricCharacter\r\n    LanguageConfigurationRegistryImpl.prototype._getElectricCharacterSupport = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        return value.electricCharacter || null;\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getElectricCharacters = function (languageId) {\r\n        var electricCharacterSupport = this._getElectricCharacterSupport(languageId);\r\n        if (!electricCharacterSupport) {\r\n            return [];\r\n        }\r\n        return electricCharacterSupport.getElectricCharacters();\r\n    };\r\n    /**\r\n     * Should return opening bracket type to match indentation with\r\n     */\r\n    LanguageConfigurationRegistryImpl.prototype.onElectricCharacter = function (character, context, column) {\r\n        var scopedLineTokens = createScopedLineTokens(context, column - 1);\r\n        var electricCharacterSupport = this._getElectricCharacterSupport(scopedLineTokens.languageId);\r\n        if (!electricCharacterSupport) {\r\n            return null;\r\n        }\r\n        return electricCharacterSupport.onElectricCharacter(character, scopedLineTokens, column - scopedLineTokens.firstCharOffset);\r\n    };\r\n    // end electricCharacter\r\n    LanguageConfigurationRegistryImpl.prototype.getComments = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        return value.comments || null;\r\n    };\r\n    // begin characterPair\r\n    LanguageConfigurationRegistryImpl.prototype._getCharacterPairSupport = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        return value.characterPair || null;\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getAutoClosingPairs = function (languageId) {\r\n        var characterPairSupport = this._getCharacterPairSupport(languageId);\r\n        if (!characterPairSupport) {\r\n            return [];\r\n        }\r\n        return characterPairSupport.getAutoClosingPairs();\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getAutoCloseBeforeSet = function (languageId) {\r\n        var characterPairSupport = this._getCharacterPairSupport(languageId);\r\n        if (!characterPairSupport) {\r\n            return CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED;\r\n        }\r\n        return characterPairSupport.getAutoCloseBeforeSet();\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getSurroundingPairs = function (languageId) {\r\n        var characterPairSupport = this._getCharacterPairSupport(languageId);\r\n        if (!characterPairSupport) {\r\n            return [];\r\n        }\r\n        return characterPairSupport.getSurroundingPairs();\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.shouldAutoClosePair = function (autoClosingPair, context, column) {\r\n        var scopedLineTokens = createScopedLineTokens(context, column - 1);\r\n        return CharacterPairSupport.shouldAutoClosePair(autoClosingPair, scopedLineTokens, column - scopedLineTokens.firstCharOffset);\r\n    };\r\n    // end characterPair\r\n    LanguageConfigurationRegistryImpl.prototype.getWordDefinition = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return ensureValidWordDefinition(null);\r\n        }\r\n        return ensureValidWordDefinition(value.wordDefinition || null);\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getFoldingRules = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return {};\r\n        }\r\n        return value.foldingRules;\r\n    };\r\n    // begin Indent Rules\r\n    LanguageConfigurationRegistryImpl.prototype.getIndentRulesSupport = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        return value.indentRulesSupport || null;\r\n    };\r\n    /**\r\n     * Get nearest preceiding line which doesn't match unIndentPattern or contains all whitespace.\r\n     * Result:\r\n     * -1: run into the boundary of embedded languages\r\n     * 0: every line above are invalid\r\n     * else: nearest preceding line of the same language\r\n     */\r\n    LanguageConfigurationRegistryImpl.prototype.getPrecedingValidLine = function (model, lineNumber, indentRulesSupport) {\r\n        var languageID = model.getLanguageIdAtPosition(lineNumber, 0);\r\n        if (lineNumber > 1) {\r\n            var lastLineNumber = void 0;\r\n            var resultLineNumber = -1;\r\n            for (lastLineNumber = lineNumber - 1; lastLineNumber >= 1; lastLineNumber--) {\r\n                if (model.getLanguageIdAtPosition(lastLineNumber, 0) !== languageID) {\r\n                    return resultLineNumber;\r\n                }\r\n                var text = model.getLineContent(lastLineNumber);\r\n                if (indentRulesSupport.shouldIgnore(text) || /^\\s+$/.test(text) || text === '') {\r\n                    resultLineNumber = lastLineNumber;\r\n                    continue;\r\n                }\r\n                return lastLineNumber;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    /**\r\n     * Get inherited indentation from above lines.\r\n     * 1. Find the nearest preceding line which doesn't match unIndentedLinePattern.\r\n     * 2. If this line matches indentNextLinePattern or increaseIndentPattern, it means that the indent level of `lineNumber` should be 1 greater than this line.\r\n     * 3. If this line doesn't match any indent rules\r\n     *   a. check whether the line above it matches indentNextLinePattern\r\n     *   b. If not, the indent level of this line is the result\r\n     *   c. If so, it means the indent of this line is *temporary*, go upward utill we find a line whose indent is not temporary (the same workflow a -> b -> c).\r\n     * 4. Otherwise, we fail to get an inherited indent from aboves. Return null and we should not touch the indent of `lineNumber`\r\n     *\r\n     * This function only return the inherited indent based on above lines, it doesn't check whether current line should decrease or not.\r\n     */\r\n    LanguageConfigurationRegistryImpl.prototype.getInheritIndentForLine = function (autoIndent, model, lineNumber, honorIntentialIndent) {\r\n        if (honorIntentialIndent === void 0) { honorIntentialIndent = true; }\r\n        if (autoIndent < 4 /* Full */) {\r\n            return null;\r\n        }\r\n        var indentRulesSupport = this.getIndentRulesSupport(model.getLanguageIdentifier().id);\r\n        if (!indentRulesSupport) {\r\n            return null;\r\n        }\r\n        if (lineNumber <= 1) {\r\n            return {\r\n                indentation: '',\r\n                action: null\r\n            };\r\n        }\r\n        var precedingUnIgnoredLine = this.getPrecedingValidLine(model, lineNumber, indentRulesSupport);\r\n        if (precedingUnIgnoredLine < 0) {\r\n            return null;\r\n        }\r\n        else if (precedingUnIgnoredLine < 1) {\r\n            return {\r\n                indentation: '',\r\n                action: null\r\n            };\r\n        }\r\n        var precedingUnIgnoredLineContent = model.getLineContent(precedingUnIgnoredLine);\r\n        if (indentRulesSupport.shouldIncrease(precedingUnIgnoredLineContent) || indentRulesSupport.shouldIndentNextLine(precedingUnIgnoredLineContent)) {\r\n            return {\r\n                indentation: strings.getLeadingWhitespace(precedingUnIgnoredLineContent),\r\n                action: IndentAction.Indent,\r\n                line: precedingUnIgnoredLine\r\n            };\r\n        }\r\n        else if (indentRulesSupport.shouldDecrease(precedingUnIgnoredLineContent)) {\r\n            return {\r\n                indentation: strings.getLeadingWhitespace(precedingUnIgnoredLineContent),\r\n                action: null,\r\n                line: precedingUnIgnoredLine\r\n            };\r\n        }\r\n        else {\r\n            // precedingUnIgnoredLine can not be ignored.\r\n            // it doesn't increase indent of following lines\r\n            // it doesn't increase just next line\r\n            // so current line is not affect by precedingUnIgnoredLine\r\n            // and then we should get a correct inheritted indentation from above lines\r\n            if (precedingUnIgnoredLine === 1) {\r\n                return {\r\n                    indentation: strings.getLeadingWhitespace(model.getLineContent(precedingUnIgnoredLine)),\r\n                    action: null,\r\n                    line: precedingUnIgnoredLine\r\n                };\r\n            }\r\n            var previousLine = precedingUnIgnoredLine - 1;\r\n            var previousLineIndentMetadata = indentRulesSupport.getIndentMetadata(model.getLineContent(previousLine));\r\n            if (!(previousLineIndentMetadata & (1 /* INCREASE_MASK */ | 2 /* DECREASE_MASK */)) &&\r\n                (previousLineIndentMetadata & 4 /* INDENT_NEXTLINE_MASK */)) {\r\n                var stopLine = 0;\r\n                for (var i = previousLine - 1; i > 0; i--) {\r\n                    if (indentRulesSupport.shouldIndentNextLine(model.getLineContent(i))) {\r\n                        continue;\r\n                    }\r\n                    stopLine = i;\r\n                    break;\r\n                }\r\n                return {\r\n                    indentation: strings.getLeadingWhitespace(model.getLineContent(stopLine + 1)),\r\n                    action: null,\r\n                    line: stopLine + 1\r\n                };\r\n            }\r\n            if (honorIntentialIndent) {\r\n                return {\r\n                    indentation: strings.getLeadingWhitespace(model.getLineContent(precedingUnIgnoredLine)),\r\n                    action: null,\r\n                    line: precedingUnIgnoredLine\r\n                };\r\n            }\r\n            else {\r\n                // search from precedingUnIgnoredLine until we find one whose indent is not temporary\r\n                for (var i = precedingUnIgnoredLine; i > 0; i--) {\r\n                    var lineContent = model.getLineContent(i);\r\n                    if (indentRulesSupport.shouldIncrease(lineContent)) {\r\n                        return {\r\n                            indentation: strings.getLeadingWhitespace(lineContent),\r\n                            action: IndentAction.Indent,\r\n                            line: i\r\n                        };\r\n                    }\r\n                    else if (indentRulesSupport.shouldIndentNextLine(lineContent)) {\r\n                        var stopLine = 0;\r\n                        for (var j = i - 1; j > 0; j--) {\r\n                            if (indentRulesSupport.shouldIndentNextLine(model.getLineContent(i))) {\r\n                                continue;\r\n                            }\r\n                            stopLine = j;\r\n                            break;\r\n                        }\r\n                        return {\r\n                            indentation: strings.getLeadingWhitespace(model.getLineContent(stopLine + 1)),\r\n                            action: null,\r\n                            line: stopLine + 1\r\n                        };\r\n                    }\r\n                    else if (indentRulesSupport.shouldDecrease(lineContent)) {\r\n                        return {\r\n                            indentation: strings.getLeadingWhitespace(lineContent),\r\n                            action: null,\r\n                            line: i\r\n                        };\r\n                    }\r\n                }\r\n                return {\r\n                    indentation: strings.getLeadingWhitespace(model.getLineContent(1)),\r\n                    action: null,\r\n                    line: 1\r\n                };\r\n            }\r\n        }\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getGoodIndentForLine = function (autoIndent, virtualModel, languageId, lineNumber, indentConverter) {\r\n        if (autoIndent < 4 /* Full */) {\r\n            return null;\r\n        }\r\n        var richEditSupport = this._getRichEditSupport(languageId);\r\n        if (!richEditSupport) {\r\n            return null;\r\n        }\r\n        var indentRulesSupport = this.getIndentRulesSupport(languageId);\r\n        if (!indentRulesSupport) {\r\n            return null;\r\n        }\r\n        var indent = this.getInheritIndentForLine(autoIndent, virtualModel, lineNumber);\r\n        var lineContent = virtualModel.getLineContent(lineNumber);\r\n        if (indent) {\r\n            var inheritLine = indent.line;\r\n            if (inheritLine !== undefined) {\r\n                var enterResult = richEditSupport.onEnter(autoIndent, '', virtualModel.getLineContent(inheritLine), '');\r\n                if (enterResult) {\r\n                    var indentation = strings.getLeadingWhitespace(virtualModel.getLineContent(inheritLine));\r\n                    if (enterResult.removeText) {\r\n                        indentation = indentation.substring(0, indentation.length - enterResult.removeText);\r\n                    }\r\n                    if ((enterResult.indentAction === IndentAction.Indent) ||\r\n                        (enterResult.indentAction === IndentAction.IndentOutdent)) {\r\n                        indentation = indentConverter.shiftIndent(indentation);\r\n                    }\r\n                    else if (enterResult.indentAction === IndentAction.Outdent) {\r\n                        indentation = indentConverter.unshiftIndent(indentation);\r\n                    }\r\n                    if (indentRulesSupport.shouldDecrease(lineContent)) {\r\n                        indentation = indentConverter.unshiftIndent(indentation);\r\n                    }\r\n                    if (enterResult.appendText) {\r\n                        indentation += enterResult.appendText;\r\n                    }\r\n                    return strings.getLeadingWhitespace(indentation);\r\n                }\r\n            }\r\n            if (indentRulesSupport.shouldDecrease(lineContent)) {\r\n                if (indent.action === IndentAction.Indent) {\r\n                    return indent.indentation;\r\n                }\r\n                else {\r\n                    return indentConverter.unshiftIndent(indent.indentation);\r\n                }\r\n            }\r\n            else {\r\n                if (indent.action === IndentAction.Indent) {\r\n                    return indentConverter.shiftIndent(indent.indentation);\r\n                }\r\n                else {\r\n                    return indent.indentation;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getIndentForEnter = function (autoIndent, model, range, indentConverter) {\r\n        if (autoIndent < 4 /* Full */) {\r\n            return null;\r\n        }\r\n        model.forceTokenization(range.startLineNumber);\r\n        var lineTokens = model.getLineTokens(range.startLineNumber);\r\n        var scopedLineTokens = createScopedLineTokens(lineTokens, range.startColumn - 1);\r\n        var scopedLineText = scopedLineTokens.getLineContent();\r\n        var embeddedLanguage = false;\r\n        var beforeEnterText;\r\n        if (scopedLineTokens.firstCharOffset > 0 && lineTokens.getLanguageId(0) !== scopedLineTokens.languageId) {\r\n            // we are in the embeded language content\r\n            embeddedLanguage = true; // if embeddedLanguage is true, then we don't touch the indentation of current line\r\n            beforeEnterText = scopedLineText.substr(0, range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        else {\r\n            beforeEnterText = lineTokens.getLineContent().substring(0, range.startColumn - 1);\r\n        }\r\n        var afterEnterText;\r\n        if (range.isEmpty()) {\r\n            afterEnterText = scopedLineText.substr(range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        else {\r\n            var endScopedLineTokens = this.getScopedLineTokens(model, range.endLineNumber, range.endColumn);\r\n            afterEnterText = endScopedLineTokens.getLineContent().substr(range.endColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        var indentRulesSupport = this.getIndentRulesSupport(scopedLineTokens.languageId);\r\n        if (!indentRulesSupport) {\r\n            return null;\r\n        }\r\n        var beforeEnterResult = beforeEnterText;\r\n        var beforeEnterIndent = strings.getLeadingWhitespace(beforeEnterText);\r\n        var virtualModel = {\r\n            getLineTokens: function (lineNumber) {\r\n                return model.getLineTokens(lineNumber);\r\n            },\r\n            getLanguageIdentifier: function () {\r\n                return model.getLanguageIdentifier();\r\n            },\r\n            getLanguageIdAtPosition: function (lineNumber, column) {\r\n                return model.getLanguageIdAtPosition(lineNumber, column);\r\n            },\r\n            getLineContent: function (lineNumber) {\r\n                if (lineNumber === range.startLineNumber) {\r\n                    return beforeEnterResult;\r\n                }\r\n                else {\r\n                    return model.getLineContent(lineNumber);\r\n                }\r\n            }\r\n        };\r\n        var currentLineIndent = strings.getLeadingWhitespace(lineTokens.getLineContent());\r\n        var afterEnterAction = this.getInheritIndentForLine(autoIndent, virtualModel, range.startLineNumber + 1);\r\n        if (!afterEnterAction) {\r\n            var beforeEnter = embeddedLanguage ? currentLineIndent : beforeEnterIndent;\r\n            return {\r\n                beforeEnter: beforeEnter,\r\n                afterEnter: beforeEnter\r\n            };\r\n        }\r\n        var afterEnterIndent = embeddedLanguage ? currentLineIndent : afterEnterAction.indentation;\r\n        if (afterEnterAction.action === IndentAction.Indent) {\r\n            afterEnterIndent = indentConverter.shiftIndent(afterEnterIndent);\r\n        }\r\n        if (indentRulesSupport.shouldDecrease(afterEnterText)) {\r\n            afterEnterIndent = indentConverter.unshiftIndent(afterEnterIndent);\r\n        }\r\n        return {\r\n            beforeEnter: embeddedLanguage ? currentLineIndent : beforeEnterIndent,\r\n            afterEnter: afterEnterIndent\r\n        };\r\n    };\r\n    /**\r\n     * We should always allow intentional indentation. It means, if users change the indentation of `lineNumber` and the content of\r\n     * this line doesn't match decreaseIndentPattern, we should not adjust the indentation.\r\n     */\r\n    LanguageConfigurationRegistryImpl.prototype.getIndentActionForType = function (autoIndent, model, range, ch, indentConverter) {\r\n        if (autoIndent < 4 /* Full */) {\r\n            return null;\r\n        }\r\n        var scopedLineTokens = this.getScopedLineTokens(model, range.startLineNumber, range.startColumn);\r\n        var indentRulesSupport = this.getIndentRulesSupport(scopedLineTokens.languageId);\r\n        if (!indentRulesSupport) {\r\n            return null;\r\n        }\r\n        var scopedLineText = scopedLineTokens.getLineContent();\r\n        var beforeTypeText = scopedLineText.substr(0, range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        // selection support\r\n        var afterTypeText;\r\n        if (range.isEmpty()) {\r\n            afterTypeText = scopedLineText.substr(range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        else {\r\n            var endScopedLineTokens = this.getScopedLineTokens(model, range.endLineNumber, range.endColumn);\r\n            afterTypeText = endScopedLineTokens.getLineContent().substr(range.endColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        // If previous content already matches decreaseIndentPattern, it means indentation of this line should already be adjusted\r\n        // Users might change the indentation by purpose and we should honor that instead of readjusting.\r\n        if (!indentRulesSupport.shouldDecrease(beforeTypeText + afterTypeText) && indentRulesSupport.shouldDecrease(beforeTypeText + ch + afterTypeText)) {\r\n            // after typing `ch`, the content matches decreaseIndentPattern, we should adjust the indent to a good manner.\r\n            // 1. Get inherited indent action\r\n            var r = this.getInheritIndentForLine(autoIndent, model, range.startLineNumber, false);\r\n            if (!r) {\r\n                return null;\r\n            }\r\n            var indentation = r.indentation;\r\n            if (r.action !== IndentAction.Indent) {\r\n                indentation = indentConverter.unshiftIndent(indentation);\r\n            }\r\n            return indentation;\r\n        }\r\n        return null;\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getIndentMetadata = function (model, lineNumber) {\r\n        var indentRulesSupport = this.getIndentRulesSupport(model.getLanguageIdentifier().id);\r\n        if (!indentRulesSupport) {\r\n            return null;\r\n        }\r\n        if (lineNumber < 1 || lineNumber > model.getLineCount()) {\r\n            return null;\r\n        }\r\n        return indentRulesSupport.getIndentMetadata(model.getLineContent(lineNumber));\r\n    };\r\n    // end Indent Rules\r\n    // begin onEnter\r\n    LanguageConfigurationRegistryImpl.prototype.getEnterAction = function (autoIndent, model, range) {\r\n        var scopedLineTokens = this.getScopedLineTokens(model, range.startLineNumber, range.startColumn);\r\n        var richEditSupport = this._getRichEditSupport(scopedLineTokens.languageId);\r\n        if (!richEditSupport) {\r\n            return null;\r\n        }\r\n        var scopedLineText = scopedLineTokens.getLineContent();\r\n        var beforeEnterText = scopedLineText.substr(0, range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        // selection support\r\n        var afterEnterText;\r\n        if (range.isEmpty()) {\r\n            afterEnterText = scopedLineText.substr(range.startColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        else {\r\n            var endScopedLineTokens = this.getScopedLineTokens(model, range.endLineNumber, range.endColumn);\r\n            afterEnterText = endScopedLineTokens.getLineContent().substr(range.endColumn - 1 - scopedLineTokens.firstCharOffset);\r\n        }\r\n        var oneLineAboveText = '';\r\n        if (range.startLineNumber > 1 && scopedLineTokens.firstCharOffset === 0) {\r\n            // This is not the first line and the entire line belongs to this mode\r\n            var oneLineAboveScopedLineTokens = this.getScopedLineTokens(model, range.startLineNumber - 1);\r\n            if (oneLineAboveScopedLineTokens.languageId === scopedLineTokens.languageId) {\r\n                // The line above ends with text belonging to the same mode\r\n                oneLineAboveText = oneLineAboveScopedLineTokens.getLineContent();\r\n            }\r\n        }\r\n        var enterResult = richEditSupport.onEnter(autoIndent, oneLineAboveText, beforeEnterText, afterEnterText);\r\n        if (!enterResult) {\r\n            return null;\r\n        }\r\n        var indentAction = enterResult.indentAction;\r\n        var appendText = enterResult.appendText;\r\n        var removeText = enterResult.removeText || 0;\r\n        // Here we add `\\t` to appendText first because enterAction is leveraging appendText and removeText to change indentation.\r\n        if (!appendText) {\r\n            if ((indentAction === IndentAction.Indent) ||\r\n                (indentAction === IndentAction.IndentOutdent)) {\r\n                appendText = '\\t';\r\n            }\r\n            else {\r\n                appendText = '';\r\n            }\r\n        }\r\n        var indentation = this.getIndentationAtPosition(model, range.startLineNumber, range.startColumn);\r\n        if (removeText) {\r\n            indentation = indentation.substring(0, indentation.length - removeText);\r\n        }\r\n        return {\r\n            indentAction: indentAction,\r\n            appendText: appendText,\r\n            removeText: removeText,\r\n            indentation: indentation\r\n        };\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getIndentationAtPosition = function (model, lineNumber, column) {\r\n        var lineText = model.getLineContent(lineNumber);\r\n        var indentation = strings.getLeadingWhitespace(lineText);\r\n        if (indentation.length > column - 1) {\r\n            indentation = indentation.substring(0, column - 1);\r\n        }\r\n        return indentation;\r\n    };\r\n    LanguageConfigurationRegistryImpl.prototype.getScopedLineTokens = function (model, lineNumber, columnNumber) {\r\n        model.forceTokenization(lineNumber);\r\n        var lineTokens = model.getLineTokens(lineNumber);\r\n        var column = (typeof columnNumber === 'undefined' ? model.getLineMaxColumn(lineNumber) - 1 : columnNumber - 1);\r\n        return createScopedLineTokens(lineTokens, column);\r\n    };\r\n    // end onEnter\r\n    LanguageConfigurationRegistryImpl.prototype.getBracketsSupport = function (languageId) {\r\n        var value = this._getRichEditSupport(languageId);\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        return value.brackets || null;\r\n    };\r\n    return LanguageConfigurationRegistryImpl;\r\n}());\r\nexport { LanguageConfigurationRegistryImpl };\r\nexport var LanguageConfigurationRegistry = new LanguageConfigurationRegistryImpl();\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport { withUndefinedAsNull } from '../../../base/common/types.js';\r\nimport { keys } from '../../../base/common/map.js';\r\nvar TokenizationRegistryImpl = /** @class */ (function () {\r\n    function TokenizationRegistryImpl() {\r\n        this._map = new Map();\r\n        this._promises = new Map();\r\n        this._onDidChange = new Emitter();\r\n        this.onDidChange = this._onDidChange.event;\r\n        this._colorMap = null;\r\n    }\r\n    TokenizationRegistryImpl.prototype.fire = function (languages) {\r\n        this._onDidChange.fire({\r\n            changedLanguages: languages,\r\n            changedColorMap: false\r\n        });\r\n    };\r\n    TokenizationRegistryImpl.prototype.register = function (language, support) {\r\n        var _this = this;\r\n        this._map.set(language, support);\r\n        this.fire([language]);\r\n        return toDisposable(function () {\r\n            if (_this._map.get(language) !== support) {\r\n                return;\r\n            }\r\n            _this._map.delete(language);\r\n            _this.fire([language]);\r\n        });\r\n    };\r\n    TokenizationRegistryImpl.prototype.registerPromise = function (language, supportPromise) {\r\n        var _this = this;\r\n        var registration = null;\r\n        var isDisposed = false;\r\n        this._promises.set(language, supportPromise.then(function (support) {\r\n            _this._promises.delete(language);\r\n            if (isDisposed || !support) {\r\n                return;\r\n            }\r\n            registration = _this.register(language, support);\r\n        }));\r\n        return toDisposable(function () {\r\n            isDisposed = true;\r\n            if (registration) {\r\n                registration.dispose();\r\n            }\r\n        });\r\n    };\r\n    TokenizationRegistryImpl.prototype.getPromise = function (language) {\r\n        var _this = this;\r\n        var support = this.get(language);\r\n        if (support) {\r\n            return Promise.resolve(support);\r\n        }\r\n        var promise = this._promises.get(language);\r\n        if (promise) {\r\n            return promise.then(function (_) { return _this.get(language); });\r\n        }\r\n        return null;\r\n    };\r\n    TokenizationRegistryImpl.prototype.get = function (language) {\r\n        return withUndefinedAsNull(this._map.get(language));\r\n    };\r\n    TokenizationRegistryImpl.prototype.setColorMap = function (colorMap) {\r\n        this._colorMap = colorMap;\r\n        this._onDidChange.fire({\r\n            changedLanguages: keys(this._map),\r\n            changedColorMap: true\r\n        });\r\n    };\r\n    TokenizationRegistryImpl.prototype.getColorMap = function () {\r\n        return this._colorMap;\r\n    };\r\n    TokenizationRegistryImpl.prototype.getDefaultBackground = function () {\r\n        if (this._colorMap && this._colorMap.length > 2 /* DefaultBackground */) {\r\n            return this._colorMap[2 /* DefaultBackground */];\r\n        }\r\n        return null;\r\n    };\r\n    return TokenizationRegistryImpl;\r\n}());\r\nexport { TokenizationRegistryImpl };\r\n","import { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var ITextResourceConfigurationService = createDecorator('textResourceConfigurationService');\r\nexport var ITextResourcePropertiesService = createDecorator('textResourcePropertiesService');\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Schemas } from '../../../base/common/network.js';\r\nimport { DataUri, basenameOrAuthority } from '../../../base/common/resources.js';\r\nimport { PLAINTEXT_MODE_ID } from '../modes/modesRegistry.js';\r\nimport { FileKind } from '../../../platform/files/common/files.js';\r\nexport function getIconClasses(modelService, modeService, resource, fileKind) {\r\n    // we always set these base classes even if we do not have a path\r\n    var classes = fileKind === FileKind.ROOT_FOLDER ? ['rootfolder-icon'] : fileKind === FileKind.FOLDER ? ['folder-icon'] : ['file-icon'];\r\n    if (resource) {\r\n        // Get the path and name of the resource. For data-URIs, we need to parse specially\r\n        var name_1;\r\n        if (resource.scheme === Schemas.data) {\r\n            var metadata = DataUri.parseMetaData(resource);\r\n            name_1 = metadata.get(DataUri.META_DATA_LABEL);\r\n        }\r\n        else {\r\n            name_1 = cssEscape(basenameOrAuthority(resource).toLowerCase());\r\n        }\r\n        // Folders\r\n        if (fileKind === FileKind.FOLDER) {\r\n            classes.push(name_1 + \"-name-folder-icon\");\r\n        }\r\n        // Files\r\n        else {\r\n            // Name & Extension(s)\r\n            if (name_1) {\r\n                classes.push(name_1 + \"-name-file-icon\");\r\n                var dotSegments = name_1.split('.');\r\n                for (var i = 1; i < dotSegments.length; i++) {\r\n                    classes.push(dotSegments.slice(i).join('.') + \"-ext-file-icon\"); // add each combination of all found extensions if more than one\r\n                }\r\n                classes.push(\"ext-file-icon\"); // extra segment to increase file-ext score\r\n            }\r\n            // Detected Mode\r\n            var detectedModeId = detectModeId(modelService, modeService, resource);\r\n            if (detectedModeId) {\r\n                classes.push(cssEscape(detectedModeId) + \"-lang-file-icon\");\r\n            }\r\n        }\r\n    }\r\n    return classes;\r\n}\r\nexport function detectModeId(modelService, modeService, resource) {\r\n    if (!resource) {\r\n        return null; // we need a resource at least\r\n    }\r\n    var modeId = null;\r\n    // Data URI: check for encoded metadata\r\n    if (resource.scheme === Schemas.data) {\r\n        var metadata = DataUri.parseMetaData(resource);\r\n        var mime = metadata.get(DataUri.META_DATA_MIME);\r\n        if (mime) {\r\n            modeId = modeService.getModeId(mime);\r\n        }\r\n    }\r\n    // Any other URI: check for model if existing\r\n    else {\r\n        var model = modelService.getModel(resource);\r\n        if (model) {\r\n            modeId = model.getModeId();\r\n        }\r\n    }\r\n    // only take if the mode is specific (aka no just plain text)\r\n    if (modeId && modeId !== PLAINTEXT_MODE_ID) {\r\n        return modeId;\r\n    }\r\n    // otherwise fallback to path based detection\r\n    return modeService.getModeIdByFilepathOrFirstLine(resource);\r\n}\r\nexport function cssEscape(val) {\r\n    return val.replace(/\\s/g, '\\\\$&'); // make sure to not introduce CSS classes from files that contain whitespace\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Token, TokenizationResult, TokenizationResult2 } from '../core/token.js';\r\nimport { LanguageIdentifier } from '../modes.js';\r\nvar NullStateImpl = /** @class */ (function () {\r\n    function NullStateImpl() {\r\n    }\r\n    NullStateImpl.prototype.clone = function () {\r\n        return this;\r\n    };\r\n    NullStateImpl.prototype.equals = function (other) {\r\n        return (this === other);\r\n    };\r\n    return NullStateImpl;\r\n}());\r\nexport var NULL_STATE = new NullStateImpl();\r\nexport var NULL_MODE_ID = 'vs.editor.nullMode';\r\nexport var NULL_LANGUAGE_IDENTIFIER = new LanguageIdentifier(NULL_MODE_ID, 0 /* Null */);\r\nexport function nullTokenize(modeId, buffer, state, deltaOffset) {\r\n    return new TokenizationResult([new Token(deltaOffset, '', modeId)], state);\r\n}\r\nexport function nullTokenize2(languageId, buffer, state, deltaOffset) {\r\n    var tokens = new Uint32Array(2);\r\n    tokens[0] = deltaOffset;\r\n    tokens[1] = ((languageId << 0 /* LANGUAGEID_OFFSET */)\r\n        | (0 /* Other */ << 8 /* TOKEN_TYPE_OFFSET */)\r\n        | (0 /* None */ << 11 /* FONT_STYLE_OFFSET */)\r\n        | (1 /* DefaultForeground */ << 14 /* FOREGROUND_OFFSET */)\r\n        | (2 /* DefaultBackground */ << 23 /* BACKGROUND_OFFSET */)) >>> 0;\r\n    return new TokenizationResult2(tokens, state === null ? NULL_STATE : state);\r\n}\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var ID_EDITOR_WORKER_SERVICE = 'editorWorkerService';\r\nexport var IEditorWorkerService = createDecorator(ID_EDITOR_WORKER_SERVICE);\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { EditorWorkerClient } from './editorWorkerServiceImpl.js';\r\nimport * as types from '../../../base/common/types.js';\r\n/**\r\n * Create a new web worker that has model syncing capabilities built in.\r\n * Specify an AMD module to load that will `create` an object that will be proxied.\r\n */\r\nexport function createWebWorker(modelService, opts) {\r\n    return new MonacoWebWorkerImpl(modelService, opts);\r\n}\r\nvar MonacoWebWorkerImpl = /** @class */ (function (_super) {\r\n    __extends(MonacoWebWorkerImpl, _super);\r\n    function MonacoWebWorkerImpl(modelService, opts) {\r\n        var _this = _super.call(this, modelService, opts.keepIdleModels || false, opts.label) || this;\r\n        _this._foreignModuleId = opts.moduleId;\r\n        _this._foreignModuleCreateData = opts.createData || null;\r\n        _this._foreignModuleHost = opts.host || null;\r\n        _this._foreignProxy = null;\r\n        return _this;\r\n    }\r\n    // foreign host request\r\n    MonacoWebWorkerImpl.prototype.fhr = function (method, args) {\r\n        if (!this._foreignModuleHost || typeof this._foreignModuleHost[method] !== 'function') {\r\n            return Promise.reject(new Error('Missing method ' + method + ' or missing main thread foreign host.'));\r\n        }\r\n        try {\r\n            return Promise.resolve(this._foreignModuleHost[method].apply(this._foreignModuleHost, args));\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    };\r\n    MonacoWebWorkerImpl.prototype._getForeignProxy = function () {\r\n        var _this = this;\r\n        if (!this._foreignProxy) {\r\n            this._foreignProxy = this._getProxy().then(function (proxy) {\r\n                var foreignHostMethods = _this._foreignModuleHost ? types.getAllMethodNames(_this._foreignModuleHost) : [];\r\n                return proxy.loadForeignModule(_this._foreignModuleId, _this._foreignModuleCreateData, foreignHostMethods).then(function (foreignMethods) {\r\n                    _this._foreignModuleCreateData = null;\r\n                    var proxyMethodRequest = function (method, args) {\r\n                        return proxy.fmr(method, args);\r\n                    };\r\n                    var createProxyMethod = function (method, proxyMethodRequest) {\r\n                        return function () {\r\n                            var args = Array.prototype.slice.call(arguments, 0);\r\n                            return proxyMethodRequest(method, args);\r\n                        };\r\n                    };\r\n                    var foreignProxy = {};\r\n                    for (var _i = 0, foreignMethods_1 = foreignMethods; _i < foreignMethods_1.length; _i++) {\r\n                        var foreignMethod = foreignMethods_1[_i];\r\n                        foreignProxy[foreignMethod] = createProxyMethod(foreignMethod, proxyMethodRequest);\r\n                    }\r\n                    return foreignProxy;\r\n                });\r\n            });\r\n        }\r\n        return this._foreignProxy;\r\n    };\r\n    MonacoWebWorkerImpl.prototype.getProxy = function () {\r\n        return this._getForeignProxy();\r\n    };\r\n    MonacoWebWorkerImpl.prototype.withSyncedResources = function (resources) {\r\n        var _this = this;\r\n        return this._withSyncedResources(resources).then(function (_) { return _this.getProxy(); });\r\n    };\r\n    return MonacoWebWorkerImpl;\r\n}(EditorWorkerClient));\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var ITextModelService = createDecorator('textModelService');\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar FrankensteinMode = /** @class */ (function () {\r\n    function FrankensteinMode(languageIdentifier) {\r\n        this._languageIdentifier = languageIdentifier;\r\n    }\r\n    FrankensteinMode.prototype.getId = function () {\r\n        return this._languageIdentifier.language;\r\n    };\r\n    return FrankensteinMode;\r\n}());\r\nexport { FrankensteinMode };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as mime from '../../../base/common/mime.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { LanguageIdentifier } from '../modes.js';\r\nimport { ModesRegistry } from '../modes/modesRegistry.js';\r\nimport { NULL_LANGUAGE_IDENTIFIER, NULL_MODE_ID } from '../modes/nullMode.js';\r\nimport { Extensions } from '../../../platform/configuration/common/configurationRegistry.js';\r\nimport { Registry } from '../../../platform/registry/common/platform.js';\r\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\r\nvar LanguagesRegistry = /** @class */ (function (_super) {\r\n    __extends(LanguagesRegistry, _super);\r\n    function LanguagesRegistry(useModesRegistry, warnOnOverwrite) {\r\n        if (useModesRegistry === void 0) { useModesRegistry = true; }\r\n        if (warnOnOverwrite === void 0) { warnOnOverwrite = false; }\r\n        var _this = _super.call(this) || this;\r\n        _this._onDidChange = _this._register(new Emitter());\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._warnOnOverwrite = warnOnOverwrite;\r\n        _this._nextLanguageId2 = 1;\r\n        _this._languageIdToLanguage = [];\r\n        _this._languageToLanguageId = Object.create(null);\r\n        _this._languages = {};\r\n        _this._mimeTypesMap = {};\r\n        _this._nameMap = {};\r\n        _this._lowercaseNameMap = {};\r\n        if (useModesRegistry) {\r\n            _this._initializeFromRegistry();\r\n            _this._register(ModesRegistry.onDidChangeLanguages(function (m) { return _this._initializeFromRegistry(); }));\r\n        }\r\n        return _this;\r\n    }\r\n    LanguagesRegistry.prototype._initializeFromRegistry = function () {\r\n        this._languages = {};\r\n        this._mimeTypesMap = {};\r\n        this._nameMap = {};\r\n        this._lowercaseNameMap = {};\r\n        var desc = ModesRegistry.getLanguages();\r\n        this._registerLanguages(desc);\r\n    };\r\n    LanguagesRegistry.prototype._registerLanguages = function (desc) {\r\n        var _this = this;\r\n        for (var _i = 0, desc_1 = desc; _i < desc_1.length; _i++) {\r\n            var d = desc_1[_i];\r\n            this._registerLanguage(d);\r\n        }\r\n        // Rebuild fast path maps\r\n        this._mimeTypesMap = {};\r\n        this._nameMap = {};\r\n        this._lowercaseNameMap = {};\r\n        Object.keys(this._languages).forEach(function (langId) {\r\n            var language = _this._languages[langId];\r\n            if (language.name) {\r\n                _this._nameMap[language.name] = language.identifier;\r\n            }\r\n            language.aliases.forEach(function (alias) {\r\n                _this._lowercaseNameMap[alias.toLowerCase()] = language.identifier;\r\n            });\r\n            language.mimetypes.forEach(function (mimetype) {\r\n                _this._mimeTypesMap[mimetype] = language.identifier;\r\n            });\r\n        });\r\n        Registry.as(Extensions.Configuration).registerOverrideIdentifiers(ModesRegistry.getLanguages().map(function (language) { return language.id; }));\r\n        this._onDidChange.fire();\r\n    };\r\n    LanguagesRegistry.prototype._getLanguageId = function (language) {\r\n        if (this._languageToLanguageId[language]) {\r\n            return this._languageToLanguageId[language];\r\n        }\r\n        var languageId = this._nextLanguageId2++;\r\n        this._languageIdToLanguage[languageId] = language;\r\n        this._languageToLanguageId[language] = languageId;\r\n        return languageId;\r\n    };\r\n    LanguagesRegistry.prototype._registerLanguage = function (lang) {\r\n        var langId = lang.id;\r\n        var resolvedLanguage;\r\n        if (hasOwnProperty.call(this._languages, langId)) {\r\n            resolvedLanguage = this._languages[langId];\r\n        }\r\n        else {\r\n            var languageId = this._getLanguageId(langId);\r\n            resolvedLanguage = {\r\n                identifier: new LanguageIdentifier(langId, languageId),\r\n                name: null,\r\n                mimetypes: [],\r\n                aliases: [],\r\n                extensions: [],\r\n                filenames: [],\r\n                configurationFiles: []\r\n            };\r\n            this._languages[langId] = resolvedLanguage;\r\n        }\r\n        this._mergeLanguage(resolvedLanguage, lang);\r\n    };\r\n    LanguagesRegistry.prototype._mergeLanguage = function (resolvedLanguage, lang) {\r\n        var _a;\r\n        var langId = lang.id;\r\n        var primaryMime = null;\r\n        if (Array.isArray(lang.mimetypes) && lang.mimetypes.length > 0) {\r\n            (_a = resolvedLanguage.mimetypes).push.apply(_a, lang.mimetypes);\r\n            primaryMime = lang.mimetypes[0];\r\n        }\r\n        if (!primaryMime) {\r\n            primaryMime = \"text/x-\" + langId;\r\n            resolvedLanguage.mimetypes.push(primaryMime);\r\n        }\r\n        if (Array.isArray(lang.extensions)) {\r\n            for (var _i = 0, _b = lang.extensions; _i < _b.length; _i++) {\r\n                var extension = _b[_i];\r\n                mime.registerTextMime({ id: langId, mime: primaryMime, extension: extension }, this._warnOnOverwrite);\r\n                resolvedLanguage.extensions.push(extension);\r\n            }\r\n        }\r\n        if (Array.isArray(lang.filenames)) {\r\n            for (var _c = 0, _d = lang.filenames; _c < _d.length; _c++) {\r\n                var filename = _d[_c];\r\n                mime.registerTextMime({ id: langId, mime: primaryMime, filename: filename }, this._warnOnOverwrite);\r\n                resolvedLanguage.filenames.push(filename);\r\n            }\r\n        }\r\n        if (Array.isArray(lang.filenamePatterns)) {\r\n            for (var _e = 0, _f = lang.filenamePatterns; _e < _f.length; _e++) {\r\n                var filenamePattern = _f[_e];\r\n                mime.registerTextMime({ id: langId, mime: primaryMime, filepattern: filenamePattern }, this._warnOnOverwrite);\r\n            }\r\n        }\r\n        if (typeof lang.firstLine === 'string' && lang.firstLine.length > 0) {\r\n            var firstLineRegexStr = lang.firstLine;\r\n            if (firstLineRegexStr.charAt(0) !== '^') {\r\n                firstLineRegexStr = '^' + firstLineRegexStr;\r\n            }\r\n            try {\r\n                var firstLineRegex = new RegExp(firstLineRegexStr);\r\n                if (!strings.regExpLeadsToEndlessLoop(firstLineRegex)) {\r\n                    mime.registerTextMime({ id: langId, mime: primaryMime, firstline: firstLineRegex }, this._warnOnOverwrite);\r\n                }\r\n            }\r\n            catch (err) {\r\n                // Most likely, the regex was bad\r\n                onUnexpectedError(err);\r\n            }\r\n        }\r\n        resolvedLanguage.aliases.push(langId);\r\n        var langAliases = null;\r\n        if (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases)) {\r\n            if (lang.aliases.length === 0) {\r\n                // signal that this language should not get a name\r\n                langAliases = [null];\r\n            }\r\n            else {\r\n                langAliases = lang.aliases;\r\n            }\r\n        }\r\n        if (langAliases !== null) {\r\n            for (var _g = 0, langAliases_1 = langAliases; _g < langAliases_1.length; _g++) {\r\n                var langAlias = langAliases_1[_g];\r\n                if (!langAlias || langAlias.length === 0) {\r\n                    continue;\r\n                }\r\n                resolvedLanguage.aliases.push(langAlias);\r\n            }\r\n        }\r\n        var containsAliases = (langAliases !== null && langAliases.length > 0);\r\n        if (containsAliases && langAliases[0] === null) {\r\n            // signal that this language should not get a name\r\n        }\r\n        else {\r\n            var bestName = (containsAliases ? langAliases[0] : null) || langId;\r\n            if (containsAliases || !resolvedLanguage.name) {\r\n                resolvedLanguage.name = bestName;\r\n            }\r\n        }\r\n        if (lang.configuration) {\r\n            resolvedLanguage.configurationFiles.push(lang.configuration);\r\n        }\r\n    };\r\n    LanguagesRegistry.prototype.isRegisteredMode = function (mimetypeOrModeId) {\r\n        // Is this a known mime type ?\r\n        if (hasOwnProperty.call(this._mimeTypesMap, mimetypeOrModeId)) {\r\n            return true;\r\n        }\r\n        // Is this a known mode id ?\r\n        return hasOwnProperty.call(this._languages, mimetypeOrModeId);\r\n    };\r\n    LanguagesRegistry.prototype.getModeIdForLanguageNameLowercase = function (languageNameLower) {\r\n        if (!hasOwnProperty.call(this._lowercaseNameMap, languageNameLower)) {\r\n            return null;\r\n        }\r\n        return this._lowercaseNameMap[languageNameLower].language;\r\n    };\r\n    LanguagesRegistry.prototype.extractModeIds = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\r\n        var _this = this;\r\n        if (!commaSeparatedMimetypesOrCommaSeparatedIds) {\r\n            return [];\r\n        }\r\n        return (commaSeparatedMimetypesOrCommaSeparatedIds.\r\n            split(',').\r\n            map(function (mimeTypeOrId) { return mimeTypeOrId.trim(); }).\r\n            map(function (mimeTypeOrId) {\r\n            if (hasOwnProperty.call(_this._mimeTypesMap, mimeTypeOrId)) {\r\n                return _this._mimeTypesMap[mimeTypeOrId].language;\r\n            }\r\n            return mimeTypeOrId;\r\n        }).\r\n            filter(function (modeId) {\r\n            return hasOwnProperty.call(_this._languages, modeId);\r\n        }));\r\n    };\r\n    LanguagesRegistry.prototype.getLanguageIdentifier = function (_modeId) {\r\n        if (_modeId === NULL_MODE_ID || _modeId === 0 /* Null */) {\r\n            return NULL_LANGUAGE_IDENTIFIER;\r\n        }\r\n        var modeId;\r\n        if (typeof _modeId === 'string') {\r\n            modeId = _modeId;\r\n        }\r\n        else {\r\n            modeId = this._languageIdToLanguage[_modeId];\r\n            if (!modeId) {\r\n                return null;\r\n            }\r\n        }\r\n        if (!hasOwnProperty.call(this._languages, modeId)) {\r\n            return null;\r\n        }\r\n        return this._languages[modeId].identifier;\r\n    };\r\n    LanguagesRegistry.prototype.getModeIdsFromFilepathOrFirstLine = function (resource, firstLine) {\r\n        if (!resource && !firstLine) {\r\n            return [];\r\n        }\r\n        var mimeTypes = mime.guessMimeTypes(resource, firstLine);\r\n        return this.extractModeIds(mimeTypes.join(','));\r\n    };\r\n    return LanguagesRegistry;\r\n}(Disposable));\r\nexport { LanguagesRegistry };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { FrankensteinMode } from '../modes/abstractMode.js';\r\nimport { NULL_LANGUAGE_IDENTIFIER } from '../modes/nullMode.js';\r\nimport { LanguagesRegistry } from './languagesRegistry.js';\r\nimport { firstOrDefault } from '../../../base/common/arrays.js';\r\nvar LanguageSelection = /** @class */ (function (_super) {\r\n    __extends(LanguageSelection, _super);\r\n    function LanguageSelection(onLanguagesMaybeChanged, selector) {\r\n        var _this = _super.call(this) || this;\r\n        _this._onDidChange = _this._register(new Emitter());\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._selector = selector;\r\n        _this.languageIdentifier = _this._selector();\r\n        _this._register(onLanguagesMaybeChanged(function () { return _this._evaluate(); }));\r\n        return _this;\r\n    }\r\n    LanguageSelection.prototype._evaluate = function () {\r\n        var languageIdentifier = this._selector();\r\n        if (languageIdentifier.id === this.languageIdentifier.id) {\r\n            // no change\r\n            return;\r\n        }\r\n        this.languageIdentifier = languageIdentifier;\r\n        this._onDidChange.fire(this.languageIdentifier);\r\n    };\r\n    return LanguageSelection;\r\n}(Disposable));\r\nvar ModeServiceImpl = /** @class */ (function () {\r\n    function ModeServiceImpl(warnOnOverwrite) {\r\n        var _this = this;\r\n        if (warnOnOverwrite === void 0) { warnOnOverwrite = false; }\r\n        this._onDidCreateMode = new Emitter();\r\n        this.onDidCreateMode = this._onDidCreateMode.event;\r\n        this._onLanguagesMaybeChanged = new Emitter();\r\n        this.onLanguagesMaybeChanged = this._onLanguagesMaybeChanged.event;\r\n        this._instantiatedModes = {};\r\n        this._registry = new LanguagesRegistry(true, warnOnOverwrite);\r\n        this._registry.onDidChange(function () { return _this._onLanguagesMaybeChanged.fire(); });\r\n    }\r\n    ModeServiceImpl.prototype.isRegisteredMode = function (mimetypeOrModeId) {\r\n        return this._registry.isRegisteredMode(mimetypeOrModeId);\r\n    };\r\n    ModeServiceImpl.prototype.getModeIdForLanguageName = function (alias) {\r\n        return this._registry.getModeIdForLanguageNameLowercase(alias);\r\n    };\r\n    ModeServiceImpl.prototype.getModeIdByFilepathOrFirstLine = function (resource, firstLine) {\r\n        var modeIds = this._registry.getModeIdsFromFilepathOrFirstLine(resource, firstLine);\r\n        return firstOrDefault(modeIds, null);\r\n    };\r\n    ModeServiceImpl.prototype.getModeId = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\r\n        var modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\r\n        return firstOrDefault(modeIds, null);\r\n    };\r\n    ModeServiceImpl.prototype.getLanguageIdentifier = function (modeId) {\r\n        return this._registry.getLanguageIdentifier(modeId);\r\n    };\r\n    // --- instantiation\r\n    ModeServiceImpl.prototype.create = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\r\n        var _this = this;\r\n        return new LanguageSelection(this.onLanguagesMaybeChanged, function () {\r\n            var modeId = _this.getModeId(commaSeparatedMimetypesOrCommaSeparatedIds);\r\n            return _this._createModeAndGetLanguageIdentifier(modeId);\r\n        });\r\n    };\r\n    ModeServiceImpl.prototype.createByFilepathOrFirstLine = function (resource, firstLine) {\r\n        var _this = this;\r\n        return new LanguageSelection(this.onLanguagesMaybeChanged, function () {\r\n            var modeId = _this.getModeIdByFilepathOrFirstLine(resource, firstLine);\r\n            return _this._createModeAndGetLanguageIdentifier(modeId);\r\n        });\r\n    };\r\n    ModeServiceImpl.prototype._createModeAndGetLanguageIdentifier = function (modeId) {\r\n        // Fall back to plain text if no mode was found\r\n        var languageIdentifier = this.getLanguageIdentifier(modeId || 'plaintext') || NULL_LANGUAGE_IDENTIFIER;\r\n        this._getOrCreateMode(languageIdentifier.language);\r\n        return languageIdentifier;\r\n    };\r\n    ModeServiceImpl.prototype.triggerMode = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\r\n        var modeId = this.getModeId(commaSeparatedMimetypesOrCommaSeparatedIds);\r\n        // Fall back to plain text if no mode was found\r\n        this._getOrCreateMode(modeId || 'plaintext');\r\n    };\r\n    ModeServiceImpl.prototype._getOrCreateMode = function (modeId) {\r\n        if (!this._instantiatedModes.hasOwnProperty(modeId)) {\r\n            var languageIdentifier = this.getLanguageIdentifier(modeId) || NULL_LANGUAGE_IDENTIFIER;\r\n            this._instantiatedModes[modeId] = new FrankensteinMode(languageIdentifier);\r\n            this._onDidCreateMode.fire(this._instantiatedModes[modeId]);\r\n        }\r\n        return this._instantiatedModes[modeId];\r\n    };\r\n    return ModeServiceImpl;\r\n}());\r\nexport { ModeServiceImpl };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as errors from '../../../base/common/errors.js';\r\nimport { EDITOR_MODEL_DEFAULTS } from '../config/editorOptions.js';\r\nimport { TextModel } from '../model/textModel.js';\r\nimport { DocumentSemanticTokensProviderRegistry, TokenMetadata } from '../modes.js';\r\nimport { PLAINTEXT_LANGUAGE_IDENTIFIER } from '../modes/modesRegistry.js';\r\nimport { ITextResourcePropertiesService } from './textResourceConfigurationService.js';\r\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\r\nimport { SparseEncodedTokens, MultilineTokens2 } from '../model/tokensStore.js';\r\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\r\nimport { ILogService, LogLevel } from '../../../platform/log/common/log.js';\r\nfunction MODEL_ID(resource) {\r\n    return resource.toString();\r\n}\r\nvar ModelData = /** @class */ (function () {\r\n    function ModelData(model, onWillDispose, onDidChangeLanguage) {\r\n        this._modelEventListeners = new DisposableStore();\r\n        this.model = model;\r\n        this._languageSelection = null;\r\n        this._languageSelectionListener = null;\r\n        this._modelEventListeners.add(model.onWillDispose(function () { return onWillDispose(model); }));\r\n        this._modelEventListeners.add(model.onDidChangeLanguage(function (e) { return onDidChangeLanguage(model, e); }));\r\n    }\r\n    ModelData.prototype._disposeLanguageSelection = function () {\r\n        if (this._languageSelectionListener) {\r\n            this._languageSelectionListener.dispose();\r\n            this._languageSelectionListener = null;\r\n        }\r\n        if (this._languageSelection) {\r\n            this._languageSelection.dispose();\r\n            this._languageSelection = null;\r\n        }\r\n    };\r\n    ModelData.prototype.dispose = function () {\r\n        this._modelEventListeners.dispose();\r\n        this._disposeLanguageSelection();\r\n    };\r\n    ModelData.prototype.setLanguage = function (languageSelection) {\r\n        var _this = this;\r\n        this._disposeLanguageSelection();\r\n        this._languageSelection = languageSelection;\r\n        this._languageSelectionListener = this._languageSelection.onDidChange(function () { return _this.model.setMode(languageSelection.languageIdentifier); });\r\n        this.model.setMode(languageSelection.languageIdentifier);\r\n    };\r\n    return ModelData;\r\n}());\r\nvar DEFAULT_EOL = (platform.isLinux || platform.isMacintosh) ? 1 /* LF */ : 2 /* CRLF */;\r\nvar ModelServiceImpl = /** @class */ (function (_super) {\r\n    __extends(ModelServiceImpl, _super);\r\n    function ModelServiceImpl(configurationService, resourcePropertiesService, themeService, logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._onModelAdded = _this._register(new Emitter());\r\n        _this.onModelAdded = _this._onModelAdded.event;\r\n        _this._onModelRemoved = _this._register(new Emitter());\r\n        _this.onModelRemoved = _this._onModelRemoved.event;\r\n        _this._onModelModeChanged = _this._register(new Emitter());\r\n        _this.onModelModeChanged = _this._onModelModeChanged.event;\r\n        _this._configurationService = configurationService;\r\n        _this._resourcePropertiesService = resourcePropertiesService;\r\n        _this._models = {};\r\n        _this._modelCreationOptionsByLanguageAndResource = Object.create(null);\r\n        _this._configurationServiceSubscription = _this._configurationService.onDidChangeConfiguration(function (e) { return _this._updateModelOptions(); });\r\n        _this._updateModelOptions();\r\n        _this._register(new SemanticColoringFeature(_this, themeService, configurationService, logService));\r\n        return _this;\r\n    }\r\n    ModelServiceImpl._readModelOptions = function (config, isForSimpleWidget) {\r\n        var tabSize = EDITOR_MODEL_DEFAULTS.tabSize;\r\n        if (config.editor && typeof config.editor.tabSize !== 'undefined') {\r\n            var parsedTabSize = parseInt(config.editor.tabSize, 10);\r\n            if (!isNaN(parsedTabSize)) {\r\n                tabSize = parsedTabSize;\r\n            }\r\n            if (tabSize < 1) {\r\n                tabSize = 1;\r\n            }\r\n        }\r\n        var indentSize = tabSize;\r\n        if (config.editor && typeof config.editor.indentSize !== 'undefined' && config.editor.indentSize !== 'tabSize') {\r\n            var parsedIndentSize = parseInt(config.editor.indentSize, 10);\r\n            if (!isNaN(parsedIndentSize)) {\r\n                indentSize = parsedIndentSize;\r\n            }\r\n            if (indentSize < 1) {\r\n                indentSize = 1;\r\n            }\r\n        }\r\n        var insertSpaces = EDITOR_MODEL_DEFAULTS.insertSpaces;\r\n        if (config.editor && typeof config.editor.insertSpaces !== 'undefined') {\r\n            insertSpaces = (config.editor.insertSpaces === 'false' ? false : Boolean(config.editor.insertSpaces));\r\n        }\r\n        var newDefaultEOL = DEFAULT_EOL;\r\n        var eol = config.eol;\r\n        if (eol === '\\r\\n') {\r\n            newDefaultEOL = 2 /* CRLF */;\r\n        }\r\n        else if (eol === '\\n') {\r\n            newDefaultEOL = 1 /* LF */;\r\n        }\r\n        var trimAutoWhitespace = EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;\r\n        if (config.editor && typeof config.editor.trimAutoWhitespace !== 'undefined') {\r\n            trimAutoWhitespace = (config.editor.trimAutoWhitespace === 'false' ? false : Boolean(config.editor.trimAutoWhitespace));\r\n        }\r\n        var detectIndentation = EDITOR_MODEL_DEFAULTS.detectIndentation;\r\n        if (config.editor && typeof config.editor.detectIndentation !== 'undefined') {\r\n            detectIndentation = (config.editor.detectIndentation === 'false' ? false : Boolean(config.editor.detectIndentation));\r\n        }\r\n        var largeFileOptimizations = EDITOR_MODEL_DEFAULTS.largeFileOptimizations;\r\n        if (config.editor && typeof config.editor.largeFileOptimizations !== 'undefined') {\r\n            largeFileOptimizations = (config.editor.largeFileOptimizations === 'false' ? false : Boolean(config.editor.largeFileOptimizations));\r\n        }\r\n        return {\r\n            isForSimpleWidget: isForSimpleWidget,\r\n            tabSize: tabSize,\r\n            indentSize: indentSize,\r\n            insertSpaces: insertSpaces,\r\n            detectIndentation: detectIndentation,\r\n            defaultEOL: newDefaultEOL,\r\n            trimAutoWhitespace: trimAutoWhitespace,\r\n            largeFileOptimizations: largeFileOptimizations\r\n        };\r\n    };\r\n    ModelServiceImpl.prototype.getCreationOptions = function (language, resource, isForSimpleWidget) {\r\n        var creationOptions = this._modelCreationOptionsByLanguageAndResource[language + resource];\r\n        if (!creationOptions) {\r\n            var editor = this._configurationService.getValue('editor', { overrideIdentifier: language, resource: resource });\r\n            var eol = this._resourcePropertiesService.getEOL(resource, language);\r\n            creationOptions = ModelServiceImpl._readModelOptions({ editor: editor, eol: eol }, isForSimpleWidget);\r\n            this._modelCreationOptionsByLanguageAndResource[language + resource] = creationOptions;\r\n        }\r\n        return creationOptions;\r\n    };\r\n    ModelServiceImpl.prototype._updateModelOptions = function () {\r\n        var oldOptionsByLanguageAndResource = this._modelCreationOptionsByLanguageAndResource;\r\n        this._modelCreationOptionsByLanguageAndResource = Object.create(null);\r\n        // Update options on all models\r\n        var keys = Object.keys(this._models);\r\n        for (var i = 0, len = keys.length; i < len; i++) {\r\n            var modelId = keys[i];\r\n            var modelData = this._models[modelId];\r\n            var language = modelData.model.getLanguageIdentifier().language;\r\n            var uri = modelData.model.uri;\r\n            var oldOptions = oldOptionsByLanguageAndResource[language + uri];\r\n            var newOptions = this.getCreationOptions(language, uri, modelData.model.isForSimpleWidget);\r\n            ModelServiceImpl._setModelOptionsForModel(modelData.model, newOptions, oldOptions);\r\n        }\r\n    };\r\n    ModelServiceImpl._setModelOptionsForModel = function (model, newOptions, currentOptions) {\r\n        if (currentOptions && currentOptions.defaultEOL !== newOptions.defaultEOL && model.getLineCount() === 1) {\r\n            model.setEOL(newOptions.defaultEOL === 1 /* LF */ ? 0 /* LF */ : 1 /* CRLF */);\r\n        }\r\n        if (currentOptions\r\n            && (currentOptions.detectIndentation === newOptions.detectIndentation)\r\n            && (currentOptions.insertSpaces === newOptions.insertSpaces)\r\n            && (currentOptions.tabSize === newOptions.tabSize)\r\n            && (currentOptions.indentSize === newOptions.indentSize)\r\n            && (currentOptions.trimAutoWhitespace === newOptions.trimAutoWhitespace)) {\r\n            // Same indent opts, no need to touch the model\r\n            return;\r\n        }\r\n        if (newOptions.detectIndentation) {\r\n            model.detectIndentation(newOptions.insertSpaces, newOptions.tabSize);\r\n            model.updateOptions({\r\n                trimAutoWhitespace: newOptions.trimAutoWhitespace\r\n            });\r\n        }\r\n        else {\r\n            model.updateOptions({\r\n                insertSpaces: newOptions.insertSpaces,\r\n                tabSize: newOptions.tabSize,\r\n                indentSize: newOptions.indentSize,\r\n                trimAutoWhitespace: newOptions.trimAutoWhitespace\r\n            });\r\n        }\r\n    };\r\n    ModelServiceImpl.prototype.dispose = function () {\r\n        this._configurationServiceSubscription.dispose();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    // --- begin IModelService\r\n    ModelServiceImpl.prototype._createModelData = function (value, languageIdentifier, resource, isForSimpleWidget) {\r\n        var _this = this;\r\n        // create & save the model\r\n        var options = this.getCreationOptions(languageIdentifier.language, resource, isForSimpleWidget);\r\n        var model = new TextModel(value, options, languageIdentifier, resource);\r\n        var modelId = MODEL_ID(model.uri);\r\n        if (this._models[modelId]) {\r\n            // There already exists a model with this id => this is a programmer error\r\n            throw new Error('ModelService: Cannot add model because it already exists!');\r\n        }\r\n        var modelData = new ModelData(model, function (model) { return _this._onWillDispose(model); }, function (model, e) { return _this._onDidChangeLanguage(model, e); });\r\n        this._models[modelId] = modelData;\r\n        return modelData;\r\n    };\r\n    ModelServiceImpl.prototype.createModel = function (value, languageSelection, resource, isForSimpleWidget) {\r\n        if (isForSimpleWidget === void 0) { isForSimpleWidget = false; }\r\n        var modelData;\r\n        if (languageSelection) {\r\n            modelData = this._createModelData(value, languageSelection.languageIdentifier, resource, isForSimpleWidget);\r\n            this.setMode(modelData.model, languageSelection);\r\n        }\r\n        else {\r\n            modelData = this._createModelData(value, PLAINTEXT_LANGUAGE_IDENTIFIER, resource, isForSimpleWidget);\r\n        }\r\n        this._onModelAdded.fire(modelData.model);\r\n        return modelData.model;\r\n    };\r\n    ModelServiceImpl.prototype.setMode = function (model, languageSelection) {\r\n        if (!languageSelection) {\r\n            return;\r\n        }\r\n        var modelData = this._models[MODEL_ID(model.uri)];\r\n        if (!modelData) {\r\n            return;\r\n        }\r\n        modelData.setLanguage(languageSelection);\r\n    };\r\n    ModelServiceImpl.prototype.getModels = function () {\r\n        var ret = [];\r\n        var keys = Object.keys(this._models);\r\n        for (var i = 0, len = keys.length; i < len; i++) {\r\n            var modelId = keys[i];\r\n            ret.push(this._models[modelId].model);\r\n        }\r\n        return ret;\r\n    };\r\n    ModelServiceImpl.prototype.getModel = function (resource) {\r\n        var modelId = MODEL_ID(resource);\r\n        var modelData = this._models[modelId];\r\n        if (!modelData) {\r\n            return null;\r\n        }\r\n        return modelData.model;\r\n    };\r\n    // --- end IModelService\r\n    ModelServiceImpl.prototype._onWillDispose = function (model) {\r\n        var modelId = MODEL_ID(model.uri);\r\n        var modelData = this._models[modelId];\r\n        delete this._models[modelId];\r\n        modelData.dispose();\r\n        // clean up cache\r\n        delete this._modelCreationOptionsByLanguageAndResource[model.getLanguageIdentifier().language + model.uri];\r\n        this._onModelRemoved.fire(model);\r\n    };\r\n    ModelServiceImpl.prototype._onDidChangeLanguage = function (model, e) {\r\n        var oldModeId = e.oldLanguage;\r\n        var newModeId = model.getLanguageIdentifier().language;\r\n        var oldOptions = this.getCreationOptions(oldModeId, model.uri, model.isForSimpleWidget);\r\n        var newOptions = this.getCreationOptions(newModeId, model.uri, model.isForSimpleWidget);\r\n        ModelServiceImpl._setModelOptionsForModel(model, newOptions, oldOptions);\r\n        this._onModelModeChanged.fire({ model: model, oldModeId: oldModeId });\r\n    };\r\n    ModelServiceImpl = __decorate([\r\n        __param(0, IConfigurationService),\r\n        __param(1, ITextResourcePropertiesService),\r\n        __param(2, IThemeService),\r\n        __param(3, ILogService)\r\n    ], ModelServiceImpl);\r\n    return ModelServiceImpl;\r\n}(Disposable));\r\nexport { ModelServiceImpl };\r\nvar SemanticColoringFeature = /** @class */ (function (_super) {\r\n    __extends(SemanticColoringFeature, _super);\r\n    function SemanticColoringFeature(modelService, themeService, configurationService, logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._configurationService = configurationService;\r\n        _this._watchers = Object.create(null);\r\n        _this._semanticStyling = _this._register(new SemanticStyling(themeService, logService));\r\n        var isSemanticColoringEnabled = function (model) {\r\n            var options = configurationService.getValue(SemanticColoringFeature.SETTING_ID, { overrideIdentifier: model.getLanguageIdentifier().language, resource: model.uri });\r\n            return options && options.enabled;\r\n        };\r\n        var register = function (model) {\r\n            _this._watchers[model.uri.toString()] = new ModelSemanticColoring(model, themeService, _this._semanticStyling);\r\n        };\r\n        var deregister = function (model, modelSemanticColoring) {\r\n            modelSemanticColoring.dispose();\r\n            delete _this._watchers[model.uri.toString()];\r\n        };\r\n        _this._register(modelService.onModelAdded(function (model) {\r\n            if (isSemanticColoringEnabled(model)) {\r\n                register(model);\r\n            }\r\n        }));\r\n        _this._register(modelService.onModelRemoved(function (model) {\r\n            var curr = _this._watchers[model.uri.toString()];\r\n            if (curr) {\r\n                deregister(model, curr);\r\n            }\r\n        }));\r\n        _this._configurationService.onDidChangeConfiguration(function (e) {\r\n            if (e.affectsConfiguration(SemanticColoringFeature.SETTING_ID)) {\r\n                for (var _i = 0, _a = modelService.getModels(); _i < _a.length; _i++) {\r\n                    var model = _a[_i];\r\n                    var curr = _this._watchers[model.uri.toString()];\r\n                    if (isSemanticColoringEnabled(model)) {\r\n                        if (!curr) {\r\n                            register(model);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (curr) {\r\n                            deregister(model, curr);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    SemanticColoringFeature.SETTING_ID = 'editor.semanticHighlighting';\r\n    return SemanticColoringFeature;\r\n}(Disposable));\r\nvar SemanticStyling = /** @class */ (function (_super) {\r\n    __extends(SemanticStyling, _super);\r\n    function SemanticStyling(_themeService, _logService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._themeService = _themeService;\r\n        _this._logService = _logService;\r\n        _this._caches = new WeakMap();\r\n        if (_this._themeService) {\r\n            // workaround for tests which use undefined... :/\r\n            _this._register(_this._themeService.onThemeChange(function () {\r\n                _this._caches = new WeakMap();\r\n            }));\r\n        }\r\n        return _this;\r\n    }\r\n    SemanticStyling.prototype.get = function (provider) {\r\n        if (!this._caches.has(provider)) {\r\n            this._caches.set(provider, new SemanticColoringProviderStyling(provider.getLegend(), this._themeService, this._logService));\r\n        }\r\n        return this._caches.get(provider);\r\n    };\r\n    return SemanticStyling;\r\n}(Disposable));\r\nvar HashTableEntry = /** @class */ (function () {\r\n    function HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata) {\r\n        this.tokenTypeIndex = tokenTypeIndex;\r\n        this.tokenModifierSet = tokenModifierSet;\r\n        this.metadata = metadata;\r\n        this.next = null;\r\n    }\r\n    return HashTableEntry;\r\n}());\r\nvar HashTable = /** @class */ (function () {\r\n    function HashTable() {\r\n        this._elementsCount = 0;\r\n        this._currentLengthIndex = 0;\r\n        this._currentLength = HashTable._SIZES[this._currentLengthIndex];\r\n        this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\r\n        this._elements = [];\r\n        HashTable._nullOutEntries(this._elements, this._currentLength);\r\n    }\r\n    HashTable._nullOutEntries = function (entries, length) {\r\n        for (var i = 0; i < length; i++) {\r\n            entries[i] = null;\r\n        }\r\n    };\r\n    HashTable.prototype._hashFunc = function (tokenTypeIndex, tokenModifierSet) {\r\n        return ((((tokenTypeIndex << 5) - tokenTypeIndex) + tokenModifierSet) | 0) % this._currentLength; // tokenTypeIndex * 31 + tokenModifierSet, keep as int32\r\n    };\r\n    HashTable.prototype.get = function (tokenTypeIndex, tokenModifierSet) {\r\n        var hash = this._hashFunc(tokenTypeIndex, tokenModifierSet);\r\n        var p = this._elements[hash];\r\n        while (p) {\r\n            if (p.tokenTypeIndex === tokenTypeIndex && p.tokenModifierSet === tokenModifierSet) {\r\n                return p;\r\n            }\r\n            p = p.next;\r\n        }\r\n        return null;\r\n    };\r\n    HashTable.prototype.add = function (tokenTypeIndex, tokenModifierSet, metadata) {\r\n        this._elementsCount++;\r\n        if (this._growCount !== 0 && this._elementsCount >= this._growCount) {\r\n            // expand!\r\n            var oldElements = this._elements;\r\n            this._currentLengthIndex++;\r\n            this._currentLength = HashTable._SIZES[this._currentLengthIndex];\r\n            this._growCount = Math.round(this._currentLengthIndex + 1 < HashTable._SIZES.length ? 2 / 3 * this._currentLength : 0);\r\n            this._elements = [];\r\n            HashTable._nullOutEntries(this._elements, this._currentLength);\r\n            for (var _i = 0, oldElements_1 = oldElements; _i < oldElements_1.length; _i++) {\r\n                var first = oldElements_1[_i];\r\n                var p = first;\r\n                while (p) {\r\n                    var oldNext = p.next;\r\n                    p.next = null;\r\n                    this._add(p);\r\n                    p = oldNext;\r\n                }\r\n            }\r\n        }\r\n        this._add(new HashTableEntry(tokenTypeIndex, tokenModifierSet, metadata));\r\n    };\r\n    HashTable.prototype._add = function (element) {\r\n        var hash = this._hashFunc(element.tokenTypeIndex, element.tokenModifierSet);\r\n        element.next = this._elements[hash];\r\n        this._elements[hash] = element;\r\n    };\r\n    HashTable._SIZES = [3, 7, 13, 31, 61, 127, 251, 509, 1021, 2039, 4093, 8191, 16381, 32749, 65521, 131071, 262139, 524287, 1048573, 2097143];\r\n    return HashTable;\r\n}());\r\nvar SemanticColoringProviderStyling = /** @class */ (function () {\r\n    function SemanticColoringProviderStyling(_legend, _themeService, _logService) {\r\n        this._legend = _legend;\r\n        this._themeService = _themeService;\r\n        this._logService = _logService;\r\n        this._hashTable = new HashTable();\r\n    }\r\n    SemanticColoringProviderStyling.prototype.getMetadata = function (tokenTypeIndex, tokenModifierSet) {\r\n        var entry = this._hashTable.get(tokenTypeIndex, tokenModifierSet);\r\n        var metadata;\r\n        if (entry) {\r\n            metadata = entry.metadata;\r\n        }\r\n        else {\r\n            var tokenType = this._legend.tokenTypes[tokenTypeIndex];\r\n            var tokenModifiers = [];\r\n            var modifierSet = tokenModifierSet;\r\n            for (var modifierIndex = 0; modifierSet > 0 && modifierIndex < this._legend.tokenModifiers.length; modifierIndex++) {\r\n                if (modifierSet & 1) {\r\n                    tokenModifiers.push(this._legend.tokenModifiers[modifierIndex]);\r\n                }\r\n                modifierSet = modifierSet >> 1;\r\n            }\r\n            var tokenStyle = this._themeService.getTheme().getTokenStyleMetadata(tokenType, tokenModifiers);\r\n            if (typeof tokenStyle === 'undefined') {\r\n                metadata = 2147483647 /* NO_STYLING */;\r\n            }\r\n            else {\r\n                metadata = 0;\r\n                if (typeof tokenStyle.italic !== 'undefined') {\r\n                    var italicBit = (tokenStyle.italic ? 1 /* Italic */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= italicBit | 1 /* SEMANTIC_USE_ITALIC */;\r\n                }\r\n                if (typeof tokenStyle.bold !== 'undefined') {\r\n                    var boldBit = (tokenStyle.bold ? 2 /* Bold */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= boldBit | 2 /* SEMANTIC_USE_BOLD */;\r\n                }\r\n                if (typeof tokenStyle.underline !== 'undefined') {\r\n                    var underlineBit = (tokenStyle.underline ? 4 /* Underline */ : 0) << 11 /* FONT_STYLE_OFFSET */;\r\n                    metadata |= underlineBit | 4 /* SEMANTIC_USE_UNDERLINE */;\r\n                }\r\n                if (tokenStyle.foreground) {\r\n                    var foregroundBits = (tokenStyle.foreground) << 14 /* FOREGROUND_OFFSET */;\r\n                    metadata |= foregroundBits | 8 /* SEMANTIC_USE_FOREGROUND */;\r\n                }\r\n                if (metadata === 0) {\r\n                    // Nothing!\r\n                    metadata = 2147483647 /* NO_STYLING */;\r\n                }\r\n            }\r\n            this._hashTable.add(tokenTypeIndex, tokenModifierSet, metadata);\r\n        }\r\n        if (this._logService.getLevel() === LogLevel.Trace) {\r\n            var type = this._legend.tokenTypes[tokenTypeIndex];\r\n            var modifiers = tokenModifierSet ? ' ' + this._legend.tokenModifiers.filter(function (_, i) { return tokenModifierSet & (1 << i); }).join(' ') : '';\r\n            this._logService.trace(\"tokenStyleMetadata \" + (entry ? '[CACHED] ' : '') + type + modifiers + \": foreground \" + TokenMetadata.getForeground(metadata) + \", fontStyle \" + TokenMetadata.getFontStyle(metadata).toString(2));\r\n        }\r\n        return metadata;\r\n    };\r\n    return SemanticColoringProviderStyling;\r\n}());\r\nvar SemanticTokensResponse = /** @class */ (function () {\r\n    function SemanticTokensResponse(_provider, resultId, data) {\r\n        this._provider = _provider;\r\n        this.resultId = resultId;\r\n        this.data = data;\r\n    }\r\n    SemanticTokensResponse.prototype.dispose = function () {\r\n        this._provider.releaseDocumentSemanticTokens(this.resultId);\r\n    };\r\n    return SemanticTokensResponse;\r\n}());\r\nvar ModelSemanticColoring = /** @class */ (function (_super) {\r\n    __extends(ModelSemanticColoring, _super);\r\n    function ModelSemanticColoring(model, themeService, stylingProvider) {\r\n        var _this = _super.call(this) || this;\r\n        _this._isDisposed = false;\r\n        _this._model = model;\r\n        _this._semanticStyling = stylingProvider;\r\n        _this._fetchSemanticTokens = _this._register(new RunOnceScheduler(function () { return _this._fetchSemanticTokensNow(); }, 300));\r\n        _this._currentResponse = null;\r\n        _this._currentRequestCancellationTokenSource = null;\r\n        _this._register(_this._model.onDidChangeContent(function (e) {\r\n            if (!_this._fetchSemanticTokens.isScheduled()) {\r\n                _this._fetchSemanticTokens.schedule();\r\n            }\r\n        }));\r\n        _this._register(DocumentSemanticTokensProviderRegistry.onDidChange(function (e) { return _this._fetchSemanticTokens.schedule(); }));\r\n        if (themeService) {\r\n            // workaround for tests which use undefined... :/\r\n            _this._register(themeService.onThemeChange(function (_) {\r\n                // clear out existing tokens\r\n                _this._setSemanticTokens(null, null, null, []);\r\n                _this._fetchSemanticTokens.schedule();\r\n            }));\r\n        }\r\n        _this._fetchSemanticTokens.schedule(0);\r\n        return _this;\r\n    }\r\n    ModelSemanticColoring.prototype.dispose = function () {\r\n        if (this._currentResponse) {\r\n            this._currentResponse.dispose();\r\n            this._currentResponse = null;\r\n        }\r\n        if (this._currentRequestCancellationTokenSource) {\r\n            this._currentRequestCancellationTokenSource.cancel();\r\n            this._currentRequestCancellationTokenSource = null;\r\n        }\r\n        this._setSemanticTokens(null, null, null, []);\r\n        this._isDisposed = true;\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ModelSemanticColoring.prototype._fetchSemanticTokensNow = function () {\r\n        var _this = this;\r\n        if (this._currentRequestCancellationTokenSource) {\r\n            // there is already a request running, let it finish...\r\n            return;\r\n        }\r\n        var provider = this._getSemanticColoringProvider();\r\n        if (!provider) {\r\n            return;\r\n        }\r\n        this._currentRequestCancellationTokenSource = new CancellationTokenSource();\r\n        var pendingChanges = [];\r\n        var contentChangeListener = this._model.onDidChangeContent(function (e) {\r\n            pendingChanges.push(e);\r\n        });\r\n        var styling = this._semanticStyling.get(provider);\r\n        var lastResultId = this._currentResponse ? this._currentResponse.resultId || null : null;\r\n        var request = Promise.resolve(provider.provideDocumentSemanticTokens(this._model, lastResultId, this._currentRequestCancellationTokenSource.token));\r\n        request.then(function (res) {\r\n            _this._currentRequestCancellationTokenSource = null;\r\n            contentChangeListener.dispose();\r\n            _this._setSemanticTokens(provider, res || null, styling, pendingChanges);\r\n        }, function (err) {\r\n            if (!err || typeof err.message !== 'string' || err.message.indexOf('busy') === -1) {\r\n                errors.onUnexpectedError(err);\r\n            }\r\n            // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\r\n            // The API does not have a special error kind to express this...\r\n            _this._currentRequestCancellationTokenSource = null;\r\n            contentChangeListener.dispose();\r\n            if (pendingChanges.length > 0) {\r\n                // More changes occurred while the request was running\r\n                if (!_this._fetchSemanticTokens.isScheduled()) {\r\n                    _this._fetchSemanticTokens.schedule();\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ModelSemanticColoring._isSemanticTokens = function (v) {\r\n        return v && !!(v.data);\r\n    };\r\n    ModelSemanticColoring._isSemanticTokensEdits = function (v) {\r\n        return v && Array.isArray(v.edits);\r\n    };\r\n    ModelSemanticColoring._copy = function (src, srcOffset, dest, destOffset, length) {\r\n        for (var i = 0; i < length; i++) {\r\n            dest[destOffset + i] = src[srcOffset + i];\r\n        }\r\n    };\r\n    ModelSemanticColoring.prototype._setSemanticTokens = function (provider, tokens, styling, pendingChanges) {\r\n        var currentResponse = this._currentResponse;\r\n        if (this._currentResponse) {\r\n            this._currentResponse.dispose();\r\n            this._currentResponse = null;\r\n        }\r\n        if (this._isDisposed) {\r\n            // disposed!\r\n            if (provider && tokens) {\r\n                provider.releaseDocumentSemanticTokens(tokens.resultId);\r\n            }\r\n            return;\r\n        }\r\n        if (!provider || !tokens || !styling) {\r\n            this._model.setSemanticTokens(null);\r\n            return;\r\n        }\r\n        if (ModelSemanticColoring._isSemanticTokensEdits(tokens)) {\r\n            if (!currentResponse) {\r\n                // not possible!\r\n                this._model.setSemanticTokens(null);\r\n                return;\r\n            }\r\n            if (tokens.edits.length === 0) {\r\n                // nothing to do!\r\n                tokens = {\r\n                    resultId: tokens.resultId,\r\n                    data: currentResponse.data\r\n                };\r\n            }\r\n            else {\r\n                var deltaLength = 0;\r\n                for (var _i = 0, _a = tokens.edits; _i < _a.length; _i++) {\r\n                    var edit = _a[_i];\r\n                    deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;\r\n                }\r\n                var srcData = currentResponse.data;\r\n                var destData = new Uint32Array(srcData.length + deltaLength);\r\n                var srcLastStart = srcData.length;\r\n                var destLastStart = destData.length;\r\n                for (var i = tokens.edits.length - 1; i >= 0; i--) {\r\n                    var edit = tokens.edits[i];\r\n                    var copyCount = srcLastStart - (edit.start + edit.deleteCount);\r\n                    if (copyCount > 0) {\r\n                        ModelSemanticColoring._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);\r\n                        destLastStart -= copyCount;\r\n                    }\r\n                    if (edit.data) {\r\n                        ModelSemanticColoring._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);\r\n                        destLastStart -= edit.data.length;\r\n                    }\r\n                    srcLastStart = edit.start;\r\n                }\r\n                if (srcLastStart > 0) {\r\n                    ModelSemanticColoring._copy(srcData, 0, destData, 0, srcLastStart);\r\n                }\r\n                tokens = {\r\n                    resultId: tokens.resultId,\r\n                    data: destData\r\n                };\r\n            }\r\n        }\r\n        if (ModelSemanticColoring._isSemanticTokens(tokens)) {\r\n            this._currentResponse = new SemanticTokensResponse(provider, tokens.resultId, tokens.data);\r\n            var srcData = tokens.data;\r\n            var tokenCount = (tokens.data.length / 5) | 0;\r\n            var tokensPerArea = Math.max(Math.ceil(tokenCount / 1024 /* DesiredMaxAreas */), 400 /* DesiredTokensPerArea */);\r\n            var result = [];\r\n            var tokenIndex = 0;\r\n            var lastLineNumber = 1;\r\n            var lastStartCharacter = 0;\r\n            while (tokenIndex < tokenCount) {\r\n                var tokenStartIndex = tokenIndex;\r\n                var tokenEndIndex = Math.min(tokenStartIndex + tokensPerArea, tokenCount);\r\n                // Keep tokens on the same line in the same area...\r\n                if (tokenEndIndex < tokenCount) {\r\n                    var smallTokenEndIndex = tokenEndIndex;\r\n                    while (smallTokenEndIndex - 1 > tokenStartIndex && srcData[5 * smallTokenEndIndex] === 0) {\r\n                        smallTokenEndIndex--;\r\n                    }\r\n                    if (smallTokenEndIndex - 1 === tokenStartIndex) {\r\n                        // there are so many tokens on this line that our area would be empty, we must now go right\r\n                        var bigTokenEndIndex = tokenEndIndex;\r\n                        while (bigTokenEndIndex + 1 < tokenCount && srcData[5 * bigTokenEndIndex] === 0) {\r\n                            bigTokenEndIndex++;\r\n                        }\r\n                        tokenEndIndex = bigTokenEndIndex;\r\n                    }\r\n                    else {\r\n                        tokenEndIndex = smallTokenEndIndex;\r\n                    }\r\n                }\r\n                var destData = new Uint32Array((tokenEndIndex - tokenStartIndex) * 4);\r\n                var destOffset = 0;\r\n                var areaLine = 0;\r\n                while (tokenIndex < tokenEndIndex) {\r\n                    var srcOffset = 5 * tokenIndex;\r\n                    var deltaLine = srcData[srcOffset];\r\n                    var deltaCharacter = srcData[srcOffset + 1];\r\n                    var lineNumber = lastLineNumber + deltaLine;\r\n                    var startCharacter = (deltaLine === 0 ? lastStartCharacter + deltaCharacter : deltaCharacter);\r\n                    var length_1 = srcData[srcOffset + 2];\r\n                    var tokenTypeIndex = srcData[srcOffset + 3];\r\n                    var tokenModifierSet = srcData[srcOffset + 4];\r\n                    var metadata = styling.getMetadata(tokenTypeIndex, tokenModifierSet);\r\n                    if (metadata !== 2147483647 /* NO_STYLING */) {\r\n                        if (areaLine === 0) {\r\n                            areaLine = lineNumber;\r\n                        }\r\n                        destData[destOffset] = lineNumber - areaLine;\r\n                        destData[destOffset + 1] = startCharacter;\r\n                        destData[destOffset + 2] = startCharacter + length_1;\r\n                        destData[destOffset + 3] = metadata;\r\n                        destOffset += 4;\r\n                    }\r\n                    lastLineNumber = lineNumber;\r\n                    lastStartCharacter = startCharacter;\r\n                    tokenIndex++;\r\n                }\r\n                if (destOffset !== destData.length) {\r\n                    destData = destData.subarray(0, destOffset);\r\n                }\r\n                var tokens_1 = new MultilineTokens2(areaLine, new SparseEncodedTokens(destData));\r\n                result.push(tokens_1);\r\n            }\r\n            // Adjust incoming semantic tokens\r\n            if (pendingChanges.length > 0) {\r\n                // More changes occurred while the request was running\r\n                // We need to:\r\n                // 1. Adjust incoming semantic tokens\r\n                // 2. Request them again\r\n                for (var _b = 0, pendingChanges_1 = pendingChanges; _b < pendingChanges_1.length; _b++) {\r\n                    var change = pendingChanges_1[_b];\r\n                    for (var _c = 0, result_1 = result; _c < result_1.length; _c++) {\r\n                        var area = result_1[_c];\r\n                        for (var _d = 0, _e = change.changes; _d < _e.length; _d++) {\r\n                            var singleChange = _e[_d];\r\n                            area.applyEdit(singleChange.range, singleChange.text);\r\n                        }\r\n                    }\r\n                }\r\n                if (!this._fetchSemanticTokens.isScheduled()) {\r\n                    this._fetchSemanticTokens.schedule();\r\n                }\r\n            }\r\n            this._model.setSemanticTokens(result);\r\n            return;\r\n        }\r\n        this._model.setSemanticTokens(null);\r\n    };\r\n    ModelSemanticColoring.prototype._getSemanticColoringProvider = function () {\r\n        var result = DocumentSemanticTokensProviderRegistry.ordered(this._model);\r\n        return (result.length > 0 ? result[0] : null);\r\n    };\r\n    return ModelSemanticColoring;\r\n}(Disposable));\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { IMarkerService, MarkerSeverity } from '../../../platform/markers/common/markers.js';\r\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\r\nimport { OverviewRulerLane, MinimapPosition } from '../model.js';\r\nimport { themeColorFromId } from '../../../platform/theme/common/themeService.js';\r\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from '../view/editorColorRegistry.js';\r\nimport { IModelService } from './modelService.js';\r\nimport { Range } from '../core/range.js';\r\nimport { keys } from '../../../base/common/map.js';\r\nimport { Schemas } from '../../../base/common/network.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { withUndefinedAsNull } from '../../../base/common/types.js';\r\nimport { minimapWarning, minimapError } from '../../../platform/theme/common/colorRegistry.js';\r\nfunction MODEL_ID(resource) {\r\n    return resource.toString();\r\n}\r\nvar MarkerDecorations = /** @class */ (function (_super) {\r\n    __extends(MarkerDecorations, _super);\r\n    function MarkerDecorations(model) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = model;\r\n        _this._markersData = new Map();\r\n        _this._register(toDisposable(function () {\r\n            _this.model.deltaDecorations(keys(_this._markersData), []);\r\n            _this._markersData.clear();\r\n        }));\r\n        return _this;\r\n    }\r\n    MarkerDecorations.prototype.update = function (markers, newDecorations) {\r\n        var oldIds = keys(this._markersData);\r\n        this._markersData.clear();\r\n        var ids = this.model.deltaDecorations(oldIds, newDecorations);\r\n        for (var index = 0; index < ids.length; index++) {\r\n            this._markersData.set(ids[index], markers[index]);\r\n        }\r\n    };\r\n    MarkerDecorations.prototype.getMarker = function (decoration) {\r\n        return this._markersData.get(decoration.id);\r\n    };\r\n    return MarkerDecorations;\r\n}(Disposable));\r\nvar MarkerDecorationsService = /** @class */ (function (_super) {\r\n    __extends(MarkerDecorationsService, _super);\r\n    function MarkerDecorationsService(modelService, _markerService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._markerService = _markerService;\r\n        _this._onDidChangeMarker = _this._register(new Emitter());\r\n        _this._markerDecorations = new Map();\r\n        modelService.getModels().forEach(function (model) { return _this._onModelAdded(model); });\r\n        _this._register(modelService.onModelAdded(_this._onModelAdded, _this));\r\n        _this._register(modelService.onModelRemoved(_this._onModelRemoved, _this));\r\n        _this._register(_this._markerService.onMarkerChanged(_this._handleMarkerChange, _this));\r\n        return _this;\r\n    }\r\n    MarkerDecorationsService.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this._markerDecorations.forEach(function (value) { return value.dispose(); });\r\n        this._markerDecorations.clear();\r\n    };\r\n    MarkerDecorationsService.prototype.getMarker = function (model, decoration) {\r\n        var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\r\n        return markerDecorations ? withUndefinedAsNull(markerDecorations.getMarker(decoration)) : null;\r\n    };\r\n    MarkerDecorationsService.prototype._handleMarkerChange = function (changedResources) {\r\n        var _this = this;\r\n        changedResources.forEach(function (resource) {\r\n            var markerDecorations = _this._markerDecorations.get(MODEL_ID(resource));\r\n            if (markerDecorations) {\r\n                _this._updateDecorations(markerDecorations);\r\n            }\r\n        });\r\n    };\r\n    MarkerDecorationsService.prototype._onModelAdded = function (model) {\r\n        var markerDecorations = new MarkerDecorations(model);\r\n        this._markerDecorations.set(MODEL_ID(model.uri), markerDecorations);\r\n        this._updateDecorations(markerDecorations);\r\n    };\r\n    MarkerDecorationsService.prototype._onModelRemoved = function (model) {\r\n        var _this = this;\r\n        var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\r\n        if (markerDecorations) {\r\n            markerDecorations.dispose();\r\n            this._markerDecorations.delete(MODEL_ID(model.uri));\r\n        }\r\n        // clean up markers for internal, transient models\r\n        if (model.uri.scheme === Schemas.inMemory\r\n            || model.uri.scheme === Schemas.internal\r\n            || model.uri.scheme === Schemas.vscode) {\r\n            if (this._markerService) {\r\n                this._markerService.read({ resource: model.uri }).map(function (marker) { return marker.owner; }).forEach(function (owner) { return _this._markerService.remove(owner, [model.uri]); });\r\n            }\r\n        }\r\n    };\r\n    MarkerDecorationsService.prototype._updateDecorations = function (markerDecorations) {\r\n        var _this = this;\r\n        // Limit to the first 500 errors/warnings\r\n        var markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\r\n        var newModelDecorations = markers.map(function (marker) {\r\n            return {\r\n                range: _this._createDecorationRange(markerDecorations.model, marker),\r\n                options: _this._createDecorationOption(marker)\r\n            };\r\n        });\r\n        markerDecorations.update(markers, newModelDecorations);\r\n        this._onDidChangeMarker.fire(markerDecorations.model);\r\n    };\r\n    MarkerDecorationsService.prototype._createDecorationRange = function (model, rawMarker) {\r\n        var ret = Range.lift(rawMarker);\r\n        if (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, 1 /* Unnecessary */) && !this._hasMarkerTag(rawMarker, 2 /* Deprecated */)) {\r\n            // * never render hints on multiple lines\r\n            // * make enough space for three dots\r\n            ret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\r\n        }\r\n        ret = model.validateRange(ret);\r\n        if (ret.isEmpty()) {\r\n            var word = model.getWordAtPosition(ret.getStartPosition());\r\n            if (word) {\r\n                ret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\r\n            }\r\n            else {\r\n                var maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\r\n                    model.getLineMaxColumn(ret.startLineNumber);\r\n                if (maxColumn === 1) {\r\n                    // empty line\r\n                    // console.warn('marker on empty line:', marker);\r\n                }\r\n                else if (ret.endColumn >= maxColumn) {\r\n                    // behind eol\r\n                    ret = new Range(ret.startLineNumber, maxColumn - 1, ret.endLineNumber, maxColumn);\r\n                }\r\n                else {\r\n                    // extend marker to width = 1\r\n                    ret = new Range(ret.startLineNumber, ret.startColumn, ret.endLineNumber, ret.endColumn + 1);\r\n                }\r\n            }\r\n        }\r\n        else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\r\n            var minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\r\n            if (minColumn < ret.endColumn) {\r\n                ret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\r\n                rawMarker.startColumn = minColumn;\r\n            }\r\n        }\r\n        return ret;\r\n    };\r\n    MarkerDecorationsService.prototype._createDecorationOption = function (marker) {\r\n        var className;\r\n        var color = undefined;\r\n        var zIndex;\r\n        var inlineClassName = undefined;\r\n        var minimap;\r\n        switch (marker.severity) {\r\n            case MarkerSeverity.Hint:\r\n                if (this._hasMarkerTag(marker, 2 /* Deprecated */)) {\r\n                    className = undefined;\r\n                }\r\n                else if (this._hasMarkerTag(marker, 1 /* Unnecessary */)) {\r\n                    className = \"squiggly-unnecessary\" /* EditorUnnecessaryDecoration */;\r\n                }\r\n                else {\r\n                    className = \"squiggly-hint\" /* EditorHintDecoration */;\r\n                }\r\n                zIndex = 0;\r\n                break;\r\n            case MarkerSeverity.Warning:\r\n                className = \"squiggly-warning\" /* EditorWarningDecoration */;\r\n                color = themeColorFromId(overviewRulerWarning);\r\n                zIndex = 20;\r\n                minimap = {\r\n                    color: themeColorFromId(minimapWarning),\r\n                    position: MinimapPosition.Inline\r\n                };\r\n                break;\r\n            case MarkerSeverity.Info:\r\n                className = \"squiggly-info\" /* EditorInfoDecoration */;\r\n                color = themeColorFromId(overviewRulerInfo);\r\n                zIndex = 10;\r\n                break;\r\n            case MarkerSeverity.Error:\r\n            default:\r\n                className = \"squiggly-error\" /* EditorErrorDecoration */;\r\n                color = themeColorFromId(overviewRulerError);\r\n                zIndex = 30;\r\n                minimap = {\r\n                    color: themeColorFromId(minimapError),\r\n                    position: MinimapPosition.Inline\r\n                };\r\n                break;\r\n        }\r\n        if (marker.tags) {\r\n            if (marker.tags.indexOf(1 /* Unnecessary */) !== -1) {\r\n                inlineClassName = \"squiggly-inline-unnecessary\" /* EditorUnnecessaryInlineDecoration */;\r\n            }\r\n            if (marker.tags.indexOf(2 /* Deprecated */) !== -1) {\r\n                inlineClassName = \"squiggly-inline-deprecated\" /* EditorDeprecatedInlineDecoration */;\r\n            }\r\n        }\r\n        return {\r\n            stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n            className: className,\r\n            showIfCollapsed: true,\r\n            overviewRuler: {\r\n                color: color,\r\n                position: OverviewRulerLane.Right\r\n            },\r\n            minimap: minimap,\r\n            zIndex: zIndex,\r\n            inlineClassName: inlineClassName,\r\n        };\r\n    };\r\n    MarkerDecorationsService.prototype._hasMarkerTag = function (marker, tag) {\r\n        if (marker.tags) {\r\n            return marker.tags.indexOf(tag) >= 0;\r\n        }\r\n        return false;\r\n    };\r\n    MarkerDecorationsService = __decorate([\r\n        __param(0, IModelService),\r\n        __param(1, IMarkerService)\r\n    ], MarkerDecorationsService);\r\n    return MarkerDecorationsService;\r\n}(Disposable));\r\nexport { MarkerDecorationsService };\r\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nexport var IMarkerDecorationsService = createDecorator('markerDecorationsService');\r\n"],"sourceRoot":""}